
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>COMMON SETUP &#8212; Zero-Shot Document Ranking Using LLMs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=b0119548" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'llmranking_0045clean';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">Zero-Shot Document Ranking Using LLMs</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    COMMON SETUP
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/llmranking_0045clean.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>COMMON SETUP</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">COMMON SETUP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-merge-list">DataFrame Merge List</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-display-function">DataFrame Display Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-cache-management">DataFrame Cache Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-analysis-utilities">DataFrame Analysis Utilities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-statistics-parser">Time Statistics Parser</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#figure-generation-utilities">Figure Generation Utilities</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-experiments">RUN EXPERIMENTS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-experiments">BEIR EXPERIMENTS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-published-metrics">LOAD PUBLISHED METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zhuang-table2-ocr-0011">Zhuang_table2_ocr_0011()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zhuang-table3-ocr-0011">Zhuang_table3_ocr_0011()</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-measured-metrics">LOAD MEASURED METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eval-measurements">eval_measurements()</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v3">v3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v2">v2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v1">v1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-lesner">bm25_metrics_measured_by_lesner()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-lesner2">bm25_metrics_measured_by_lesner2()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-metrics-measured-by-lesner">beir_metrics_measured_by_lesner()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-metrics-measured-by-lesner2">beir_metrics_measured_by_lesner2()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-dhaliwal">bm25_metrics_measured_by_dhaliwal()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#all-metrics-measured-by-dhaliwal">all_metrics_measured_by_dhaliwal()</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#consolidate-metrics">CONSOLIDATE METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-merging">DataFrame Merging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-inspection">Data Inspection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#label-standardization">Label Standardization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-adjustment-pipeline">Data Adjustment Pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distinct-elements">Distinct Elements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicate-detection">Duplicate Detection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-metrics">ANALYZE METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-statistics">Data Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-selection-and-summary-functions">Metric Selection and Summary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-metric-analysis-sections">Specific Metric Analysis Sections</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ndcg-metrics">ndcg_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrences-metrics">infrences_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prompt-tokens-metrics">prompt_tokens_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generated-tokens-metrics">generated_tokens_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#latency-metrics">latency_metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results-measured-vs-published">Results: Measured vs Published</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-ndcg-10">Measured vs Published: TrecDL NDCG@10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-query-latency">Measured vs Published: TrecDL Query Latency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-inferences">Measured vs Published: TrecDL #Inferences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-prompt-tokens">Measured vs Published: TrecDL Prompt Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-generated-tokens">Measured vs Published: TrecDL Generated Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-metric-discrepancy">Measured vs Published: TrecDL Metric Discrepancy %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-beir-ndcg-10-discrepancy">Measured vs Published: BEIR NDCG@10 Discrepancy %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-beir-gpu-minutes">Measured vs Published: BEIR GPU Minutes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results-modified-vs-original">Results: Modified vs Original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-metric-increase">Modified vs Original: BEIR Metric Increase %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-ndcg-10-increase">Modified vs Original: BEIR NDCG@10 Increase %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-beir-modified-metric">analyze_beir_modified_metric()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-ndcg-10">Modified vs Original: BEIR NDCG@10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-query-latency">Modified vs Original: BEIR Query Latency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-inferences">Modified vs Original: BEIR #Inferences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-prompt-tokens">Modified vs Original: BEIR Prompt Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-generated-tokens">Modified vs Original: BEIR Generated Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gpu-minutes-per-experiment">GPU Minutes Per Experiment</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="common-setup">
<h1>COMMON SETUP<a class="headerlink" href="#common-setup" title="Link to this heading">#</a></h1>
<section id="dataframe-merge-list">
<h2>DataFrame Merge List<a class="headerlink" href="#dataframe-merge-list" title="Link to this heading">#</a></h2>
<p>A simple initialization of an empty list (<code class="docutils literal notranslate"><span class="pre">df_merge_list</span></code>) used to collect DataFrames that will be merged later in the processing pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_merge_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataframe-display-function">
<h2>DataFrame Display Function<a class="headerlink" href="#dataframe-display-function" title="Link to this heading">#</a></h2>
<p>A custom display function for pandas DataFrames that creates scrollable HTML tables with configurable settings for maximum rows and columns. It improves the visualization of large DataFrames in Jupyter notebooks by providing better control over how data is displayed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">df_display</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># df = pd.DataFrame(np.random.rand(40, 40), columns=[f&quot;Column {i}&quot; for i in range(40)])</span>

    <span class="c1"># Display the DataFrame as a scrollable HTML table</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">max_rows</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">table_id</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataframe-cache-management">
<h2>DataFrame Cache Management<a class="headerlink" href="#dataframe-cache-management" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">read_df_from_cache_or_create()</span></code> function implements a caching mechanism for pandas DataFrames. It helps optimize performance by:</p>
<ul class="simple">
<li><p>Saving DataFrames to disk to avoid expensive recomputations</p></li>
<li><p>Loading cached DataFrames when available</p></li>
<li><p>Providing cache clearing functionality</p></li>
<li><p>Managing cache storage in a ‘_cache’ directory</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">read_df_from_cache_or_create</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">createdf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a DataFrame either from cache or creates it using the provided function.</span>
<span class="sd">    The supplied function may load the dataframe from a remote database or it may create it in some other way.</span>
<span class="sd">    If createdf is None, any existing cache for the given key is cleared.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    key (str): Cache key to identify the DataFrame</span>
<span class="sd">    createdf (callable, optional): Function that returns a pandas DataFrame. </span>
<span class="sd">                                 If None, clears cache for the given key.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: The cached or newly created DataFrame.</span>
<span class="sd">                 Returns None if createdf is None (cache clearing mode).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure cache directory exists</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;_cache&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Construct cache file path</span>
    <span class="n">cache_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;_cache&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">.df&#39;</span><span class="p">)</span>
    
    <span class="c1"># If createdf is None, clear cache and return</span>
    <span class="k">if</span> <span class="n">createdf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache cleared for key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error clearing cache for key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1"># Check if cache file exists</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load from cache</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading cache file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># If there&#39;s an error reading cache, proceed to create new DataFrame</span>
    
    <span class="c1"># Create new DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">createdf</span><span class="p">()</span>
    
    <span class="c1"># Validate that we got a DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;createdf function must return a pandas DataFrame&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Save to cache</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not save to cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataframe-analysis-utilities">
<h2>DataFrame Analysis Utilities<a class="headerlink" href="#dataframe-analysis-utilities" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">analyze_distinct_elements()</span></code> function provides comprehensive analysis of DataFrame columns by:</p>
<ul class="simple">
<li><p>Counting unique values in each column</p></li>
<li><p>Supporting column exclusion through an ignore list</p></li>
<li><p>Converting values to strings for consistent handling</p></li>
<li><p>Providing formatted output through the companion <code class="docutils literal notranslate"><span class="pre">print_distinct_elements()</span></code> function</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">analyze_distinct_elements</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ignore_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes distinct elements and their counts for each column in a DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        The input DataFrame to analyze</span>
<span class="sd">    ignore_columns : List[str], optional</span>
<span class="sd">        List of column names to exclude from the analysis</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Dict[str, Dict[str, int]]</span>
<span class="sd">        A dictionary where:</span>
<span class="sd">        - Keys are column names</span>
<span class="sd">        - Values are dictionaries mapping unique values to their counts</span>
<span class="sd">        </span>
<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;A&#39;: [1, 2, 2, 3],</span>
<span class="sd">    ...     &#39;B&#39;: [&#39;x&#39;, &#39;y&#39;, &#39;x&#39;, &#39;z&#39;]</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; analyze_distinct_elements(df)</span>
<span class="sd">    {</span>
<span class="sd">        &#39;A&#39;: {1: 1, 2: 2, 3: 1},</span>
<span class="sd">        &#39;B&#39;: {&#39;x&#39;: 2, &#39;y&#39;: 1, &#39;z&#39;: 1}</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize ignore_columns if None</span>
    <span class="n">ignore_columns</span> <span class="o">=</span> <span class="n">ignore_columns</span> <span class="ow">or</span> <span class="p">[]</span>
    
    <span class="c1"># Validate column names</span>
    <span class="n">invalid_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ignore_columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">invalid_columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns not found in DataFrame: </span><span class="si">{</span><span class="n">invalid_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get columns to analyze</span>
    <span class="n">columns_to_analyze</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_columns</span><span class="p">]</span>
    
    <span class="c1"># Initialize results dictionary</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Analyze each column</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns_to_analyze</span><span class="p">:</span>
        <span class="c1"># Convert to string to handle mixed types and make results more readable</span>
        <span class="n">value_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_counts</span>
        
    <span class="k">return</span> <span class="n">results</span>

<span class="k">def</span> <span class="nf">print_distinct_elements</span><span class="p">(</span><span class="n">analysis_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the analysis results in a formatted way.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    analysis_results : Dict[str, Dict[str, int]]</span>
<span class="sd">        The results from analyze_distinct_elements function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-statistics-parser">
<h2>Time Statistics Parser<a class="headerlink" href="#time-statistics-parser" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TimeStats</span></code> class and <code class="docutils literal notranslate"><span class="pre">parse_time_output()</span></code> function work together to:</p>
<ul class="simple">
<li><p>Parse Unix-style time command output</p></li>
<li><p>Extract user time, system time, elapsed time, and CPU usage</p></li>
<li><p>Convert time formats (HH:MM:SS) to seconds</p></li>
<li><p>Provide structured access to timing statistics through a dataclass</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TimeStats</span><span class="p">:</span>
    <span class="n">user_time</span><span class="p">:</span> <span class="nb">float</span>      <span class="c1"># User time in seconds</span>
    <span class="n">system_time</span><span class="p">:</span> <span class="nb">float</span>    <span class="c1"># System time in seconds</span>
    <span class="n">elapsed_time</span><span class="p">:</span> <span class="nb">str</span>     <span class="c1"># Elapsed time in HH:MM:SS format</span>
    <span class="n">elapsed_seconds</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Elapsed time converted to seconds</span>
    <span class="n">cpu_percentage</span><span class="p">:</span> <span class="nb">float</span> <span class="c1"># CPU percentage</span>

<span class="k">def</span> <span class="nf">parse_time_output</span><span class="p">(</span><span class="n">time_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TimeStats</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the output from Unix time command.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        time_str: String output from time command (e.g., &quot;4083.96user 9.53system 1:07:45elapsed 100%CPU&quot;)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        TimeStats object containing parsed values, or None if parsing fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract components using regex</span>
        <span class="n">user_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+\.?\d*)user&#39;</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
        <span class="n">system_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+\.?\d*)system&#39;</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
        <span class="n">elapsed_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+:?\d*:?\d*)elapsed&#39;</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
        <span class="n">cpu_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)%CPU&#39;</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">user_match</span><span class="p">,</span> <span class="n">system_match</span><span class="p">,</span> <span class="n">elapsed_match</span><span class="p">,</span> <span class="n">cpu_match</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="c1"># Parse elapsed time to seconds</span>
        <span class="n">elapsed_parts</span> <span class="o">=</span> <span class="n">elapsed_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elapsed_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># HH:MM:SS</span>
            <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">elapsed_parts</span><span class="p">)</span>
            <span class="n">elapsed_seconds</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">seconds</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">elapsed_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># MM:SS</span>
            <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">elapsed_parts</span><span class="p">)</span>
            <span class="n">elapsed_seconds</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">seconds</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># SS</span>
            <span class="n">elapsed_seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">elapsed_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">TimeStats</span><span class="p">(</span>
            <span class="n">user_time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">user_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">system_time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">system_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">elapsed_time</span><span class="o">=</span><span class="n">elapsed_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">elapsed_seconds</span><span class="o">=</span><span class="n">elapsed_seconds</span><span class="p">,</span>
            <span class="n">cpu_percentage</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">cpu_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
        
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="figure-generation-utilities">
<h2>Figure Generation Utilities<a class="headerlink" href="#figure-generation-utilities" title="Link to this heading">#</a></h2>
<p>Contains two main functions for figure management:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">create_clean_generated()</span></code>: Creates and maintains a clean ‘_generated’ directory for documentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_optimized_png()</span></code>: Handles figure saving with optimization by:</p>
<ul class="simple">
<li><p>Converting matplotlib figures to optimized PNG format</p></li>
<li><p>Supporting configurable DPI and compression settings</p></li>
<li><p>Using PIL for image optimization</p></li>
<li><p>Managing memory through proper buffer handling</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_clean_generated</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;doc/_generated&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># if it exists empty the directory</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;doc/_generated&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">create_clean_generated</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="k">def</span> <span class="nf">save_optimized_png</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="mi">9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a matplotlib figure as an optimized PNG file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The figure to save</span>
<span class="sd">    filepath : str</span>
<span class="sd">        Path where the PNG file should be saved</span>
<span class="sd">    dpi : int, optional</span>
<span class="sd">        Resolution of the output image (default: 300)</span>
<span class="sd">    optimize : bool, optional</span>
<span class="sd">        Whether to optimize the PNG (default: True)</span>
<span class="sd">    compression : int, optional</span>
<span class="sd">        PNG compression level (0-9, default: 9)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First save to a buffer at high quality</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytteBuffer</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Open the buffer with Pillow</span>
    <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
        <span class="c1"># Save with optimization</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">filepath</span><span class="p">,</span>
            <span class="s1">&#39;PNG&#39;</span><span class="p">,</span>
            <span class="n">optimize</span><span class="o">=</span><span class="n">optimize</span><span class="p">,</span>
            <span class="n">compress_level</span><span class="o">=</span><span class="n">compression</span>
        <span class="p">)</span>
    
    <span class="c1"># Clear the buffer</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="run-experiments">
<h1>RUN EXPERIMENTS<a class="headerlink" href="#run-experiments" title="Link to this heading">#</a></h1>
<p>Each run may use a different dataset, LLM model, ranking method, …</p>
<p>Many combinations are possible but one must be selective because…</p>
<p>One experiment may take several GPU hours even using RTX 4090’s’</p>
<p>Queries and passages are processed by a local LLM – time consuming!</p>
<p>We start jobs using commands from: <a class="github reference external" href="https://github.com/ielab/llm-rankers">ielab/llm-rankers</a></p>
<p>To keep GPU 100% busy we launch several GPUs in parallel.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;google/flan-t5-large&quot;, # 4-5 jobs can share one 24GB GPU
&quot;google/flan-t5-xl&quot;, # 2-3 jobs can share one 24GB GPU
&quot;google/flan-t5-xxl&quot; # mostly too big for 24GB GPU
</pre></div>
</div>
<p>Data was collected using ten RTX 4090 GPU servers rented for about a day.</p>
<p>Logs from servers are merged and loaded into dataframes below.</p>
<section id="beir-experiments">
<h2>BEIR EXPERIMENTS<a class="headerlink" href="#beir-experiments" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># Define the datasets, models, and ranking methods</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span>

    <span class="s2">&quot;scifact&quot;</span><span class="p">,</span>           <span class="c1"># ~5,183 documents, ~10MB</span>
    <span class="s2">&quot;dbpedia-entity&quot;</span><span class="p">,</span>    <span class="c1"># ~4,600,000 entities, ~42GB</span>

    <span class="s2">&quot;nfcorpus&quot;</span><span class="p">,</span>          <span class="c1"># ~3,633 abstracts, ~13MB</span>
    <span class="s2">&quot;signal1m&quot;</span><span class="p">,</span>          <span class="c1"># ~1,000,000 documents, ~23GB</span>
    
    <span class="s2">&quot;trec-covid&quot;</span><span class="p">,</span>        <span class="c1"># ~171,332 documents, ~5GB</span>
    <span class="s2">&quot;webis-touche2020&quot;</span><span class="p">,</span>  <span class="c1"># ~382,545 documents, ~8GB</span>
    
    <span class="s2">&quot;robust04&quot;</span><span class="p">,</span>          <span class="c1"># ~528,000 documents, ~2GB</span>
    <span class="s2">&quot;trec-news&quot;</span><span class="p">,</span>         <span class="c1"># ~594,977 documents, ~9GB</span>
<span class="p">]</span>

<span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;google/flan-t5-large&quot;</span><span class="p">,</span> <span class="c1"># six per 24GB GPU</span>
    <span class="s2">&quot;google/flan-t5-xl&quot;</span><span class="p">,</span> <span class="c1"># two per 24GB GPU</span>
    <span class="s2">&quot;google/flan-t5-xxl&quot;</span> <span class="c1"># too big for 24GB GPU</span>
<span class="p">]</span>
 
<span class="n">ranking_method_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;setwise&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;pairwise&quot;</span><span class="p">,</span>
    <span class="s2">&quot;listwise&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;pointwise&quot;</span><span class="p">,</span> 
<span class="p">]</span>

<span class="n">sorting_method_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># &quot;pairwise&quot;: [&quot;heapsort&quot;, &quot;bubblesort&quot;, &quot;allpair&quot;],</span>
    <span class="s2">&quot;pairwise&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;heapsort&quot;</span><span class="p">,</span> <span class="s2">&quot;bubblesort&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;setwise&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;heapsort&quot;</span><span class="p">,</span> <span class="s2">&quot;bubblesort&quot;</span><span class="p">],</span>
    <span class="s2">&quot;pointwise&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yes_no&quot;</span><span class="p">,</span> <span class="s2">&quot;qlm&quot;</span><span class="p">],</span>
    <span class="s2">&quot;listwise&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;likelihood&quot;</span><span class="p">,</span> <span class="s2">&quot;generation&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">n_hits_list</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">100</span> <span class="p">]</span>
<span class="n">top_k</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">npar</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># Number of parallel processes</span>
<span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># device_ids = [0, 1, 2, 3]</span>

<span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;output_files/beir&quot;</span>

<span class="n">activate_script</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../lr_venv/bin/activate&quot;</span><span class="p">))</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_bm25</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">n_hits</span><span class="p">):</span>
    <span class="n">pyserini_index</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;beir-v1.0.0-</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">bm25_run_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run.bm25.</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2">.txt&quot;</span>
    <span class="n">bm25_run_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">bm25_run_file</span><span class="p">)</span>

        <span class="c1"># . {activate_script} &amp;&amp; \</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bm25_run_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running BM25 for dataset </span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">bm25_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        time python3 -m pyserini.search.lucene </span><span class="se">\</span>
<span class="s2">            --index </span><span class="si">{</span><span class="n">pyserini_index</span><span class="si">}</span><span class="s2">.flat </span><span class="se">\</span>
<span class="s2">            --topics </span><span class="si">{</span><span class="n">pyserini_index</span><span class="si">}</span><span class="s2">-test </span><span class="se">\</span>
<span class="s2">            --output </span><span class="si">{</span><span class="n">bm25_run_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">            --output-format trec </span><span class="se">\</span>
<span class="s2">            --batch 36 --threads 12 </span><span class="se">\</span>
<span class="s2">            --hits </span><span class="si">{</span><span class="n">n_hits</span><span class="o">*</span><span class="mi">10</span><span class="si">}</span><span class="s2"> --bm25 --remove-query</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">bm25_command</span><span class="p">,</span> 
            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span> 
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stderr output:&quot;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bm25_run_path</span>

<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">n_hits</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ranking_method</span><span class="p">,</span> <span class="n">sorting_method</span><span class="p">,</span> <span class="n">dummy_device_id</span><span class="p">,</span> <span class="n">device_id</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">model_savename</span> <span class="o">=</span> <span class="n">model_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">save_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run.</span><span class="si">{</span><span class="n">model_savename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ranking_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.n_hits=</span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2">.top_k=</span><span class="si">{</span><span class="n">top_k</span><span class="si">}</span><span class="s2">.txt&quot;</span>
    <span class="n">out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run.</span><span class="si">{</span><span class="n">model_savename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ranking_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.n_hits=</span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2">.top_k=</span><span class="si">{</span><span class="n">top_k</span><span class="si">}</span><span class="s2">.out&quot;</span>
    <span class="n">err_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;run.</span><span class="si">{</span><span class="n">model_savename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ranking_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.n_hits=</span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2">.top_k=</span><span class="si">{</span><span class="n">top_k</span><span class="si">}</span><span class="s2">.err&quot;</span>

    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">save_file</span><span class="p">)</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">out_file</span><span class="p">)</span>
    <span class="n">err_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">err_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> exists.. skipping.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">bm25_run_path</span> <span class="o">=</span> <span class="n">run_bm25</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">n_hits</span><span class="p">)</span>
    <span class="n">pyserini_index</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;beir-v1.0.0-</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">ranking_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;setwise&quot;</span><span class="p">,</span> <span class="s2">&quot;pairwise&quot;</span><span class="p">]:</span>
            <span class="c1"># . {activate_script} &amp;&amp; \</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        [[ -f </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok ]] || ( </span><span class="se">\</span>
<span class="s2">            CUDA_VISIBLE_DEVICES=</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> time python3 run.py </span><span class="se">\</span>
<span class="s2">            run --model_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --tokenizer_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --run_path </span><span class="si">{</span><span class="n">bm25_run_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --save_path </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --pyserini_index </span><span class="si">{</span><span class="n">pyserini_index</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --hits </span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --query_length 32 </span><span class="se">\</span>
<span class="s2">                --passage_length 128 </span><span class="se">\</span>
<span class="s2">                --scoring generation </span><span class="se">\</span>
<span class="s2">                --device cuda </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{</span><span class="n">ranking_method</span><span class="si">}</span><span class="s2"> --method </span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                            --k </span><span class="si">{</span><span class="n">top_k</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                &amp;&amp; touch </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok </span><span class="se">\</span>
<span class="s2">        ) 2&gt;&amp;1 | tee </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.all</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">ranking_method</span> <span class="o">==</span> <span class="s2">&quot;listwise&quot;</span><span class="p">:</span>
            <span class="c1"># . {activate_script} &amp;&amp; \</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        [[ -f </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok ]] || ( </span><span class="se">\</span>
<span class="s2">            CUDA_VISIBLE_DEVICES=</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> time python3 run.py </span><span class="se">\</span>
<span class="s2">            run --model_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --tokenizer_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --run_path </span><span class="si">{</span><span class="n">bm25_run_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --save_path </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --pyserini_index </span><span class="si">{</span><span class="n">pyserini_index</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --hits </span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --query_length 32 </span><span class="se">\</span>
<span class="s2">                --passage_length 100 </span><span class="se">\</span>
<span class="s2">                --scoring </span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --device cuda </span><span class="se">\</span>
<span class="s2">            listwise --window_size 4 </span><span class="se">\</span>
<span class="s2">                    --step_size 2 </span><span class="se">\</span>
<span class="s2">                    --num_repeat 5 </span><span class="se">\</span>
<span class="s2">                &amp;&amp; touch </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok </span><span class="se">\</span>
<span class="s2">        ) 2&gt;&amp;1 | tee </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.all</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">ranking_method</span> <span class="o">==</span> <span class="s2">&quot;pointwise&quot;</span><span class="p">:</span>
            <span class="c1"># . {activate_script} &amp;&amp; \</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        [[ -f </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok ]] || ( </span><span class="se">\</span>
<span class="s2">            CUDA_VISIBLE_DEVICES=</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> time python3 run.py </span><span class="se">\</span>
<span class="s2">            run --model_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --tokenizer_name_or_path </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --run_path </span><span class="si">{</span><span class="n">bm25_run_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --save_path </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --pyserini_index </span><span class="si">{</span><span class="n">pyserini_index</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --hits </span><span class="si">{</span><span class="n">n_hits</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                --query_length 32 </span><span class="se">\</span>
<span class="s2">                --passage_length 128 </span><span class="se">\</span>
<span class="s2">                --device cuda </span><span class="se">\</span>
<span class="s2">            pointwise --method </span><span class="si">{</span><span class="n">sorting_method</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                        --batch_size 32 </span><span class="se">\</span>
<span class="s2">                &amp;&amp; touch </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.ok </span><span class="se">\</span>
<span class="s2">        ) 2&gt;&amp;1 | tee </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.all</span>
<span class="s2">        &quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INVALID RANKING METHOD: </span><span class="si">{</span><span class="n">ranking_method</span><span class="si">}</span><span class="s2">. Skipping..&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running command: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">..&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">err_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span> 
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="c1"># if process.stderr:</span>
            <span class="c1">#     print(&quot;stderr output:&quot;, process.stderr)</span>

            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command failed with return code </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># if __name__ == &quot;__main__&quot;:</span>
<span class="k">def</span> <span class="nf">launch_loop</span><span class="p">():</span>
    <span class="n">default_device_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">combinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n_hits</span> <span class="ow">in</span> <span class="n">n_hits_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ranking_method</span> <span class="ow">in</span> <span class="n">ranking_method_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sorting_method</span> <span class="ow">in</span> <span class="n">sorting_method_names</span><span class="p">[</span><span class="n">ranking_method</span><span class="p">]:</span>
                        <span class="n">device_id</span> <span class="o">=</span> <span class="n">default_device_id</span>
                        <span class="n">combinations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_hits</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ranking_method</span><span class="p">,</span> <span class="n">sorting_method</span><span class="p">,</span> <span class="n">device_id</span><span class="p">))</span>

    <span class="c1"># TODO update combinations so that each combination has a device_id assigned from device_ids</span>
    <span class="n">combinations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="o">*</span><span class="n">comb</span><span class="p">,</span> <span class="n">device_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comb</span><span class="p">,</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">combinations</span><span class="p">,</span> <span class="n">device_ids</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)))</span>
    <span class="p">]</span>
    
    <span class="c1"># TODO output combinations to stdout for debugging</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Combinations:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span><span class="si">}</span><span class="s2"> experiments..&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">npar</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">run_experiment</span><span class="p">,</span> <span class="n">combinations</span><span class="p">)</span>

<span class="c1"># launch_loop() UNCOMMENT TO RUN</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="load-published-metrics">
<h1>LOAD PUBLISHED METRICS<a class="headerlink" href="#load-published-metrics" title="Link to this heading">#</a></h1>
<p>After using GPT 4o to OCR the tables from the author’s paper and converting the data into an HTML table, we use the following code to extract the data and put them into dataframes.</p>
<section id="zhuang-table2-ocr-0011">
<h2>Zhuang_table2_ocr_0011()<a class="headerlink" href="#zhuang-table2-ocr-0011" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">Zhuang_table2_ocr_0012</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts HTML table data into a DataFrame with columns matching our other tables.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        html_content (str): HTML content containing the table data</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: DataFrame with columns Source, LLM, Dataset, MainMethod, SubMethod, </span>
<span class="sd">                         Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/lenny/repllmr/doc/Zhuang_table2_ocr_0012.html&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Extract metric names from header</span>
    <span class="n">thead</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;thead&#39;</span><span class="p">)</span>
    <span class="n">header_rows</span> <span class="o">=</span> <span class="n">thead</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
    
    <span class="c1"># Get metric names from second header row</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">header_rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">th</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Metric:&#39;</span><span class="p">):</span>
            <span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">th</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Metric:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="c1"># Define column indices for both datasets</span>
    <span class="n">trec_2019_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>  <span class="c1"># Columns 3-7 for TREC DL 2019</span>
    <span class="n">trec_2020_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># Columns 8-12 for TREC DL 2020</span>
    
    <span class="c1"># Find all rows in tbody</span>
    <span class="n">tbody</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">)</span>
    <span class="n">current_llm</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tbody</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
        <span class="c1"># Check if this is an LLM header row</span>
        <span class="n">colspan_cell</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;colspan&#39;</span><span class="p">:</span> <span class="s1">&#39;11&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">colspan_cell</span><span class="p">:</span>
            <span class="n">current_llm</span> <span class="o">=</span> <span class="n">colspan_cell</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;LLM:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">continue</span>
            
        <span class="n">cells</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>
        
        <span class="c1"># Skip if this is a header row or we haven&#39;t found an LLM yet</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_llm</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>  <span class="c1"># Ensure we have all columns</span>
            <span class="k">continue</span>
            
        <span class="n">method_full</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># Skip empty method rows</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method_full</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Split method into main and sub methods</span>
        <span class="n">main_method</span><span class="p">,</span> <span class="n">sub_method</span> <span class="o">=</span> <span class="n">method_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">method_full</span> <span class="k">else</span> <span class="p">(</span><span class="n">method_full</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Process metrics for TREC DL 2019</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">trec_2019_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;ZhuangTable2&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">current_llm</span><span class="p">,</span>
                        <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="s1">&#39;TREC DL 2019&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">main_method</span><span class="p">,</span>
                        <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">sub_method</span><span class="p">,</span>
                        <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric</span><span class="p">,</span>
                        <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">value</span>
                    <span class="p">})</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">continue</span>
        
        <span class="c1"># Process metrics for TREC DL 2020</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">trec_2020_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;ZhuangTable2&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">current_llm</span><span class="p">,</span>
                        <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="s1">&#39;TREC DL 2020&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">main_method</span><span class="p">,</span>
                        <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">sub_method</span><span class="p">,</span>
                        <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric</span><span class="p">,</span>
                        <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">value</span>
                    <span class="p">})</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">continue</span>
    
    <span class="c1"># Create DataFrame with specified columns</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">Zhuang_table2_ocr_0012</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;Zhuang_table2_ocr_0012&#39;</span><span class="p">,</span> <span class="n">Zhuang_table2_ocr_0012</span><span class="p">)</span>

<span class="c1"># Zhuang_table2_ocr_0011 = Zhuang_table2_ocr_0011()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Zhuang_table2_ocr_0012</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>

<span class="c1"># print(Zhuang_table2_ocr_0011.shape)</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zhuang_table2_ocr_0012</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 254 entries, 0 to 253
Data columns (total 8 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   Source        254 non-null    object
 1   LLM           254 non-null    object
 2   Dataset       254 non-null    object
 3   MainMethod    254 non-null    object
 4   SubMethod     254 non-null    object
 5   Parameters    254 non-null    object
 6   Metric_Name   254 non-null    object
 7   Metric_Value  254 non-null    object
dtypes: object(8)
memory usage: 16.0+ KB
None
</pre></div>
</div>
</div>
</div>
</section>
<section id="zhuang-table3-ocr-0011">
<h2>Zhuang_table3_ocr_0011()<a class="headerlink" href="#zhuang-table3-ocr-0011" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">def</span> <span class="nf">Zhuang_table3_ocr_0011</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts HTML table data into a DataFrame with columns matching beir_metrics_measured_by_lesner format.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: DataFrame with columns Source, LLM, Dataset, MainMethod, SubMethod, </span>
<span class="sd">                         Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/lenny/repllmr/doc/Zhuang_table3_ocr_0011.html&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">html_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Parse HTML</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Find all h2 tags containing LLM names</span>
    <span class="n">llm_sections</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">llm_sections</span><span class="p">:</span>
        <span class="c1"># Extract LLM name</span>
        <span class="n">llm_name</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;LLM: &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># Find the next table after this h2</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_next</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Convert table to DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Get dataset names (excluding &#39;#&#39;, &#39;Methods&#39;, and &#39;Avg&#39;)</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="c1"># Process each row</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">method_full</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Methods&#39;</span><span class="p">]</span>
            
            <span class="c1"># Split method into main and sub methods</span>
            <span class="n">main_method</span><span class="p">,</span> <span class="n">sub_method</span> <span class="o">=</span> <span class="n">method_full</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">method_full</span> <span class="k">else</span> <span class="p">(</span><span class="n">method_full</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            
            <span class="c1"># Create a row for each dataset</span>
            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span>
                <span class="n">data_row</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;ZhuangTable3&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">llm_name</span><span class="p">,</span>
                    <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">,</span>
                    <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">main_method</span><span class="p">,</span>
                    <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">sub_method</span><span class="p">,</span>
                    <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="s1">&#39;ndcg_cut_10&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_row</span><span class="p">)</span>
    
    <span class="c1"># Create DataFrame with specified columns</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>



<span class="n">Zhuang_table3_ocr_0011</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;Zhuang_table3_ocr_0011&#39;</span><span class="p">,</span> <span class="n">Zhuang_table3_ocr_0011</span><span class="p">)</span>

<span class="c1"># Zhuang_table3_ocr_0011 = Zhuang_table3_ocr_0011()</span>

<span class="c1"># print(Zhuang_table3_ocr_0011.info())</span>

<span class="c1"># Zhuang_table3_ocr_0011</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zhuang_table3_ocr_0011</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="load-measured-metrics">
<h1>LOAD MEASURED METRICS<a class="headerlink" href="#load-measured-metrics" title="Link to this heading">#</a></h1>
<section id="eval-measurements">
<h2>eval_measurements()<a class="headerlink" href="#eval-measurements" title="Link to this heading">#</a></h2>
<section id="v3">
<h3>v3<a class="headerlink" href="#v3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">eval_measurements</span><span class="p">():</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        set -e</span>
<span class="s2">        cd /home/lenny/repllmr/llm-rankers-new</span>

<span class="s2">        # merge measurements from GPU hosts h0-h6</span>
<span class="s2">        echo &quot;Processing h0-h6 files...&quot;</span>
<span class="s2">        mkdir -p output_files/beir/</span>
<span class="s2">        find output_files_h0* </span><span class="se">\\</span><span class="s2">( -name &#39;*.txt&#39; -o -name &#39;*.txt.eval&#39; -o -name &#39;*.out.all&#39; </span><span class="se">\\</span><span class="s2">) | </span>
<span class="s2">            grep -aiEv &#39;bm25&#39; |</span>
<span class="s2">            xargs -I</span><span class="si">{}</span><span class="s2"> cp </span><span class="si">{}</span><span class="s2"> output_files/beir/</span>

<span class="s2">        # merge measurements from GPU hosts h11-h15</span>
<span class="s2">        echo &quot;Processing h11-h15 files...&quot;</span>
<span class="s2">        mkdir -p output_files2/beir/</span>
<span class="s2">        find output_files_h1* </span><span class="se">\\</span><span class="s2">( -name &#39;*.txt&#39; -o -name &#39;*.txt.eval&#39; -o -name &#39;*.out.all&#39; </span><span class="se">\\</span><span class="s2">) |</span>
<span class="s2">            grep -aiEv &#39;bm25&#39; |</span>
<span class="s2">            xargs -I</span><span class="si">{}</span><span class="s2"> cp </span><span class="si">{}</span><span class="s2"> output_files2/beir/</span>

<span class="s2">        # create *.eval files for experiment metrics</span>
<span class="s2">        echo &quot;Starting evaluation of datasets...&quot;</span>
<span class="s2">        find output_files output_files2 -type f -name &#39;*.txt&#39; | grep flan | while read -r f; do</span>
<span class="s2">            dataset=$(echo &quot;$f&quot; | sed &#39;s/\.n_hits=100\.top_k=10\./\./g&#39; | </span>
<span class="s2">                     perl -ne &#39;m{^.*\.(.*?)\.txt} &amp;&amp; print &quot;$1&quot;&#39;)</span>
<span class="s2">            </span>
<span class="s2">            if [ ! -f &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot; ]; then</span>
<span class="s2">                echo &quot;</span><span class="se">\\</span><span class="s2">nProcessing dataset: $dataset&quot;</span>
<span class="s2">                echo &quot;File: $f&quot;</span>
<span class="s2">                python3 -m pyserini.eval.trec_eval -c -m ndcg_cut.10 &quot;beir-v1.0.0-$</span><span class="si">{dataset}</span><span class="s2">-test&quot; &quot;$f&quot; | tee &quot;$</span><span class="si">{f}</span><span class="s2">.eval&quot;</span>
<span class="s2">                touch &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot;</span>
<span class="s2">            else</span>
<span class="s2">                echo &quot;</span><span class="se">\\</span><span class="s2">nSkipping already processed dataset: $dataset&quot;</span>
<span class="s2">            fi</span>
<span class="s2">        done 2&gt;&amp;1 | tee beir_eval.log</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use Popen instead of run to get real-time output</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="n">command</span><span class="p">,</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>  <span class="c1"># Redirect stderr to stdout</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
            <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Line buffered</span>
            <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Print output in real-time</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># end=&#39;&#39; because the line already contains a newline</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># Ensure output is displayed immediately</span>

        <span class="c1"># Wait for process to complete and get return code</span>
        <span class="n">return_code</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">return_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span><span class="n">return_code</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
            
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Uncomment to run:</span>
<span class="c1"># eval_measurements()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="v2">
<h3>v2<a class="headerlink" href="#v2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">eval_measurements</span><span class="p">():</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        set -e</span>
<span class="s2">        cd /home/lenny/repllmr/llm-rankers-new</span>

<span class="s2">        # merge measurements from GPU hosts h0-h6</span>
<span class="s2">        mkdir -p output_files/beir/</span>
<span class="s2">        find output_files_h0* </span><span class="se">\\</span><span class="s2">( -name &#39;*.txt&#39; -o -name &#39;*.txt.eval&#39; -o -name &#39;*.out.all&#39; </span><span class="se">\\</span><span class="s2">) | </span>
<span class="s2">            grep -aiEv &#39;bm25&#39; |</span>
<span class="s2">            xargs -I</span><span class="si">{}</span><span class="s2"> cp </span><span class="si">{}</span><span class="s2"> output_files/beir/</span>

<span class="s2">        # merge measurements from GPU hosts h11-h15</span>
<span class="s2">        mkdir -p output_files2/beir/</span>
<span class="s2">        find output_files_h1* </span><span class="se">\\</span><span class="s2">( -name &#39;*.txt&#39; -o -name &#39;*.txt.eval&#39; -o -name &#39;*.out.all&#39; </span><span class="se">\\</span><span class="s2">) |</span>
<span class="s2">            grep -aiEv &#39;bm25&#39; |</span>
<span class="s2">            xargs -I</span><span class="si">{}</span><span class="s2"> cp </span><span class="si">{}</span><span class="s2"> output_files2/beir/</span>

<span class="s2">        # create *.eval files for experiment metrics</span>
<span class="s2">        find output_files output_files2 -type f -name &#39;*.txt&#39; | grep flan | while read -r f; do</span>
<span class="s2">            dataset=$(echo &quot;$f&quot; | sed &#39;s/\.n_hits=100\.top_k=10\./\./g&#39; | </span>
<span class="s2">                     perl -ne &#39;m{^.*\.(.*?)\.txt} &amp;&amp; print &quot;$1&quot;&#39;)</span>
<span class="s2">            </span>
<span class="s2">            if [ ! -f &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot; ]; then</span>
<span class="s2">                echo &quot;Processing dataset: $dataset, file: $f&quot;</span>
<span class="s2">                python3 -m pyserini.eval.trec_eval -c -m ndcg_cut.10 &quot;beir-v1.0.0-$</span><span class="si">{dataset}</span><span class="s2">-test&quot; &quot;$f&quot; &gt; &quot;$</span><span class="si">{f}</span><span class="s2">.eval&quot;</span>
<span class="s2">                touch &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot;</span>
<span class="s2">            fi</span>
<span class="s2">        done 2&gt;&amp;1 | tee beir_eval.log</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;/bin/bash&#39;</span><span class="p">)</span>  <span class="c1"># Explicitly use bash</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command failed with return code </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stdout: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> 
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Uncomment to run:</span>
<span class="c1"># eval_measurements()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="v1">
<h3>v1<a class="headerlink" href="#v1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">eval_measurements</span><span class="p">():</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            cd /home/lenny/repllmr/llm-rankers-new</span>

<span class="s2">            # merge measurements from GPU hosts h0-h6</span>
<span class="s2">            mkdir -p output_files/beir/ || true</span>
<span class="s2">            (</span>
<span class="s2">                find output_files_h0* -name &#39;*.txt&#39; </span>
<span class="s2">                find output_files_h0* -name &#39;*.txt.eval&#39; </span>
<span class="s2">                find output_files_h0* -name &#39;*.txt&#39; </span><span class="se">\</span>
<span class="s2">                    | perl -pe&#39;s{.txt$}{.out.all}&#39; </span>
<span class="s2">            ) </span><span class="se">\</span>
<span class="s2">                | egrep -avi bm25 </span><span class="se">\</span>
<span class="s2">                | xargs -i cp </span><span class="si">{}</span><span class="s2"> output_files/beir/</span>

<span class="s2">            </span>
<span class="s2">            # merge measurements from GPU hosts h11-h15</span>
<span class="s2">            mkdir -p output_files2/beir/  || true</span>
<span class="s2">            (</span>
<span class="s2">                find output_files_h1* -name &#39;*.txt&#39; </span>
<span class="s2">                find output_files_h1* -name &#39;*.txt.eval&#39; </span>
<span class="s2">                find output_files_h1* -name &#39;*.txt&#39;  </span><span class="se">\</span>
<span class="s2">                    | perl -pe&#39;s{.txt$}{.out.all}&#39; </span>
<span class="s2">            ) </span><span class="se">\</span>
<span class="s2">                | egrep -avi bm25 </span><span class="se">\</span>
<span class="s2">                | xargs -i cp </span><span class="si">{}</span><span class="s2"> output_files2/beir/</span>

<span class="s2">            # create *.eval files which we read for experiment metrics             </span>
<span class="s2">            (</span>
<span class="s2">                find output_files output_files2 </span><span class="se">\</span>
<span class="s2">                | egrep flan </span><span class="se">\</span>
<span class="s2">                | egrep &#39;.txt$&#39; </span><span class="se">\</span>
<span class="s2">                | while read f ; do</span>
<span class="s2">                    #  dataset=$(echo $f | perl -ne&#39;m{^.*\.(.*?)\.txt} &amp;&amp; print &quot;$1</span><span class="se">\n</span><span class="s2">&quot;;&#39;)</span>
<span class="s2">                    dataset=$(echo $f | perl -pe&#39;s{\.n_hits=100.top_k=10\.}{.}g;&#39; | perl -ne&#39;m{^.*\.(.*?)\.txt} &amp;&amp; print &quot;$1</span><span class="se">\n</span><span class="s2">&quot;;&#39;)</span>
<span class="s2">                    echo python3 -m pyserini.eval.trec_eval -c -m ndcg_cut.10 &quot;beir-v1.0.0-$</span><span class="si">{dataset}</span><span class="s2">-test&quot; &quot;$f&quot; </span>
<span class="s2">                    [[ -f &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot; ]] || ( ( python3 -m pyserini.eval.trec_eval -c -m ndcg_cut.10 &quot;beir-v1.0.0-$</span><span class="si">{dataset}</span><span class="s2">-test&quot; &quot;$f&quot; &gt; &quot;$</span><span class="si">{f}</span><span class="s2">.eval&quot; ) &amp;&amp; touch &quot;$</span><span class="si">{f}</span><span class="s2">.ek&quot;)</span>
<span class="s2">                done</span>
<span class="s2">            ) 2&gt;&amp;1 | tee beir_eval.log</span>

<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the command and capture output</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> 
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">)</span>
            
        <span class="c1"># Process the output lines</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span> 
        
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    

<span class="c1"># eval_measurements() # disabled till needed to add new data</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="bm25-metrics-measured-by-lesner">
<h2>bm25_metrics_measured_by_lesner()<a class="headerlink" href="#bm25-metrics-measured-by-lesner" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">bm25_metrics_measured_by_lesner</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a shell command and processes BM25 metrics into a standardized DataFrame format.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing parsed metrics with columns:</span>
<span class="sd">        Source, LLM, Dataset, MainMethod, SubMethod, Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s2">            &amp;&amp; find output_files </span><span class="se">\</span>
<span class="s2">                | egrep -ai bm25 </span><span class="se">\</span>
<span class="s2">                | egrep &#39;(.all|.eval)$&#39; </span><span class="se">\</span>
<span class="s2">                | xargs grep ^ </span><span class="se">\</span>
<span class="s2">                | egrep &#39;:Avg|:ndcg|elapse&#39; </span><span class="se">\</span>
<span class="s2">                | cut -d. -f2- </span><span class="se">\</span>
<span class="s2">                | perl -pe&#39;s{.100}</span><span class="si">{}</span><span class="s2">g; s{.out.all:}{:::}g;s{\s++all\s+}{ }g;s{elapsed.*$}</span><span class="si">{elapsed}</span><span class="s2">g; s{.txt.eval:}{:::}g;&#39; </span><span class="se">\</span>
<span class="s2">                | sort</span>
<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the command and capture output</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> 
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">)</span>
            
        <span class="c1"># Process the output lines</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">continue</span>
                
            <span class="c1"># Split on &#39;:::&#39; to separate components</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Extract components from the first part</span>
                <span class="n">method_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Extract metric name and value from second part</span>
                    <span class="n">metric_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">metric_value</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        
                        <span class="c1"># Map components to standardized format</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner v1&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 doesn&#39;t use an LLM</span>
                            <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">method_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># Last part is dataset</span>
                            <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;bm25&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span>  <span class="c1"># Default SubMethod for BM25</span>
                            <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 uses default parameters</span>
                            <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                            <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
                        <span class="p">})</span>
        
        <span class="c1"># Create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># Ensure all expected columns are present</span>
        <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expected_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="c1"># Return DataFrame with columns in specified order</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">expected_columns</span><span class="p">]</span>
        
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    


<span class="n">bm25_metrics_measured_by_lesner</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;bm25_metrics_measured_by_lesner&#39;</span><span class="p">,</span> <span class="n">bm25_metrics_measured_by_lesner</span><span class="p">)</span>

<span class="c1"># bm25_metrics_measured_by_lesner = bm25_metrics_measured_by_lesner()</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bm25_metrics_measured_by_lesner</span><span class="p">)</span>

<span class="n">bm25_metrics_measured_by_lesner</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>dbpedia-entity</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3180</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>nfcorpus</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3218</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>robust04</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4070</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>scifact</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6789</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>signal1m</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3304</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="bm25-metrics-measured-by-lesner2">
<h2>bm25_metrics_measured_by_lesner2()<a class="headerlink" href="#bm25-metrics-measured-by-lesner2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">bm25_metrics_measured_by_lesner2</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a shell command and processes BM25 metrics into a standardized DataFrame format.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing parsed metrics with columns:</span>
<span class="sd">        Source, LLM, Dataset, MainMethod, SubMethod, Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s2">            &amp;&amp; find output_files2 </span><span class="se">\</span>
<span class="s2">                | egrep -ai bm25 </span><span class="se">\</span>
<span class="s2">                | egrep &#39;(.all|.eval)$&#39; </span><span class="se">\</span>
<span class="s2">                | xargs grep ^ </span><span class="se">\</span>
<span class="s2">                | egrep &#39;:Avg|:ndcg|elapse&#39; </span><span class="se">\</span>
<span class="s2">                | cut -d. -f2- </span><span class="se">\</span>
<span class="s2">                | perl -pe&#39;s{.100}</span><span class="si">{}</span><span class="s2">g; s{.out.all:}{:::}g;s{\s++all\s+}{ }g;s{elapsed.*$}</span><span class="si">{elapsed}</span><span class="s2">g; s{.txt.eval:}{:::}g;&#39; </span><span class="se">\</span>
<span class="s2">                | sort</span>
<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the command and capture output</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> 
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">)</span>
            
        <span class="c1"># Process the output lines</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">continue</span>
                
            <span class="c1"># Split on &#39;:::&#39; to separate components</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Extract components from the first part</span>
                <span class="n">method_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Extract metric name and value from second part</span>
                    <span class="n">metric_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">metric_value</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        
                        <span class="c1"># Map components to standardized format</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner v2&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 doesn&#39;t use an LLM</span>
                            <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">method_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># Last part is dataset</span>
                            <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;bm25&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span>  <span class="c1"># Default SubMethod for BM25</span>
                            <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 uses default parameters</span>
                            <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                            <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
                        <span class="p">})</span>
        
        <span class="c1"># Create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># Ensure all expected columns are present</span>
        <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expected_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="c1"># Return DataFrame with columns in specified order</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">expected_columns</span><span class="p">]</span>
        
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
<span class="n">bm25_metrics_measured_by_lesner2</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;bm25_metrics_measured_by_lesner2&#39;</span><span class="p">,</span> <span class="n">bm25_metrics_measured_by_lesner2</span><span class="p">)</span>
<span class="c1"># bm25_metrics_measured_by_lesner2 = bm25_metrics_measured_by_lesner2()</span>


<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bm25_metrics_measured_by_lesner2</span><span class="p">)</span>

<span class="n">bm25_metrics_measured_by_lesner2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># bm25_metrics_measured_by_lesner2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="beir-metrics-measured-by-lesner">
<h2>beir_metrics_measured_by_lesner()<a class="headerlink" href="#beir-metrics-measured-by-lesner" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">beir_metrics_measured_by_lesner</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the metrics command and processes output into a structured DataFrame matching all_metrics_measured_by_dhaliwal format.</span>
<span class="sd">    Returns a pandas DataFrame with columns: Source, LLM, Dataset, MainMethod, SubMethod, Parameters, </span>
<span class="sd">    Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the command and capture output</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        (</span>
<span class="s1">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s1">            &amp;&amp; find output_files </span><span class="se">\</span>
<span class="s1">                    | egrep -avi .bm25. </span><span class="se">\</span>
<span class="s1">                    | egrep &#39;(.all|.eval)$&#39; </span><span class="se">\</span>
<span class="s1">                    | xargs grep ^ </span><span class="se">\</span>
<span class="s1">                    | egrep &#39;:Avg|:ndcg|elapse&#39; </span><span class="se">\</span>
<span class="s1">                    | cut -d. -f2- </span><span class="se">\</span>
<span class="s1">                    | perl -pe&#39;s{.n_hits=100.top_k=10}</span><span class="si">{}</span><span class="s1">g; s{.out.all:}{:::}g;s{\s++all\s+}{ }g;s{elapsed.*$}</span><span class="si">{elapsed}</span><span class="s1">g; s{.txt.eval:}{:::}g;&#39; </span><span class="se">\</span>
<span class="s1">                    | sort </span>
<span class="s1">        )</span>
<span class="s1">    &#39;&#39;&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">parse_elapsed_to_minutes</span><span class="p">(</span><span class="n">time_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert elapsed time string to minutes&quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># MM:SS format</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># HH:MM:SS format</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">seconds_to_minutes</span><span class="p">(</span><span class="n">seconds_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert seconds to minutes&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">seconds_str</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Initialize list to store the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_config</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process each line of the output</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">continue</span>
            
        <span class="c1"># Split the line into parts</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Parse the configuration part</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">current_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Parse the metrics part</span>
        <span class="n">value_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">metric_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metric_name</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="s1">&#39;elapsed&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">user_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+\.?\d*)user&#39;</span><span class="p">,</span> <span class="n">value_part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_match</span><span class="p">:</span>
                <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;User_Minutes&quot;</span>
                <span class="n">metric_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">seconds_to_minutes</span><span class="p">(</span><span class="n">user_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
            

            <span class="n">elapsed_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((?:\d+:)?\d+:\d+)elapsed&#39;</span><span class="p">,</span> <span class="n">value_part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elapsed_match</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">metric_name</span><span class="p">:</span>  <span class="c1"># Only add if we didn&#39;t already add user time</span>
                    <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Elapsed_Minutes&quot;</span>
                    <span class="n">metric_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">parse_elapsed_to_minutes</span><span class="p">(</span><span class="n">elapsed_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="s1">&#39;Avg comparisons:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_comparisons&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg completion tokens:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_completion_tokens&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg prompt tokens:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_Prompt_Tokens&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg time per query:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_time_per_query&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;ndcg_cut_10&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;ndcg_cut_10&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">and</span> <span class="n">metric_value</span> <span class="ow">and</span> <span class="n">current_config</span><span class="p">:</span>
            <span class="n">data_row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner v1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">],</span>
                <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">],</span>
                <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># Adding default parameter value</span>
                <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
            <span class="p">}</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_row</span><span class="p">)</span>

    <span class="c1"># Create DataFrame</span>
    <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">expected_columns</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>


<span class="c1"># beir_metrics_measured_by_lesner = beir_metrics_measured_by_lesner()</span>
<span class="n">beir_metrics_measured_by_lesner</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;beir_metrics_measured_by_lesner&#39;</span><span class="p">,</span> <span class="n">beir_metrics_measured_by_lesner</span><span class="p">)</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">analyze_distinct_elements</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner</span><span class="p">,</span> <span class="n">ignore_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>
<span class="n">print_distinct_elements</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      Source            LLM         Dataset MainMethod   SubMethod Parameters  \
0  Lesner v1  flan-t5-large  dbpedia-entity   listwise  generation       none   
1  Lesner v1  flan-t5-large  dbpedia-entity   listwise  generation       none   
2  Lesner v1  flan-t5-large  dbpedia-entity   listwise  generation       none   
3  Lesner v1  flan-t5-large  dbpedia-entity   listwise  generation       none   
4  Lesner v1  flan-t5-large  dbpedia-entity   listwise  generation       none   

             Metric_Name        Metric_Value  
0           User_Minutes              321.14  
1        Avg_comparisons               244.4  
2  Avg_completion_tokens             2200.98  
3      Avg_Prompt_Tokens         120273.0225  
4     Avg_time_per_query  47.970179012417795  

Source:
-------
&#39;Lesner v1&#39;: 809

LLM:
----
&#39;flan-t5-xl&#39;: 384
&#39;flan-t5-large&#39;: 363
&#39;flan-t5-xxl&#39;: 62

Dataset:
--------
&#39;trec-news&#39;: 110
&#39;signal1m&#39;: 108
&#39;nfcorpus&#39;: 104
&#39;trec-covid&#39;: 104
&#39;robust04&#39;: 102
&#39;webis-touche2020&#39;: 98
&#39;dbpedia-entity&#39;: 96
&#39;scifact&#39;: 87

MainMethod:
-----------
&#39;setwise&#39;: 229
&#39;pointwise&#39;: 207
&#39;pairwise&#39;: 187
&#39;listwise&#39;: 186

SubMethod:
----------
&#39;heapsort&#39;: 222
&#39;bubblesort&#39;: 194
&#39;qlm&#39;: 106
&#39;yes_no&#39;: 101
&#39;likelihood&#39;: 95
&#39;generation&#39;: 91

Parameters:
-----------
&#39;none&#39;: 809

Metric_Name:
------------
&#39;User_Minutes&#39;: 141
&#39;ndcg_cut_10&#39;: 136
&#39;Avg_comparisons&#39;: 133
&#39;Avg_completion_tokens&#39;: 133
&#39;Avg_Prompt_Tokens&#39;: 133
&#39;Avg_time_per_query&#39;: 133
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_display</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>321.14</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>244.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>2200.98</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>120273.0225</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>47.970179012417795</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3909</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>218.21</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>173.53896103896105</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>858.5422077922078</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>88850.9512987013</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>42.056214699497474</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3325</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>128.73</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1223.44578313253</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>125436.16064257028</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>30.360235692028063</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4412</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6510</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>118.59</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>3062.4123711340208</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>71080.82474226804</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>73.02510124875099</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3441</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>52.51</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1262.36</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>125330.86</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>62.05302348136902</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6924</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>29.77</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1222.0526315789473</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>125440.0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>30.41411020044695</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4283</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>61.91</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1448.530612244898</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>123888.63265306123</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>74.66175287597034</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>generation</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4411</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>84.42</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>244.4</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>98952.1975</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>12.437514665722848</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4429</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>94.97</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>173.53896103896105</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>81353.87337662338</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>18.024381461081568</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3339</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>60.11</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>116724.55020080322</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>13.932652586435218</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>robust04</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4754</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>87.37</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>244.71666666666667</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>119572.87</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>scifact</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>16.83246721982956</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>19.47</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>42006.42268041237</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>11.746851368048757</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>signal1m</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3097</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>20.57</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>116404.54</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>23.69229253292084</td>
    </tr>
    <tr>
      <th>77</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-covid</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.7564</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>12.94</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>116899.22807017544</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>12.814450853749326</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>trec-news</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4529</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>20.31</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>245.0</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>110055.57142857143</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>23.650449952300715</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>webis-touche2020</td>
      <td>listwise</td>
      <td>likelihood</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3275</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>387.89</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>773.33</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>7733.3</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>364205.49</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>57.97567339897156</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>dbpedia-entity</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4158</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>474.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>572.3668831168832</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>5723.668831168831</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Lesner v1</td>
      <td>flan-t5-large</td>
      <td>nfcorpus</td>
      <td>pairwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>352801.4025974026</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>709</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>8.81028307645352</td>
    </tr>
    <tr>
      <th>710</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3485</td>
    </tr>
    <tr>
      <th>711</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>49.02</td>
    </tr>
    <tr>
      <th>712</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>78.65863453815261</td>
    </tr>
    <tr>
      <th>713</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>393.2931726907631</td>
    </tr>
    <tr>
      <th>714</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>46227.13654618474</td>
    </tr>
    <tr>
      <th>715</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>10.739497069852899</td>
    </tr>
    <tr>
      <th>716</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.5176</td>
    </tr>
    <tr>
      <th>717</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>62.73</td>
    </tr>
    <tr>
      <th>718</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>75.62666666666667</td>
    </tr>
    <tr>
      <th>719</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>378.1333333333333</td>
    </tr>
    <tr>
      <th>720</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>44895.2</td>
    </tr>
    <tr>
      <th>721</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>11.82352306286494</td>
    </tr>
    <tr>
      <th>722</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6852</td>
    </tr>
    <tr>
      <th>723</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>9.75</td>
    </tr>
    <tr>
      <th>724</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>76.8659793814433</td>
    </tr>
    <tr>
      <th>725</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>384.3298969072165</td>
    </tr>
    <tr>
      <th>726</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>13149.80412371134</td>
    </tr>
    <tr>
      <th>727</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>5.343504207650411</td>
    </tr>
    <tr>
      <th>728</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>signal1m</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3003</td>
    </tr>
    <tr>
      <th>729</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>6.03</td>
    </tr>
    <tr>
      <th>730</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>79.62</td>
    </tr>
    <tr>
      <th>731</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>398.1</td>
    </tr>
    <tr>
      <th>732</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>46488.0</td>
    </tr>
    <tr>
      <th>733</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>6.279984006881714</td>
    </tr>
    <tr>
      <th>734</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.7676</td>
    </tr>
    <tr>
      <th>735</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>11.32</td>
    </tr>
    <tr>
      <th>736</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>76.63157894736842</td>
    </tr>
    <tr>
      <th>737</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>383.1578947368421</td>
    </tr>
    <tr>
      <th>738</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>45097.01754385965</td>
    </tr>
    <tr>
      <th>739</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>10.70993843831514</td>
    </tr>
    <tr>
      <th>740</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4821</td>
    </tr>
    <tr>
      <th>741</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>11.72</td>
    </tr>
    <tr>
      <th>742</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>79.06122448979592</td>
    </tr>
    <tr>
      <th>743</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>395.3061224489796</td>
    </tr>
    <tr>
      <th>744</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>44047.97959183674</td>
    </tr>
    <tr>
      <th>745</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>12.865801329515419</td>
    </tr>
    <tr>
      <th>746</th>
      <td>Lesner v1</td>
      <td>flan-t5-xl</td>
      <td>webis-touche2020</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.2805</td>
    </tr>
    <tr>
      <th>747</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>9.66</td>
    </tr>
    <tr>
      <th>748</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>749</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>750</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>751</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>7638.061855670103</td>
    </tr>
    <tr>
      <th>752</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>8.388595512232829</td>
    </tr>
    <tr>
      <th>753</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3075</td>
    </tr>
    <tr>
      <th>754</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1.43</td>
    </tr>
    <tr>
      <th>755</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1.68</td>
    </tr>
    <tr>
      <th>756</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>webis-touche2020</td>
      <td>pointwise</td>
      <td>qlm</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>2.17</td>
    </tr>
    <tr>
      <th>757</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>2.88</td>
    </tr>
    <tr>
      <th>758</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>13.3</td>
    </tr>
    <tr>
      <th>759</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>760</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>761</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>8538.061855670103</td>
    </tr>
    <tr>
      <th>762</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>8.547955670307593</td>
    </tr>
    <tr>
      <th>763</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>signal1m</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.2758</td>
    </tr>
    <tr>
      <th>764</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1.17</td>
    </tr>
    <tr>
      <th>765</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1.66</td>
    </tr>
    <tr>
      <th>766</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>webis-touche2020</td>
      <td>pointwise</td>
      <td>yes_no</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>767</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>869.13</td>
    </tr>
    <tr>
      <th>768</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>306.63</td>
    </tr>
    <tr>
      <th>769</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1533.15</td>
    </tr>
    <tr>
      <th>770</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>181000.06666666668</td>
    </tr>
    <tr>
      <th>771</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>204.95267143408458</td>
    </tr>
    <tr>
      <th>772</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.7471</td>
    </tr>
    <tr>
      <th>773</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>1114.01</td>
    </tr>
    <tr>
      <th>774</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>299.719298245614</td>
    </tr>
    <tr>
      <th>775</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>1498.5964912280701</td>
    </tr>
    <tr>
      <th>776</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>175317.01754385966</td>
    </tr>
    <tr>
      <th>777</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>1267.979289736664</td>
    </tr>
    <tr>
      <th>778</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>bubblesort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4802</td>
    </tr>
    <tr>
      <th>779</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>166.66</td>
    </tr>
    <tr>
      <th>780</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>56.55844155844156</td>
    </tr>
    <tr>
      <th>781</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>282.7922077922078</td>
    </tr>
    <tr>
      <th>782</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>32647.41233766234</td>
    </tr>
    <tr>
      <th>783</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>38.13887919311399</td>
    </tr>
    <tr>
      <th>784</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>nfcorpus</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3512</td>
    </tr>
    <tr>
      <th>785</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>468.15</td>
    </tr>
    <tr>
      <th>786</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>79.97991967871486</td>
    </tr>
    <tr>
      <th>787</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>399.8995983935743</td>
    </tr>
    <tr>
      <th>788</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>47007.71887550201</td>
    </tr>
    <tr>
      <th>789</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>122.20560804619846</td>
    </tr>
    <tr>
      <th>790</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>robust04</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.5042</td>
    </tr>
    <tr>
      <th>791</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>217.8</td>
    </tr>
    <tr>
      <th>792</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>76.84666666666666</td>
    </tr>
    <tr>
      <th>793</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>384.23333333333335</td>
    </tr>
    <tr>
      <th>794</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>45637.346666666665</td>
    </tr>
    <tr>
      <th>795</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>51.91143738985062</td>
    </tr>
    <tr>
      <th>796</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>scifact</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.7388</td>
    </tr>
    <tr>
      <th>797</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>198.81</td>
    </tr>
    <tr>
      <th>798</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>80.22</td>
    </tr>
    <tr>
      <th>799</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>401.1</td>
    </tr>
    <tr>
      <th>800</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>46903.88</td>
    </tr>
    <tr>
      <th>801</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>255.76965364456177</td>
    </tr>
    <tr>
      <th>802</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-covid</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.7508</td>
    </tr>
    <tr>
      <th>803</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>User_Minutes</td>
      <td>219.18</td>
    </tr>
    <tr>
      <th>804</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_comparisons</td>
      <td>77.56140350877193</td>
    </tr>
    <tr>
      <th>805</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_completion_tokens</td>
      <td>387.8070175438597</td>
    </tr>
    <tr>
      <th>806</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_Prompt_Tokens</td>
      <td>45628.59649122807</td>
    </tr>
    <tr>
      <th>807</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>Avg_time_per_query</td>
      <td>250.4395815489585</td>
    </tr>
    <tr>
      <th>808</th>
      <td>Lesner v1</td>
      <td>flan-t5-xxl</td>
      <td>trec-news</td>
      <td>setwise</td>
      <td>heapsort</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4639</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="beir-metrics-measured-by-lesner2">
<h2>beir_metrics_measured_by_lesner2()<a class="headerlink" href="#beir-metrics-measured-by-lesner2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">beir_metrics_measured_by_lesner2</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the metrics command and processes output into a structured DataFrame matching all_metrics_measured_by_dhaliwal format.</span>
<span class="sd">    Returns a pandas DataFrame with columns: Source, LLM, Dataset, MainMethod, SubMethod, Parameters, </span>
<span class="sd">    Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the command and capture output</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        (</span>
<span class="s1">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s1">            &amp;&amp; find output_files2 </span><span class="se">\</span>
<span class="s1">                    | egrep -avi .bm25. </span><span class="se">\</span>
<span class="s1">                    | egrep &#39;(.all|.eval)$&#39; </span><span class="se">\</span>
<span class="s1">                    | xargs grep ^ </span><span class="se">\</span>
<span class="s1">                    | egrep &#39;:Avg|:ndcg|elapse&#39; </span><span class="se">\</span>
<span class="s1">                    | cut -d. -f2- </span><span class="se">\</span>
<span class="s1">                    | perl -pe&#39;s{.n_hits=100.top_k=10}</span><span class="si">{}</span><span class="s1">g; s{.out.all:}{:::}g;s{\s++all\s+}{ }g;s{elapsed.*$}</span><span class="si">{elapsed}</span><span class="s1">g; s{.txt.eval:}{:::}g;&#39; </span><span class="se">\</span>
<span class="s1">                    | sort </span>
<span class="s1">        )</span>
<span class="s1">    &#39;&#39;&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">parse_elapsed_to_minutes</span><span class="p">(</span><span class="n">time_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert elapsed time string to minutes&quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># MM:SS format</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># HH:MM:SS format</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">seconds_to_minutes</span><span class="p">(</span><span class="n">seconds_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert seconds to minutes&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">seconds_str</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Initialize list to store the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_config</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Process each line of the output</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">continue</span>
            
        <span class="c1"># Split the line into parts</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Parse the configuration part</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">current_config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Parse the metrics part</span>
        <span class="n">value_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">metric_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metric_name</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="s1">&#39;elapsed&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">user_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+\.?\d*)user&#39;</span><span class="p">,</span> <span class="n">value_part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_match</span><span class="p">:</span>
                <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;User_Minutes&quot;</span>
                <span class="n">metric_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">seconds_to_minutes</span><span class="p">(</span><span class="n">user_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
            
            <span class="c1"># TODO WHY NOT both User_Minutes and Elapsed_Minutes? WHY ARE THEY DIFFERENT METRIC NAMES?</span>
            <span class="n">elapsed_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((?:\d+:)?\d+:\d+)elapsed&#39;</span><span class="p">,</span> <span class="n">value_part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elapsed_match</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">metric_name</span><span class="p">:</span>  <span class="c1"># Only add if we didn&#39;t already add user time</span>
                    <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Elapsed_Minutes&quot;</span>
                    <span class="n">metric_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">parse_elapsed_to_minutes</span><span class="p">(</span><span class="n">elapsed_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="s1">&#39;Avg comparisons:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_comparisons&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg completion tokens:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_completion_tokens&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg prompt tokens:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_Prompt_Tokens&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Avg time per query:&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;Avg_time_per_query&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;ndcg_cut_10&#39;</span> <span class="ow">in</span> <span class="n">value_part</span><span class="p">:</span>
            <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;ndcg_cut_10&quot;</span>
            <span class="n">metric_value</span> <span class="o">=</span> <span class="n">value_part</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">and</span> <span class="n">metric_value</span> <span class="ow">and</span> <span class="n">current_config</span><span class="p">:</span>
            <span class="n">data_row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner v2&#39;</span><span class="p">,</span>
                <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">],</span>
                <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">],</span>
                <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">current_config</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># Adding default parameter value</span>
                <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
            <span class="p">}</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_row</span><span class="p">)</span>

    <span class="c1"># Create DataFrame</span>
    <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">expected_columns</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>


<span class="n">beir_metrics_measured_by_lesner2</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;beir_metrics_measured_by_lesner2&#39;</span><span class="p">,</span> <span class="n">beir_metrics_measured_by_lesner2</span><span class="p">)</span>


<span class="c1"># beir_metrics_measured_by_lesner2 = beir_metrics_measured_by_lesner2()</span>

<span class="n">beir_metrics_measured_by_lesner2</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">analyze_distinct_elements</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner2</span><span class="p">,</span> <span class="n">ignore_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>
<span class="n">print_distinct_elements</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>


<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beir_metrics_measured_by_lesner2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 585 entries, 0 to 584
Data columns (total 8 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   Source        585 non-null    object
 1   LLM           585 non-null    object
 2   Dataset       585 non-null    object
 3   MainMethod    585 non-null    object
 4   SubMethod     585 non-null    object
 5   Parameters    585 non-null    object
 6   Metric_Name   585 non-null    object
 7   Metric_Value  585 non-null    object
dtypes: object(8)
memory usage: 36.7+ KB

Source:
-------
&#39;Lesner v2&#39;: 585

LLM:
----
&#39;flan-t5-large&#39;: 283
&#39;flan-t5-xl&#39;: 277
&#39;flan-t5-xxl&#39;: 25

Dataset:
--------
&#39;webis-touche2020&#39;: 84
&#39;trec-covid&#39;: 79
&#39;scifact&#39;: 72
&#39;robust04&#39;: 72
&#39;signal1m&#39;: 72
&#39;trec-news&#39;: 72
&#39;nfcorpus&#39;: 68
&#39;dbpedia-entity&#39;: 66

MainMethod:
-----------
&#39;setwise&#39;: 207
&#39;pointwise&#39;: 192
&#39;pairwise&#39;: 186

SubMethod:
----------
&#39;heapsort&#39;: 210
&#39;bubblesort&#39;: 183
&#39;qlm&#39;: 96
&#39;yes_no&#39;: 96

Parameters:
-----------
&#39;none&#39;: 585

Metric_Name:
------------
&#39;User_Minutes&#39;: 99
&#39;ndcg_cut_10&#39;: 98
&#39;Avg_comparisons&#39;: 97
&#39;Avg_completion_tokens&#39;: 97
&#39;Avg_Prompt_Tokens&#39;: 97
&#39;Avg_time_per_query&#39;: 97
</pre></div>
</div>
</div>
</div>
</section>
<section id="bm25-metrics-measured-by-dhaliwal">
<h2>bm25_metrics_measured_by_dhaliwal()<a class="headerlink" href="#bm25-metrics-measured-by-dhaliwal" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">bm25_metrics_measured_by_dhaliwal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a shell command and processes BM25 metrics into a standardized DataFrame format.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing parsed metrics with columns:</span>
<span class="sd">        Source, LLM, Dataset, MainMethod, SubMethod, Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s2">            &amp;&amp; find output_files_trec_01 </span><span class="se">\</span>
<span class="s2">                | egrep -ai bm25 </span><span class="se">\</span>
<span class="s2">                | egrep &#39;(.all|.eval)$&#39; </span><span class="se">\</span>
<span class="s2">                | xargs grep ^ </span><span class="se">\</span>
<span class="s2">                | egrep &#39;:Avg|:ndcg|elapse&#39; </span><span class="se">\</span>
<span class="s2">                | cut -d. -f2- </span><span class="se">\</span>
<span class="s2">                | perl -pe&#39;s{.100}</span><span class="si">{}</span><span class="s2">g; s{.out.all:}{:::}g;s{\s++all\s+}{ }g;s{elapsed.*$}</span><span class="si">{elapsed}</span><span class="s2">g; s{.txt.eval:}{:::}g;&#39; </span><span class="se">\</span>
<span class="s2">                | sort</span>
<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the command and capture output</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> 
                              <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> 
                <span class="n">command</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> 
                <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">)</span>
            
        <span class="c1"># Process the output lines</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">continue</span>
                
            <span class="c1"># Split on &#39;:::&#39; to separate components</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:::&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Extract components from the first part</span>
                <span class="n">method_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># Extract metric name and value from second part</span>
                    <span class="n">metric_parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">metric_value</span> <span class="o">=</span> <span class="n">metric_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        
                        <span class="c1"># Map components to standardized format</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Dhaliwal&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 doesn&#39;t use an LLM</span>
                            <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">method_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>  <span class="c1"># Last part is dataset</span>
                            <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;bm25&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span>  <span class="c1"># Default SubMethod for BM25</span>
                            <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>  <span class="c1"># BM25 uses default parameters</span>
                            <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                            <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
                        <span class="p">})</span>
        
        <span class="c1"># Create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># Ensure all expected columns are present</span>
        <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expected_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="c1"># Return DataFrame with columns in specified order</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">expected_columns</span><span class="p">]</span>
        
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running command: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    

<span class="n">bm25_metrics_measured_by_dhaliwal</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;bm25_metrics_measured_by_dhaliwal&#39;</span><span class="p">,</span> <span class="n">bm25_metrics_measured_by_dhaliwal</span><span class="p">)</span>

<span class="c1"># bm25_metrics_measured_by_dhaliwal = bm25_metrics_measured_by_dhaliwal()</span>

<span class="n">bm25_metrics_measured_by_dhaliwal</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="n">bm25_metrics_measured_by_dhaliwal</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bm25_metrics_measured_by_dhaliwal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3 entries, 0 to 2
Data columns (total 8 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   Source        3 non-null      object
 1   LLM           3 non-null      object
 2   Dataset       3 non-null      object
 3   MainMethod    3 non-null      object
 4   SubMethod     3 non-null      object
 5   Parameters    3 non-null      object
 6   Metric_Name   3 non-null      object
 7   Metric_Value  3 non-null      object
dtypes: object(8)
memory usage: 320.0+ bytes
</pre></div>
</div>
</div>
</div>
</section>
<section id="all-metrics-measured-by-dhaliwal">
<h2>all_metrics_measured_by_dhaliwal()<a class="headerlink" href="#all-metrics-measured-by-dhaliwal" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">all_metrics_measured_by_dhaliwal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the provided command and parses its output into a DataFrame with standardized columns.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        command (str): The shell command to execute</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing parsed metrics with columns:</span>
<span class="sd">        Source, LLM, Dataset, MainMethod, SubMethod, Parameters, Metric_Name, Metric_Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
        <span class="c1"># output_files </span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            cd /home/lenny/repllmr/llm-rankers-new </span><span class="se">\</span>
<span class="s2">                &amp;&amp; find output_files_trec_01 </span><span class="se">\</span>
<span class="s2">                    | egrep -avi /bm25/ </span><span class="se">\</span>
<span class="s2">                    | egrep &#39;\.eval$|\.out$&#39; </span><span class="se">\</span>
<span class="s2">                    | sort | xargs grep -a ^ </span><span class="se">\</span>
<span class="s2">                    | egrep -ai &#39;:Avg|:ndcg_cut&#39; </span><span class="se">\</span>
<span class="s2">                    | tr &quot;</span><span class="se">\t</span><span class="s2">&quot; &quot; &quot; </span><span class="se">\</span>
<span class="s2">                    | perl -pe&#39;</span>
<span class="s2">                        s{^.*?run.}</span><span class="si">{}</span><span class="s2">g; </span>
<span class="s2">                        s{.txt.eval}{.out}g; </span>
<span class="s2">                        s</span><span class="si">{allpair}{apair}</span><span class="s2">g; </span>
<span class="s2">                        s{Avg }</span><span class="si">{Avg_}</span><span class="s2">g; </span>
<span class="s2">                        s{ per }</span><span class="si">{_per_}</span><span class="s2">g; </span>
<span class="s2">                        s{ token}</span><span class="si">{_token}</span><span class="s2">g; </span>
<span class="s2">                        s{dl([0-9]</span><span class="si">{2}</span><span class="s2">).out}{dl$1.none.out}g; </span>
<span class="s2">                        s</span><span class="si">{noveleval.out}{noveleval.none.out}</span><span class="s2">g; </span>
<span class="s2">                        s{ *all *}{ }g; s{.out:}{:::}g;  </span>
<span class="s2">                        s{.top_k=10}{.none}g; </span>
<span class="s2">                        s{.n_hits=100.}{.}g; </span>
<span class="s2">                        s{:::ndcg_cut_10}{:::ndcg_cut_10:}g; </span>
<span class="s2">                        s</span><span class="si">{v1.5}{v1_5}</span><span class="s2">g; </span>
<span class="s2">                        s{Llama-3.1}{Llama-3_1}g; </span>
<span class="s2">                    &#39; </span><span class="se">\</span>
<span class="s2">                    | egrep -avi &#39;=&#39; </span><span class="se">\</span>
<span class="s2">                    | tr -s &quot; &quot;</span>
<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1">## TODO strip metrics with parameters </span>

    <span class="c1"># Run command and capture output</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">output_lines</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">SubProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing command: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Initialize lists to store data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Process each line of output</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output_lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">continue</span>
            
        <span class="c1"># Extract metric name and value using regex</span>
        <span class="n">metric_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.*:::([^:]+):\s*(.+)$&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric_match</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: No metric found in line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
            
        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">metric_value</span> <span class="o">=</span> <span class="n">metric_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># Get the prefix (everything before the metric)</span>
        <span class="c1"># prefix = line[:line.rindex(metric_name)].strip(&#39;.:&#39;)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">line</span>
        
        <span class="c1"># Parse the prefix parts using regex to handle parameters with periods</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^.]+)\.([^.]+)\.([^.]+)\.([^.]+)\.(.+):::.*$&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">llm</span><span class="p">,</span> <span class="n">main_method</span><span class="p">,</span> <span class="n">sub_method</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            
            <span class="c1"># # Convert metric value to float if possible</span>
            <span class="c1"># try:</span>
            <span class="c1">#     metric_value = float(metric_value)</span>
            <span class="c1"># except ValueError:</span>
            <span class="c1">#     pass  # Keep as string if not convertible to float</span>
            
            <span class="c1"># Add row to data</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="s1">&#39;Dhaliwal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;LLM&#39;</span><span class="p">:</span> <span class="n">llm</span><span class="p">,</span>
                <span class="s1">&#39;Dataset&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">,</span>
                <span class="s1">&#39;MainMethod&#39;</span><span class="p">:</span> <span class="n">main_method</span><span class="p">,</span>
                <span class="s1">&#39;SubMethod&#39;</span><span class="p">:</span> <span class="n">sub_method</span><span class="p">,</span>
                <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">,</span>
                <span class="s1">&#39;Metric_Name&#39;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                <span class="s1">&#39;Metric_Value&#39;</span><span class="p">:</span> <span class="n">metric_value</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not parse prefix in line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
    
    <span class="c1"># Create DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Ensure all expected columns are present</span>
    <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;MainMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;SubMethod&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expected_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
    <span class="c1"># Return DataFrame with columns in specified order</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">expected_columns</span><span class="p">]</span>


<span class="n">all_metrics_measured_by_dhaliwal</span> <span class="o">=</span> <span class="n">read_df_from_cache_or_create</span><span class="p">(</span><span class="s1">&#39;all_metrics_measured_by_dhaliwal&#39;</span><span class="p">,</span> <span class="n">all_metrics_measured_by_dhaliwal</span><span class="p">)</span>
<span class="c1"># all_metrics_measured_by_dhaliwal = all_metrics_measured_by_dhaliwal()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">analyze_distinct_elements</span><span class="p">(</span><span class="n">all_metrics_measured_by_dhaliwal</span><span class="p">,</span> <span class="n">ignore_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>
<span class="n">print_distinct_elements</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">df_merge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_metrics_measured_by_dhaliwal</span><span class="p">)</span>
<span class="n">all_metrics_measured_by_dhaliwal</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="c1"># all_metrics_measured_by_dhaliwal.info()</span>
<span class="c1"># all_metrics_measured_by_dhaliwal</span>

<span class="c1"># all_metrics_measured_by_dhaliwal[all_metrics_measured_by_dhaliwal[&#39;Dataset&#39;] == &#39;noveleval&#39;]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Source:
-------
&#39;Dhaliwal&#39;: 765

LLM:
----
&#39;flan-t5-large&#39;: 135
&#39;flan-t5-xl&#39;: 135
&#39;flan-t5-xxl&#39;: 135
&#39;Llama-2-13b-hf&#39;: 60
&#39;Llama-2-7b-hf&#39;: 60
&#39;Llama-3_1-8B-Instruct&#39;: 60
&#39;Llama-3_1-8B&#39;: 60
&#39;vicuna-13b-v1_5&#39;: 60
&#39;vicuna-7b-v1_5&#39;: 60

Dataset:
--------
&#39;dl19&#39;: 315
&#39;dl20&#39;: 315
&#39;noveleval&#39;: 135

MainMethod:
-----------
&#39;pairwise&#39;: 255
&#39;listwise&#39;: 210
&#39;setwise&#39;: 210
&#39;pointwise&#39;: 90

SubMethod:
----------
&#39;bubblesort&#39;: 210
&#39;heapsort&#39;: 210
&#39;generation&#39;: 105
&#39;likelihood&#39;: 105
&#39;apair&#39;: 45
&#39;qlm&#39;: 45
&#39;yes_no&#39;: 45

Parameters:
-----------
&#39;none&#39;: 765

Metric_Name:
------------
&#39;Avg_comparisons&#39;: 153
&#39;Avg_prompt_tokens&#39;: 153
&#39;Avg_completion_tokens&#39;: 153
&#39;Avg_time_per_query&#39;: 153
&#39;ndcg_cut_10&#39;: 153
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 765 entries, 0 to 764
Data columns (total 8 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   Source        765 non-null    object
 1   LLM           765 non-null    object
 2   Dataset       765 non-null    object
 3   MainMethod    765 non-null    object
 4   SubMethod     765 non-null    object
 5   Parameters    765 non-null    object
 6   Metric_Name   765 non-null    object
 7   Metric_Value  765 non-null    object
dtypes: object(8)
memory usage: 47.9+ KB
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="consolidate-metrics">
<h1>CONSOLIDATE METRICS<a class="headerlink" href="#consolidate-metrics" title="Link to this heading">#</a></h1>
<section id="dataframe-merging">
<h2>DataFrame Merging<a class="headerlink" href="#dataframe-merging" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">merge_dataframes()</span></code> function provides a robust mechanism for combining multiple DataFrames by:</p>
<ul class="simple">
<li><p>Validating input DataFrame list</p></li>
<li><p>Ensuring column consistency across DataFrames</p></li>
<li><p>Performing vertical concatenation (stacking)</p></li>
<li><p>Handling error cases with appropriate feedback</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_dataframes</span><span class="p">(</span><span class="n">dataframes_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dataframes_list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="c1"># Get first dataframe as reference</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">dataframes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># If only one dataframe, return it</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframes_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df1</span>
        
    <span class="c1"># Check all dataframes have same columns as first dataframe</span>
    <span class="n">all_cols_match</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    
    <span class="k">if</span> <span class="n">all_cols_match</span><span class="p">:</span>
        <span class="c1"># Concatenate all dataframes</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Column names don&#39;t match across dataframes&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">merged_df</span> <span class="o">=</span> <span class="n">merge_dataframes</span><span class="p">(</span><span class="n">df_merge_list</span><span class="p">)</span>
<span class="k">if</span> <span class="n">merged_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successfully merged dataframes&quot;</span><span class="p">)</span>

<span class="c1"># merged_df.info()</span>
<span class="c1"># results = analyze_distinct_elements(merged_df, ignore_columns=[&#39;Metric_Value&#39;])</span>
<span class="c1"># print_distinct_elements(results)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully merged dataframes
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-inspection">
<h2>Data Inspection<a class="headerlink" href="#data-inspection" title="Link to this heading">#</a></h2>
<p>A series of data quality checks and filtering operations to examine:</p>
<ul class="simple">
<li><p>Empty SubMethod entries</p></li>
<li><p>BM25-related entries (case-sensitive checks)</p></li>
<li><p>Data consistency across merged results</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ZhuangTable2</td>
      <td>Flan-t5-large</td>
      <td>TREC DL 2019</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>NDCG@10</td>
      <td>.506</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ZhuangTable2</td>
      <td>Flan-t5-large</td>
      <td>TREC DL 2020</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>NDCG@10</td>
      <td>.480</td>
    </tr>
    <tr>
      <th>254</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Covid</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.595</td>
    </tr>
    <tr>
      <th>255</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>NFCorpus</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.322</td>
    </tr>
    <tr>
      <th>256</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Touche</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.442</td>
    </tr>
    <tr>
      <th>257</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>DBPedia</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.318</td>
    </tr>
    <tr>
      <th>258</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>SciFact</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.679</td>
    </tr>
    <tr>
      <th>259</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Signal</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.331</td>
    </tr>
    <tr>
      <th>260</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>News</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.395</td>
    </tr>
    <tr>
      <th>261</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Robust04</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.407</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bm25&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>454</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>dbpedia-entity</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3180</td>
    </tr>
    <tr>
      <th>455</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>nfcorpus</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3218</td>
    </tr>
    <tr>
      <th>456</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>robust04</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4070</td>
    </tr>
    <tr>
      <th>457</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>scifact</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6789</td>
    </tr>
    <tr>
      <th>458</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>signal1m</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3304</td>
    </tr>
    <tr>
      <th>459</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>trec-covid</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.5947</td>
    </tr>
    <tr>
      <th>460</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>trec-news</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.3952</td>
    </tr>
    <tr>
      <th>461</th>
      <td>Lesner v1</td>
      <td>none</td>
      <td>webis-touche2020</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4422</td>
    </tr>
    <tr>
      <th>1856</th>
      <td>Dhaliwal</td>
      <td>none</td>
      <td>dl19</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.5058</td>
    </tr>
    <tr>
      <th>1857</th>
      <td>Dhaliwal</td>
      <td>none</td>
      <td>dl20</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.4796</td>
    </tr>
    <tr>
      <th>1858</th>
      <td>Dhaliwal</td>
      <td>none</td>
      <td>noveleval</td>
      <td>bm25</td>
      <td>classic</td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.6841</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_df</span><span class="p">[</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BM25&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>LLM</th>
      <th>Dataset</th>
      <th>MainMethod</th>
      <th>SubMethod</th>
      <th>Parameters</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ZhuangTable2</td>
      <td>Flan-t5-large</td>
      <td>TREC DL 2019</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>NDCG@10</td>
      <td>.506</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ZhuangTable2</td>
      <td>Flan-t5-large</td>
      <td>TREC DL 2020</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>NDCG@10</td>
      <td>.480</td>
    </tr>
    <tr>
      <th>254</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Covid</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.595</td>
    </tr>
    <tr>
      <th>255</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>NFCorpus</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.322</td>
    </tr>
    <tr>
      <th>256</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Touche</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.442</td>
    </tr>
    <tr>
      <th>257</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>DBPedia</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.318</td>
    </tr>
    <tr>
      <th>258</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>SciFact</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.679</td>
    </tr>
    <tr>
      <th>259</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Signal</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.331</td>
    </tr>
    <tr>
      <th>260</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>News</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.395</td>
    </tr>
    <tr>
      <th>261</th>
      <td>ZhuangTable3</td>
      <td>Flan-t5-large</td>
      <td>Robust04</td>
      <td>BM25</td>
      <td></td>
      <td>none</td>
      <td>ndcg_cut_10</td>
      <td>0.407</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="label-standardization">
<h2>Label Standardization<a class="headerlink" href="#label-standardization" title="Link to this heading">#</a></h2>
<p>A comprehensive set of standardization functions that normalize various data labels:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">standard_metric_name()</span></code>: Normalizes metric names (e.g., NDCG&#64;10, Latency)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_dataset_name()</span></code>: Standardizes dataset references (e.g., TrecDL19, SciFact)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_mainmethod_name()</span></code>: Normalizes method names (e.g., listwise, pairwise)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_submethod_name()</span></code>: Standardizes submethod references</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_llm()</span></code>: Normalizes LLM model names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard_source()</span></code>: Standardizes data source references</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">standard_metric_name</span><span class="p">(</span><span class="n">metric_name</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s1">&#39;NDCG@10&#39;</span><span class="p">:</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ndcg_cut_10&#39;</span><span class="p">:</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">,</span>

        <span class="s1">&#39;Latency (s)&#39;</span><span class="p">:</span> <span class="s1">&#39;Latency (s)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avg_Latency_Seconds&#39;</span><span class="p">:</span> <span class="s1">&#39;Latency (s)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avg_time_per_query&#39;</span><span class="p">:</span> <span class="s1">&#39;Latency (s)&#39;</span><span class="p">,</span>

        <span class="s1">&#39;Avg_Inferences&#39;</span><span class="p">:</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#Inferences&#39;</span><span class="p">:</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avg_comparisons&#39;</span><span class="p">:</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">,</span>

        <span class="s1">&#39;Avg_completion_tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avg_Generation_Tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Gen. tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;Avg_prompt_tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Avg_Prompt_Tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Pro. tokens&#39;</span><span class="p">:</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;User_Minutes&#39;</span><span class="p">:</span> <span class="s1">&#39;GPU Minutes &#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown metric: </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_dataset_name</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s1">&#39;dl19&#39;</span><span class="p">:</span> <span class="s1">&#39;TrecDL19&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TREC DL 2019&#39;</span><span class="p">:</span> <span class="s1">&#39;TrecDL19&#39;</span><span class="p">,</span>

        <span class="s1">&#39;dl20&#39;</span><span class="p">:</span> <span class="s1">&#39;TrecDL20&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TREC DL 2020&#39;</span><span class="p">:</span> <span class="s1">&#39;TrecDL20&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;noveleval&#39;</span><span class="p">:</span> <span class="s1">&#39;noveleval&#39;</span><span class="p">,</span>

        <span class="s1">&#39;signal1m&#39;</span><span class="p">:</span> <span class="s1">&#39;Signal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Signal&#39;</span><span class="p">:</span> <span class="s1">&#39;Signal&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;trec-news&#39;</span><span class="p">:</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span>
        <span class="s1">&#39;News&#39;</span><span class="p">:</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;scifact&#39;</span><span class="p">:</span> <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SciFact&#39;</span><span class="p">:</span> <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;robust04&#39;</span><span class="p">:</span> <span class="s1">&#39;Robust04&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Robust04&#39;</span><span class="p">:</span> <span class="s1">&#39;Robust04&#39;</span><span class="p">,</span>

        <span class="s1">&#39;nfcorpus&#39;</span><span class="p">:</span> <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NFCorpus&#39;</span><span class="p">:</span> <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span>

        <span class="s1">&#39;trec-covid&#39;</span><span class="p">:</span> <span class="s1">&#39;Covid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Covid&#39;</span><span class="p">:</span> <span class="s1">&#39;Covid&#39;</span><span class="p">,</span>

        <span class="s1">&#39;webis-touche2020&#39;</span><span class="p">:</span> <span class="s1">&#39;Touche&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Touche&#39;</span><span class="p">:</span> <span class="s1">&#39;Touche&#39;</span><span class="p">,</span>

        <span class="s1">&#39;dbpedia-entity&#39;</span><span class="p">:</span> <span class="s1">&#39;DBPedia&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DBPedia&#39;</span><span class="p">:</span> <span class="s1">&#39;DBPedia&#39;</span><span class="p">,</span>

    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown dataset: </span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_mainmethod_name</span><span class="p">(</span><span class="n">mainmethod_name</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;listwise&#39;</span><span class="p">:</span> <span class="s1">&#39;listwise&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise&#39;</span><span class="p">:</span> <span class="s1">&#39;setwise&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise&#39;</span><span class="p">:</span> <span class="s1">&#39;pairwise&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise&#39;</span><span class="p">:</span> <span class="s1">&#39;pointwise&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bm25&#39;</span><span class="p">:</span> <span class="s1">&#39;bm25&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BM25&#39;</span><span class="p">:</span> <span class="s1">&#39;bm25&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mainmethod_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown dataset: </span><span class="si">{</span><span class="n">mainmethod_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_submethod_name</span><span class="p">(</span><span class="n">submethod_name</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;heapsort&#39;</span><span class="p">:</span> <span class="s1">&#39;heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bubblesort&#39;</span><span class="p">:</span> <span class="s1">&#39;bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;generation&#39;</span><span class="p">:</span> <span class="s1">&#39;generation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="s1">&#39;likelihood&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qlm&#39;</span><span class="p">:</span> <span class="s1">&#39;qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yes_no&#39;</span><span class="p">:</span> <span class="s1">&#39;yes_no&#39;</span><span class="p">,</span>
        <span class="s1">&#39;apair&#39;</span><span class="p">:</span> <span class="s1">&#39;allpair&#39;</span><span class="p">,</span>
        <span class="s1">&#39;allpair&#39;</span><span class="p">:</span> <span class="s1">&#39;allpair&#39;</span><span class="p">,</span>
        <span class="s1">&#39;classic&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">submethod_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown dataset: </span><span class="si">{</span><span class="n">submethod_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_llm</span><span class="p">(</span><span class="n">llm</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;flan-t5-large&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Flan-t5-large&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span>
        <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Flan-t5-xl&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Flan-t5-xxl&#39;</span><span class="p">:</span> <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Llama-2-13b-hf&#39;</span><span class="p">:</span> <span class="s1">&#39;llama-2-13b-hf&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Llama-2-7b-hf&#39;</span><span class="p">:</span> <span class="s1">&#39;llama-2-7b-hf&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Llama-3_1-8B-Instruct&#39;</span><span class="p">:</span> <span class="s1">&#39;llama-3.1-8B-Instruct&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Llama-3_1-8B&#39;</span><span class="p">:</span> <span class="s1">&#39;llama-3.1-8B&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vicuna-13b-v1_5&#39;</span><span class="p">:</span> <span class="s1">&#39;vicuna-13b-v1.5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vicuna-7b-v1_5&#39;</span><span class="p">:</span> <span class="s1">&#39;vicuna-7b-v1.5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;none&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown LLM: </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_source</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ZhuangTable2&#39;</span><span class="p">:</span> <span class="s1">&#39;Zhuang&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ZhuangTable3&#39;</span><span class="p">:</span> <span class="s1">&#39;Zhuang&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dhaliwal&#39;</span><span class="p">:</span> <span class="s1">&#39;Dhaliwal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lesner v1&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lesner v2&#39;</span><span class="p">:</span> <span class="s1">&#39;Lesner2&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown source: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standard_source2</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ZhuangTable2&#39;</span><span class="p">:</span> <span class="s1">&#39;Published&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ZhuangTable3&#39;</span><span class="p">:</span> <span class="s1">&#39;Published&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dhaliwal&#39;</span><span class="p">:</span> <span class="s1">&#39;Measured&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lesner v1&#39;</span><span class="p">:</span> <span class="s1">&#39;Measured&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Lesner v2&#39;</span><span class="p">:</span> <span class="s1">&#39;Modified&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown source: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">apply_standardization</span><span class="p">(</span><span class="n">merged_df</span><span class="p">):</span>    
    <span class="n">standardized_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_metric_name</span><span class="p">)</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_dataset_name</span><span class="p">)</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_mainmethod_name</span><span class="p">)</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_submethod_name</span><span class="p">)</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_source2</span><span class="p">)</span>
    <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardized_df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">standard_llm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">standardized_df</span>

<span class="n">standardized_df</span> <span class="o">=</span> <span class="n">apply_standardization</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-adjustment-pipeline">
<h2>Data Adjustment Pipeline<a class="headerlink" href="#data-adjustment-pipeline" title="Link to this heading">#</a></h2>
<p>Two-stage data adjustment process:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">merge_adjustment1()</span></code>: Initial data cleaning and structuring:</p>
<ul class="simple">
<li><p>Numeric conversion</p></li>
<li><p>Empty string handling</p></li>
<li><p>Parameter validation</p></li>
<li><p>Method column creation</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge_adjustment()</span></code>: Advanced data refinement:</p>
<ul class="simple">
<li><p>Precision rounding</p></li>
<li><p>Column combining</p></li>
<li><p>Baseline filtering</p></li>
<li><p>Column reorganization</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_adjustment1</span><span class="p">(</span><span class="n">df0</span><span class="p">):</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

    <span class="c1"># map empty strings to None</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\s*)$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># drop rows that have a value other than empty for Parameters</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>

    <span class="c1"># Create combined Method column</span>
    <span class="c1"># df[&#39;Method&#39;] = df[&#39;MainMethod&#39;] + &#39;.&#39; + df[&#39;SubMethod&#39;] + &#39;_&#39; + df[&#39;Parameters&#39;]</span>


    <span class="c1"># TODO Method = MainMethod with SubMethod if SubMethod is not empty else just MainMethod</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span>



    <span class="c1"># df[&#39;Method&#39;] = df[&#39;MainMethod&#39;] + &#39;.&#39; + df[&#39;SubMethod&#39;]</span>
    <span class="c1"># df[&#39;Method&#39;] = df[&#39;Method&#39;].str.replace(&#39;_none&#39;, &#39;&#39;)</span>

    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">merge_adjustment</span><span class="p">(</span><span class="n">df0</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># df[&#39;Metric_Value&#39;] = pd.to_numeric(df[&#39;Metric_Value&#39;], errors=&#39;coerce&#39;)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># map empty strings to None</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\s*)$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># drop rows that have a value other than empty for Parameters</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
    

    <span class="c1"># Create Method column by combining MainMethod and SubMethod</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> 
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">])</span> 
        <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">],</span> 
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bm25&#39;</span><span class="p">]</span> <span class="c1"># drop baselines </span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MainMethod&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SubMethod&#39;</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span>
        <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Method&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">]]</span>

    <span class="k">return</span> <span class="n">df</span>


<span class="n">adjusted_df</span> <span class="o">=</span> <span class="n">merge_adjustment</span><span class="p">(</span><span class="n">standardized_df</span><span class="p">)</span>

<span class="n">adjusted_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="n">adjusted_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 2603 entries, 2 to 2623
Data columns (total 6 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   Source        2603 non-null   object 
 1   Dataset       2603 non-null   object 
 2   LLM           2603 non-null   object 
 3   Method        2603 non-null   object 
 4   Metric_Name   2603 non-null   object 
 5   Metric_Value  2603 non-null   float64
dtypes: float64(1), object(5)
memory usage: 142.4+ KB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>Dataset</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>NDCG@10</td>
      <td>0.557</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Inferences</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Prompt Tokens</td>
      <td>15211.600</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Latency (s)</td>
      <td>0.600</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Published</td>
      <td>TrecDL20</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>NDCG@10</td>
      <td>0.567</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2619</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Inferences</td>
      <td>48.905</td>
    </tr>
    <tr>
      <th>2620</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Prompt Tokens</td>
      <td>23707.890</td>
    </tr>
    <tr>
      <th>2621</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Generated Tokens</td>
      <td>23756.795</td>
    </tr>
    <tr>
      <th>2622</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Latency (s)</td>
      <td>2.544</td>
    </tr>
    <tr>
      <th>2623</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>NDCG@10</td>
      <td>0.346</td>
    </tr>
  </tbody>
</table>
<p>2603 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="distinct-elements">
<h2>Distinct Elements<a class="headerlink" href="#distinct-elements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">standardized_results</span> <span class="o">=</span> <span class="n">analyze_distinct_elements</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">ignore_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>
<span class="n">print_distinct_elements</span><span class="p">(</span><span class="n">standardized_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Source:
-------
&#39;Measured&#39;: 1574
&#39;Modified&#39;: 585
&#39;Published&#39;: 444

Dataset:
--------
&#39;TrecDL19&#39;: 441
&#39;TrecDL20&#39;: 441
&#39;Covid&#39;: 207
&#39;Touche&#39;: 206
&#39;News&#39;: 206
&#39;Signal&#39;: 204
&#39;Robust04&#39;: 198
&#39;NFCorpus&#39;: 196
&#39;DBPedia&#39;: 186
&#39;SciFact&#39;: 183
&#39;noveleval&#39;: 135

LLM:
----
&#39;flan-t5-xl&#39;: 944
&#39;flan-t5-large&#39;: 929
&#39;flan-t5-xxl&#39;: 370
&#39;llama-2-13b-hf&#39;: 60
&#39;llama-2-7b-hf&#39;: 60
&#39;llama-3.1-8B-Instruct&#39;: 60
&#39;llama-3.1-8B&#39;: 60
&#39;vicuna-13b-v1.5&#39;: 60
&#39;vicuna-7b-v1.5&#39;: 60

Method:
-------
&#39;setwise.heapsort&#39;: 399
&#39;setwise.bubblesort&#39;: 355
&#39;pairwise.heapsort&#39;: 351
&#39;pairwise.bubblesort&#39;: 340
&#39;pointwise.qlm&#39;: 295
&#39;pointwise.yes_no&#39;: 290
&#39;listwise.generation&#39;: 250
&#39;listwise.likelihood&#39;: 248
&#39;pairwise.allpair&#39;: 75

Metric_Name:
------------
&#39;NDCG@10&#39;: 633
&#39;Inferences&#39;: 437
&#39;Prompt Tokens&#39;: 437
&#39;Latency (s)&#39;: 437
&#39;Generated Tokens&#39;: 419
&#39;GPU Minutes &#39;: 240
</pre></div>
</div>
</div>
</div>
</section>
<section id="duplicate-detection">
<h2>Duplicate Detection<a class="headerlink" href="#duplicate-detection" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count_duplicates()</span></code> function identifies and quantifies duplicate entries</p></li>
<li><p>Should return an empty dataframe, for no duplicates detected</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_duplicates</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count occurrences of duplicate rows in a DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    df (pandas.DataFrame): Input DataFrame to analyze</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    pandas.DataFrame: DataFrame containing duplicate rows and their counts,</span>
<span class="sd">                     sorted by count in descending order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get count of all duplicated rows</span>
    <span class="n">duplicate_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Rename the count column</span>
    <span class="n">duplicate_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
    
    <span class="c1"># Filter to only rows that appear more than once</span>
    <span class="n">duplicates_only</span> <span class="o">=</span> <span class="n">duplicate_counts</span><span class="p">[</span><span class="n">duplicate_counts</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Sort by count in descending order</span>
    <span class="n">duplicates_only</span> <span class="o">=</span> <span class="n">duplicates_only</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Reset index for clean output</span>
    <span class="n">duplicates_only</span> <span class="o">=</span> <span class="n">duplicates_only</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">duplicates_only</span>


<span class="c1"># df_display(count_duplicates(adjusted_df))</span>

<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># TODO drop the Metric_Value column from adjusted_df2</span>
<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>

<span class="n">df_display</span><span class="p">(</span><span class="n">count_duplicates</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>Dataset</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Metric_Name</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adjusted_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>Dataset</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Metric_Name</th>
      <th>Metric_Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>NDCG@10</td>
      <td>0.557</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Inferences</td>
      <td>100.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Prompt Tokens</td>
      <td>15211.600</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Published</td>
      <td>TrecDL19</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>Latency (s)</td>
      <td>0.600</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Published</td>
      <td>TrecDL20</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>NDCG@10</td>
      <td>0.567</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2619</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Inferences</td>
      <td>48.905</td>
    </tr>
    <tr>
      <th>2620</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Prompt Tokens</td>
      <td>23707.890</td>
    </tr>
    <tr>
      <th>2621</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Generated Tokens</td>
      <td>23756.795</td>
    </tr>
    <tr>
      <th>2622</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>Latency (s)</td>
      <td>2.544</td>
    </tr>
    <tr>
      <th>2623</th>
      <td>Measured</td>
      <td>TrecDL20</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>NDCG@10</td>
      <td>0.346</td>
    </tr>
  </tbody>
</table>
<p>2603 rows × 6 columns</p>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analyze-metrics">
<h1>ANALYZE METRICS<a class="headerlink" href="#analyze-metrics" title="Link to this heading">#</a></h1>
<p>Defines standard dimensions for heatmap visualizations:</p>
<ul class="simple">
<li><p>Width and height parameters for different chart types</p></li>
<li><p>Consistent sizing across all visualizations</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hmap_width</span><span class="o">=</span><span class="mi">12</span>
<span class="n">hmap_height</span><span class="o">=</span><span class="mi">4</span>
<span class="n">hmap_height2</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<section id="data-statistics">
<h2>Data Statistics<a class="headerlink" href="#data-statistics" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_analysis_report()</span></code> function creates comprehensive statistical reports by:</p>
<ul class="simple">
<li><p>Counting unique values across key categories (Source, Dataset, LLM, Method, Metric_Name)</p></li>
<li><p>Calculating percentages for each category</p></li>
<li><p>Providing formatted output of statistics</p></li>
<li><p>Excluding baseline (BM25) measurements for clean comparisons</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">generate_analysis_report</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a detailed analysis report of counts and subtotals for a DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    df (pandas.DataFrame): DataFrame with columns Source, Dataset, LLM, Method, Metric_Name</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    dict: Dictionary containing counts and analysis for each category</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Generate counts for each category</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
        <span class="c1"># Create detailed breakdown with percentages</span>
        <span class="n">breakdown</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">breakdown</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
                <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">percentage</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">})</span>
            
        <span class="n">report</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_records&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
            <span class="s1">&#39;unique_values&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">),</span>
            <span class="s1">&#39;breakdown&#39;</span><span class="p">:</span> <span class="n">breakdown</span>
        <span class="p">}</span>
    
    <span class="c1"># Print formatted report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DATASET ANALYSIS REPORT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> ANALYSIS&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Records: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="s1">&#39;total_records&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unique Values: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="s1">&#39;unique_values&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Breakdown:&quot;</span><span class="p">)</span>
        
        <span class="c1"># Sort breakdown by count in descending order</span>
        <span class="n">sorted_breakdown</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">report</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="s1">&#39;breakdown&#39;</span><span class="p">],</span> 
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> 
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sorted_breakdown</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> records (</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">report</span>


<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df</span><span class="p">[</span><span class="n">adjusted_df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bm25&#39;</span><span class="p">]</span>
<span class="c1"># Generate overall report</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">generate_analysis_report</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DATASET ANALYSIS REPORT
==================================================

SOURCE ANALYSIS
------------------------------
Total Records: 2603
Unique Values: 3

Breakdown:
  Measured: 1574 records (60.47%)
  Modified: 585 records (22.47%)
  Published: 444 records (17.06%)

DATASET ANALYSIS
------------------------------
Total Records: 2603
Unique Values: 11

Breakdown:
  TrecDL19: 441 records (16.94%)
  TrecDL20: 441 records (16.94%)
  Covid: 207 records (7.95%)
  Touche: 206 records (7.91%)
  News: 206 records (7.91%)
  Signal: 204 records (7.84%)
  Robust04: 198 records (7.61%)
  NFCorpus: 196 records (7.53%)
  DBPedia: 186 records (7.15%)
  SciFact: 183 records (7.03%)
  noveleval: 135 records (5.19%)

LLM ANALYSIS
------------------------------
Total Records: 2603
Unique Values: 9

Breakdown:
  flan-t5-xl: 944 records (36.27%)
  flan-t5-large: 929 records (35.69%)
  flan-t5-xxl: 370 records (14.21%)
  llama-2-13b-hf: 60 records (2.31%)
  llama-2-7b-hf: 60 records (2.31%)
  llama-3.1-8B-Instruct: 60 records (2.31%)
  llama-3.1-8B: 60 records (2.31%)
  vicuna-13b-v1.5: 60 records (2.31%)
  vicuna-7b-v1.5: 60 records (2.31%)

METHOD ANALYSIS
------------------------------
Total Records: 2603
Unique Values: 9

Breakdown:
  setwise.heapsort: 399 records (15.33%)
  setwise.bubblesort: 355 records (13.64%)
  pairwise.heapsort: 351 records (13.48%)
  pairwise.bubblesort: 340 records (13.06%)
  pointwise.qlm: 295 records (11.33%)
  pointwise.yes_no: 290 records (11.14%)
  listwise.generation: 250 records (9.6%)
  listwise.likelihood: 248 records (9.53%)
  pairwise.allpair: 75 records (2.88%)

METRIC_NAME ANALYSIS
------------------------------
Total Records: 2603
Unique Values: 6

Breakdown:
  NDCG@10: 633 records (24.32%)
  Inferences: 437 records (16.79%)
  Prompt Tokens: 437 records (16.79%)
  Latency (s): 437 records (16.79%)
  Generated Tokens: 419 records (16.1%)
  GPU Minutes : 240 records (9.22%)
</pre></div>
</div>
</div>
</div>
</section>
<section id="metric-selection-and-summary-functions">
<h2>Metric Selection and Summary Functions<a class="headerlink" href="#metric-selection-and-summary-functions" title="Link to this heading">#</a></h2>
<p>Two main functions that work together to analyze metrics:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">select_metrics()</span></code>:</p>
<ul class="simple">
<li><p>Filters data for specific metrics (like NDCG&#64;10)</p></li>
<li><p>Converts metric values to proper numeric format</p></li>
<li><p>Creates pivot tables for easy comparison</p></li>
<li><p>Organizes data by source, LLM, and method</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">summarize_metrics()</span></code>:</p>
<ul class="simple">
<li><p>Separates data into published, measured, and modified results</p></li>
<li><p>Creates formatted tables for each category</p></li>
<li><p>Displays results in an easy-to-read format</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">select_metrics</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">):</span>
    
    <span class="c1"># Filter only NDCG@10 metrics</span>
    <span class="n">ndcg_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Convert Metric_Value to float</span>
    <span class="n">ndcg_df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ndcg_df</span><span class="p">[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">])</span>
    
    <span class="c1"># Combine method columns</span>
    <span class="c1"># ndcg_df[&#39;method&#39;] = ndcg_df.apply(</span>
    <span class="c1">#     lambda row: f&quot;{row[&#39;MainMethod&#39;]}_{row[&#39;SubMethod&#39;]}&quot; + </span>
    <span class="c1">#                (f&quot;_{row[&#39;Parameters&#39;]}&quot; if row[&#39;Parameters&#39;] != &#39;none&#39; else &#39;&#39;),</span>
    <span class="c1">#     axis=1</span>
    <span class="c1"># )</span>
    
    <span class="c1"># Keep only needed columns and pivot</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">ndcg_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>  <span class="c1"># Use &#39;first&#39; instead of default &#39;mean&#39; to avoid aggregation</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">summarize_metrics</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">):</span>
    <span class="c1"># Assuming your DataFrame is called &#39;ndcg_metrics&#39;</span>
    <span class="c1"># Create separate DataFrames for each source</span>
    <span class="n">published_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Published&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">measured_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">modified_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Modified&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Function to display tables with proper formatting</span>
    <span class="k">def</span> <span class="nf">display_tables</span><span class="p">(</span><span class="n">published_df</span><span class="p">,</span> <span class="n">measured_df</span><span class="p">,</span> <span class="n">modified_df</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Published </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">published_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">published_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No published results available&quot;</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Measured </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">measured_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No measured results available&quot;</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Modified </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modified_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">modified_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No modified results available&quot;</span><span class="p">)</span>

    <span class="c1"># Display the tables</span>
    <span class="c1"># display_tables(published_df, measured_df, modified_df)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Published </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> from ===&quot;</span><span class="p">)</span>
    <span class="n">df_display</span><span class="p">(</span><span class="n">published_df</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Measured </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="n">df_display</span><span class="p">(</span><span class="n">measured_df</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Modified </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="n">df_display</span><span class="p">(</span><span class="n">modified_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="specific-metric-analysis-sections">
<h2>Specific Metric Analysis Sections<a class="headerlink" href="#specific-metric-analysis-sections" title="Link to this heading">#</a></h2>
<p>Individual analysis sections for different metrics:</p>
<ol class="arabic simple">
<li><p>NDCG&#64;10 Metrics</p>
<ul class="simple">
<li><p>Analysis of ranking effectiveness</p></li>
<li><p>Comparison across different methods</p></li>
</ul>
</li>
<li><p>Inference Metrics</p>
<ul class="simple">
<li><p>Tracking number of inferences made</p></li>
<li><p>Performance analysis</p></li>
</ul>
</li>
<li><p>Token Analysis</p>
<ul class="simple">
<li><p>Prompt token usage metrics</p></li>
<li><p>Generated token measurements</p></li>
</ul>
</li>
<li><p>Latency Measurements</p>
<ul class="simple">
<li><p>Processing time analysis</p></li>
<li><p>Performance benchmarking</p></li>
</ul>
</li>
</ol>
<section id="ndcg-metrics">
<h3>ndcg_metrics<a class="headerlink" href="#ndcg-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndcg_metrics</span> <span class="o">=</span> <span class="n">select_metrics</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">)</span>
<span class="n">summarize_metrics</span><span class="p">(</span><span class="n">ndcg_metrics</span><span class="p">,</span> <span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Published NDCG@10 from ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>0.692</td>
      <td>0.391</td>
      <td>0.333</td>
      <td>0.428</td>
      <td>0.441</td>
      <td>0.650</td>
      <td>0.343</td>
      <td>0.441</td>
      <td>0.561</td>
      <td>0.547</td>
      <td>-</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>0.756</td>
      <td>0.444</td>
      <td>0.334</td>
      <td>0.453</td>
      <td>0.475</td>
      <td>0.639</td>
      <td>0.308</td>
      <td>0.327</td>
      <td>0.669</td>
      <td>0.626</td>
      <td>-</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.666</td>
      <td>0.622</td>
      <td>-</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>0.714</td>
      <td>0.416</td>
      <td>0.341</td>
      <td>0.440</td>
      <td>0.439</td>
      <td>0.700</td>
      <td>0.361</td>
      <td>0.447</td>
      <td>0.636</td>
      <td>0.589</td>
      <td>-</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>0.761</td>
      <td>0.435</td>
      <td>0.336</td>
      <td>0.440</td>
      <td>0.402</td>
      <td>0.671</td>
      <td>0.325</td>
      <td>0.318</td>
      <td>0.657</td>
      <td>0.619</td>
      <td>-</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.664</td>
      <td>0.305</td>
      <td>0.322</td>
      <td>0.413</td>
      <td>0.430</td>
      <td>0.644</td>
      <td>0.314</td>
      <td>0.260</td>
      <td>0.557</td>
      <td>0.567</td>
      <td>-</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.664</td>
      <td>0.296</td>
      <td>0.308</td>
      <td>0.346</td>
      <td>0.456</td>
      <td>0.504</td>
      <td>0.275</td>
      <td>0.238</td>
      <td>0.654</td>
      <td>0.615</td>
      <td>-</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>0.761</td>
      <td>0.441</td>
      <td>0.338</td>
      <td>0.447</td>
      <td>0.497</td>
      <td>0.636</td>
      <td>0.351</td>
      <td>0.394</td>
      <td>0.678</td>
      <td>0.624</td>
      <td>-</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>0.768</td>
      <td>0.413</td>
      <td>0.325</td>
      <td>0.439</td>
      <td>0.462</td>
      <td>0.620</td>
      <td>0.319</td>
      <td>0.303</td>
      <td>0.670</td>
      <td>0.618</td>
      <td>-</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>0.650</td>
      <td>0.366</td>
      <td>0.334</td>
      <td>0.437</td>
      <td>0.475</td>
      <td>0.694</td>
      <td>0.349</td>
      <td>0.451</td>
      <td>0.569</td>
      <td>0.547</td>
      <td>-</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>0.736</td>
      <td>0.449</td>
      <td>0.360</td>
      <td>0.472</td>
      <td>0.526</td>
      <td>0.686</td>
      <td>0.320</td>
      <td>0.310</td>
      <td>0.689</td>
      <td>0.672</td>
      <td>-</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.713</td>
      <td>0.682</td>
      <td>-</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>0.763</td>
      <td>0.432</td>
      <td>0.359</td>
      <td>0.485</td>
      <td>0.553</td>
      <td>0.734</td>
      <td>0.353</td>
      <td>0.400</td>
      <td>0.683</td>
      <td>0.662</td>
      <td>-</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>0.778</td>
      <td>0.417</td>
      <td>0.355</td>
      <td>0.471</td>
      <td>0.550</td>
      <td>0.711</td>
      <td>0.317</td>
      <td>0.303</td>
      <td>0.705</td>
      <td>0.692</td>
      <td>-</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>0.679</td>
      <td>0.310</td>
      <td>0.330</td>
      <td>0.422</td>
      <td>0.427</td>
      <td>0.696</td>
      <td>0.299</td>
      <td>0.216</td>
      <td>0.542</td>
      <td>0.524</td>
      <td>-</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>0.698</td>
      <td>0.273</td>
      <td>0.331</td>
      <td>0.413</td>
      <td>0.479</td>
      <td>0.553</td>
      <td>0.297</td>
      <td>0.269</td>
      <td>0.650</td>
      <td>0.636</td>
      <td>-</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>0.756</td>
      <td>0.438</td>
      <td>0.353</td>
      <td>0.497</td>
      <td>0.537</td>
      <td>0.691</td>
      <td>0.362</td>
      <td>0.330</td>
      <td>0.705</td>
      <td>0.676</td>
      <td>-</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>0.757</td>
      <td>0.428</td>
      <td>0.352</td>
      <td>0.465</td>
      <td>0.520</td>
      <td>0.677</td>
      <td>0.314</td>
      <td>0.283</td>
      <td>0.693</td>
      <td>0.678</td>
      <td>-</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>0.664</td>
      <td>0.441</td>
      <td>0.344</td>
      <td>0.458</td>
      <td>0.495</td>
      <td>0.736</td>
      <td>0.353</td>
      <td>0.453</td>
      <td>0.662</td>
      <td>0.637</td>
      <td>-</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>0.749</td>
      <td>0.416</td>
      <td>0.352</td>
      <td>0.479</td>
      <td>0.518</td>
      <td>0.725</td>
      <td>0.316</td>
      <td>0.407</td>
      <td>0.701</td>
      <td>0.690</td>
      <td>-</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.709</td>
      <td>0.709</td>
      <td>-</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>0.733</td>
      <td>0.421</td>
      <td>0.353</td>
      <td>0.490</td>
      <td>0.550</td>
      <td>0.756</td>
      <td>0.343</td>
      <td>0.363</td>
      <td>0.679</td>
      <td>0.681</td>
      <td>-</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>0.738</td>
      <td>0.407</td>
      <td>0.359</td>
      <td>0.487</td>
      <td>0.543</td>
      <td>0.744</td>
      <td>0.328</td>
      <td>0.364</td>
      <td>0.708</td>
      <td>0.699</td>
      <td>-</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>0.707</td>
      <td>0.324</td>
      <td>0.342</td>
      <td>0.431</td>
      <td>0.440</td>
      <td>0.712</td>
      <td>0.307</td>
      <td>0.188</td>
      <td>0.506</td>
      <td>0.492</td>
      <td>-</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>0.691</td>
      <td>0.305</td>
      <td>0.322</td>
      <td>0.392</td>
      <td>0.515</td>
      <td>0.623</td>
      <td>0.274</td>
      <td>0.240</td>
      <td>0.644</td>
      <td>0.632</td>
      <td>-</td>
    </tr>
    <tr>
      <th>102</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>0.768</td>
      <td>0.424</td>
      <td>0.346</td>
      <td>0.479</td>
      <td>0.534</td>
      <td>0.754</td>
      <td>0.343</td>
      <td>0.388</td>
      <td>0.711</td>
      <td>0.686</td>
      <td>-</td>
    </tr>
    <tr>
      <th>103</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>0.752</td>
      <td>0.402</td>
      <td>0.346</td>
      <td>0.473</td>
      <td>0.513</td>
      <td>0.726</td>
      <td>0.321</td>
      <td>0.307</td>
      <td>0.706</td>
      <td>0.688</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Measured NDCG@10 ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>0.692</td>
      <td>0.391</td>
      <td>0.332</td>
      <td>0.428</td>
      <td>0.441</td>
      <td>0.651</td>
      <td>0.344</td>
      <td>0.441</td>
      <td>0.561</td>
      <td>0.547</td>
      <td>0.776</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>0.756</td>
      <td>0.443</td>
      <td>0.334</td>
      <td>0.453</td>
      <td>0.475</td>
      <td>-</td>
      <td>0.310</td>
      <td>0.328</td>
      <td>0.664</td>
      <td>0.626</td>
      <td>0.797</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.666</td>
      <td>0.622</td>
      <td>0.802</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>0.714</td>
      <td>0.416</td>
      <td>0.342</td>
      <td>0.439</td>
      <td>0.439</td>
      <td>0.700</td>
      <td>0.362</td>
      <td>0.447</td>
      <td>0.636</td>
      <td>0.587</td>
      <td>0.804</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>0.761</td>
      <td>0.414</td>
      <td>0.335</td>
      <td>0.439</td>
      <td>0.402</td>
      <td>0.689</td>
      <td>0.327</td>
      <td>0.314</td>
      <td>0.656</td>
      <td>0.619</td>
      <td>0.810</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.664</td>
      <td>0.304</td>
      <td>0.321</td>
      <td>0.412</td>
      <td>0.439</td>
      <td>0.645</td>
      <td>0.316</td>
      <td>0.259</td>
      <td>0.555</td>
      <td>0.565</td>
      <td>0.691</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.664</td>
      <td>0.297</td>
      <td>0.307</td>
      <td>0.347</td>
      <td>0.456</td>
      <td>0.504</td>
      <td>0.276</td>
      <td>0.236</td>
      <td>0.654</td>
      <td>0.615</td>
      <td>0.738</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>0.777</td>
      <td>0.442</td>
      <td>0.330</td>
      <td>0.455</td>
      <td>0.494</td>
      <td>0.609</td>
      <td>0.350</td>
      <td>0.355</td>
      <td>0.687</td>
      <td>0.627</td>
      <td>0.844</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>0.765</td>
      <td>0.421</td>
      <td>0.332</td>
      <td>0.431</td>
      <td>0.463</td>
      <td>0.462</td>
      <td>0.307</td>
      <td>0.282</td>
      <td>0.652</td>
      <td>0.603</td>
      <td>0.806</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>0.650</td>
      <td>0.367</td>
      <td>0.334</td>
      <td>0.437</td>
      <td>0.476</td>
      <td>0.694</td>
      <td>0.349</td>
      <td>0.452</td>
      <td>0.568</td>
      <td>0.546</td>
      <td>0.777</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>0.741</td>
      <td>0.450</td>
      <td>0.358</td>
      <td>0.477</td>
      <td>0.525</td>
      <td>0.676</td>
      <td>0.321</td>
      <td>0.317</td>
      <td>0.691</td>
      <td>0.672</td>
      <td>0.814</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.713</td>
      <td>0.682</td>
      <td>0.818</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>0.763</td>
      <td>0.432</td>
      <td>0.358</td>
      <td>0.485</td>
      <td>0.554</td>
      <td>0.733</td>
      <td>0.352</td>
      <td>0.400</td>
      <td>0.683</td>
      <td>0.662</td>
      <td>0.813</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>0.779</td>
      <td>0.417</td>
      <td>0.355</td>
      <td>0.471</td>
      <td>0.550</td>
      <td>0.711</td>
      <td>0.317</td>
      <td>0.303</td>
      <td>0.706</td>
      <td>0.692</td>
      <td>0.815</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>0.678</td>
      <td>0.309</td>
      <td>0.330</td>
      <td>0.421</td>
      <td>0.426</td>
      <td>0.694</td>
      <td>0.302</td>
      <td>0.220</td>
      <td>0.541</td>
      <td>0.542</td>
      <td>0.696</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>0.696</td>
      <td>0.273</td>
      <td>0.330</td>
      <td>0.412</td>
      <td>0.479</td>
      <td>0.554</td>
      <td>0.297</td>
      <td>0.269</td>
      <td>0.650</td>
      <td>0.636</td>
      <td>0.770</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>0.765</td>
      <td>0.430</td>
      <td>0.354</td>
      <td>0.487</td>
      <td>0.532</td>
      <td>0.686</td>
      <td>0.345</td>
      <td>0.321</td>
      <td>0.699</td>
      <td>0.684</td>
      <td>0.808</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>0.768</td>
      <td>0.415</td>
      <td>0.348</td>
      <td>0.482</td>
      <td>0.518</td>
      <td>0.685</td>
      <td>0.300</td>
      <td>0.280</td>
      <td>0.688</td>
      <td>0.666</td>
      <td>0.789</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.660</td>
      <td>0.637</td>
      <td>0.816</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.702</td>
      <td>0.690</td>
      <td>0.825</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.699</td>
      <td>0.689</td>
      <td>0.797</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.679</td>
      <td>0.681</td>
      <td>0.806</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.704</td>
      <td>0.698</td>
      <td>0.778</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.308</td>
      <td>-</td>
      <td>0.507</td>
      <td>0.490</td>
      <td>0.684</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.276</td>
      <td>-</td>
      <td>0.643</td>
      <td>0.632</td>
      <td>0.784</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.480</td>
      <td>-</td>
      <td>0.747</td>
      <td>-</td>
      <td>-</td>
      <td>0.709</td>
      <td>0.692</td>
      <td>0.818</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>0.751</td>
      <td>-</td>
      <td>0.351</td>
      <td>0.464</td>
      <td>0.504</td>
      <td>0.739</td>
      <td>-</td>
      <td>-</td>
      <td>0.681</td>
      <td>0.686</td>
      <td>0.808</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.493</td>
      <td>0.466</td>
      <td>-</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.355</td>
      <td>0.340</td>
      <td>-</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.202</td>
      <td>-</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.479</td>
      <td>-</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.224</td>
      <td>0.203</td>
      <td>-</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.499</td>
      <td>0.483</td>
      <td>-</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.489</td>
      <td>0.471</td>
      <td>-</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.202</td>
      <td>-</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.202</td>
      <td>-</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.509</td>
      <td>0.484</td>
      <td>-</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.517</td>
      <td>0.485</td>
      <td>-</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.202</td>
      <td>-</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.202</td>
      <td>-</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.671</td>
      <td>0.662</td>
      <td>-</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.618</td>
      <td>0.601</td>
      <td>-</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.656</td>
      <td>0.613</td>
      <td>-</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.666</td>
      <td>0.615</td>
      <td>-</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.672</td>
      <td>0.631</td>
      <td>-</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.680</td>
      <td>0.599</td>
      <td>-</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.649</td>
      <td>0.606</td>
      <td>-</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.628</td>
      <td>0.598</td>
      <td>-</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.612</td>
      <td>0.591</td>
      <td>-</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.617</td>
      <td>0.586</td>
      <td>-</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.628</td>
      <td>0.588</td>
      <td>-</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.657</td>
      <td>0.589</td>
      <td>-</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.482</td>
      <td>-</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.572</td>
      <td>0.530</td>
      <td>-</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.506</td>
      <td>0.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.220</td>
      <td>0.204</td>
      <td>-</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.532</td>
      <td>0.492</td>
      <td>-</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.394</td>
      <td>0.346</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Modified NDCG@10 ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>0.705</td>
      <td>0.425</td>
      <td>0.347</td>
      <td>0.447</td>
      <td>0.462</td>
      <td>0.712</td>
      <td>0.353</td>
      <td>0.428</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>0.765</td>
      <td>0.422</td>
      <td>0.342</td>
      <td>0.461</td>
      <td>0.446</td>
      <td>0.690</td>
      <td>0.307</td>
      <td>0.328</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.670</td>
      <td>0.310</td>
      <td>0.300</td>
      <td>0.423</td>
      <td>0.435</td>
      <td>0.652</td>
      <td>0.294</td>
      <td>0.256</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.664</td>
      <td>0.314</td>
      <td>0.292</td>
      <td>0.329</td>
      <td>0.451</td>
      <td>0.501</td>
      <td>0.271</td>
      <td>0.240</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>0.722</td>
      <td>0.431</td>
      <td>-</td>
      <td>0.468</td>
      <td>0.478</td>
      <td>0.680</td>
      <td>0.364</td>
      <td>0.423</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>0.756</td>
      <td>0.427</td>
      <td>0.336</td>
      <td>0.458</td>
      <td>0.452</td>
      <td>0.650</td>
      <td>0.338</td>
      <td>0.314</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>0.766</td>
      <td>-</td>
      <td>0.359</td>
      <td>0.494</td>
      <td>0.521</td>
      <td>0.736</td>
      <td>0.338</td>
      <td>0.391</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>0.782</td>
      <td>0.430</td>
      <td>0.352</td>
      <td>0.483</td>
      <td>0.529</td>
      <td>0.712</td>
      <td>0.299</td>
      <td>0.311</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>0.688</td>
      <td>0.318</td>
      <td>0.324</td>
      <td>0.422</td>
      <td>0.416</td>
      <td>0.720</td>
      <td>0.310</td>
      <td>0.237</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>0.693</td>
      <td>0.283</td>
      <td>0.331</td>
      <td>0.404</td>
      <td>0.477</td>
      <td>0.535</td>
      <td>0.304</td>
      <td>0.255</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>0.770</td>
      <td>0.437</td>
      <td>-</td>
      <td>0.493</td>
      <td>0.534</td>
      <td>0.703</td>
      <td>0.359</td>
      <td>0.352</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>0.771</td>
      <td>0.421</td>
      <td>0.345</td>
      <td>0.468</td>
      <td>0.515</td>
      <td>0.693</td>
      <td>0.322</td>
      <td>0.304</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>0.742</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.419</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>0.736</td>
      <td>-</td>
      <td>0.348</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.321</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="infrences-metrics">
<h3>infrences_metrics<a class="headerlink" href="#infrences-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infrences_metrics</span> <span class="o">=</span> <span class="n">select_metrics</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Inferences&#39;</span><span class="p">)</span>
<span class="n">summarize_metrics</span><span class="p">(</span><span class="n">infrences_metrics</span><span class="p">,</span> <span class="s2">&quot;Inferences&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Published Inferences from ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>9900.0</td>
      <td>9900.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>844.2</td>
      <td>778.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>230.3</td>
      <td>226.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>460.5</td>
      <td>457.4</td>
      <td>-</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>125.4</td>
      <td>124.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>9900.0</td>
      <td>9900.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>886.9</td>
      <td>863.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>241.9</td>
      <td>244.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>466.9</td>
      <td>463.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>129.5</td>
      <td>127.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.0</td>
      <td>245.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>9900.0</td>
      <td>9900.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>870.5</td>
      <td>842.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>239.4</td>
      <td>240.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>102</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>468.3</td>
      <td>467.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>103</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>130.1</td>
      <td>128.1</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Measured Inferences ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>245.00</td>
      <td>244.400</td>
      <td>173.539</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>245.00</td>
      <td>244.400</td>
      <td>173.539</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>244.717</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4950.000</td>
      <td>4950.000</td>
      <td>4853.619</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>880.18</td>
      <td>773.330</td>
      <td>572.367</td>
      <td>814.842</td>
      <td>528.205</td>
      <td>-</td>
      <td>694.474</td>
      <td>849.184</td>
      <td>844.140</td>
      <td>781.550</td>
      <td>658.714</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>241.40</td>
      <td>224.638</td>
      <td>167.597</td>
      <td>214.158</td>
      <td>182.225</td>
      <td>199.300</td>
      <td>209.351</td>
      <td>223.306</td>
      <td>230.977</td>
      <td>226.750</td>
      <td>211.571</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>-</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>311.46</td>
      <td>303.558</td>
      <td>221.175</td>
      <td>302.193</td>
      <td>301.867</td>
      <td>-</td>
      <td>304.567</td>
      <td>301.918</td>
      <td>300.884</td>
      <td>302.865</td>
      <td>306.714</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>77.50</td>
      <td>75.910</td>
      <td>54.045</td>
      <td>75.439</td>
      <td>74.795</td>
      <td>69.167</td>
      <td>76.289</td>
      <td>76.367</td>
      <td>76.767</td>
      <td>76.570</td>
      <td>72.381</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>245.00</td>
      <td>244.400</td>
      <td>173.539</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>244.717</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>245.00</td>
      <td>244.400</td>
      <td>173.539</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>244.717</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4950.000</td>
      <td>4950.000</td>
      <td>4853.619</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>914.40</td>
      <td>832.920</td>
      <td>501.334</td>
      <td>734.474</td>
      <td>771.622</td>
      <td>655.710</td>
      <td>803.175</td>
      <td>904.673</td>
      <td>886.907</td>
      <td>869.735</td>
      <td>549.381</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>252.24</td>
      <td>239.375</td>
      <td>164.851</td>
      <td>229.895</td>
      <td>241.317</td>
      <td>216.960</td>
      <td>233.794</td>
      <td>254.959</td>
      <td>241.767</td>
      <td>245.520</td>
      <td>208.667</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>313.44</td>
      <td>306.418</td>
      <td>219.451</td>
      <td>304.544</td>
      <td>305.305</td>
      <td>312.990</td>
      <td>305.619</td>
      <td>310.837</td>
      <td>314.465</td>
      <td>312.195</td>
      <td>311.762</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>79.62</td>
      <td>75.845</td>
      <td>55.977</td>
      <td>76.632</td>
      <td>78.659</td>
      <td>75.627</td>
      <td>76.866</td>
      <td>79.061</td>
      <td>77.256</td>
      <td>76.840</td>
      <td>72.905</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>242.143</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4950.000</td>
      <td>4950.000</td>
      <td>4853.619</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>870.000</td>
      <td>855.395</td>
      <td>718.143</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>239.349</td>
      <td>241.350</td>
      <td>213.905</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4.000</td>
      <td>-</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4.000</td>
      <td>-</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.952</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>299.719</td>
      <td>-</td>
      <td>306.630</td>
      <td>-</td>
      <td>-</td>
      <td>312.488</td>
      <td>311.800</td>
      <td>302.762</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>80.22</td>
      <td>-</td>
      <td>56.558</td>
      <td>77.561</td>
      <td>79.980</td>
      <td>76.847</td>
      <td>-</td>
      <td>-</td>
      <td>77.744</td>
      <td>78.235</td>
      <td>72.857</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>99.000</td>
      <td>99.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>117.000</td>
      <td>117.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>47.140</td>
      <td>50.515</td>
      <td>-</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.279</td>
      <td>42.170</td>
      <td>-</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>99.000</td>
      <td>99.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>117.000</td>
      <td>117.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.000</td>
      <td>42.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.000</td>
      <td>42.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>99.000</td>
      <td>99.490</td>
      <td>-</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>117.047</td>
      <td>117.010</td>
      <td>-</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.000</td>
      <td>42.070</td>
      <td>-</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.000</td>
      <td>42.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>852.512</td>
      <td>866.785</td>
      <td>-</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>244.744</td>
      <td>240.540</td>
      <td>-</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>303.837</td>
      <td>303.285</td>
      <td>-</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>76.558</td>
      <td>75.825</td>
      <td>-</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>834.698</td>
      <td>827.740</td>
      <td>-</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>230.698</td>
      <td>223.065</td>
      <td>-</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>255.558</td>
      <td>241.680</td>
      <td>-</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>72.326</td>
      <td>70.325</td>
      <td>-</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>245.000</td>
      <td>245.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>102.163</td>
      <td>100.485</td>
      <td>-</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>117.093</td>
      <td>117.180</td>
      <td>-</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>96.047</td>
      <td>108.035</td>
      <td>-</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49.302</td>
      <td>48.905</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Modified Inferences ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>891.10</td>
      <td>859.760</td>
      <td>580.045</td>
      <td>832.175</td>
      <td>765.229</td>
      <td>598.727</td>
      <td>792.062</td>
      <td>914.163</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>238.90</td>
      <td>237.312</td>
      <td>169.581</td>
      <td>225.000</td>
      <td>223.839</td>
      <td>199.293</td>
      <td>222.557</td>
      <td>245.245</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>294.40</td>
      <td>248.645</td>
      <td>-</td>
      <td>281.947</td>
      <td>286.060</td>
      <td>307.463</td>
      <td>284.361</td>
      <td>279.082</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>76.50</td>
      <td>73.708</td>
      <td>53.620</td>
      <td>74.263</td>
      <td>73.430</td>
      <td>71.003</td>
      <td>74.103</td>
      <td>73.469</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>900.90</td>
      <td>-</td>
      <td>383.058</td>
      <td>622.737</td>
      <td>611.438</td>
      <td>375.620</td>
      <td>743.701</td>
      <td>861.388</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>251.42</td>
      <td>229.470</td>
      <td>152.075</td>
      <td>219.175</td>
      <td>223.904</td>
      <td>183.883</td>
      <td>217.969</td>
      <td>249.204</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>4.00</td>
      <td>3.992</td>
      <td>3.049</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>3.997</td>
      <td>4.000</td>
      <td>4.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>308.42</td>
      <td>303.168</td>
      <td>-</td>
      <td>305.561</td>
      <td>298.149</td>
      <td>299.513</td>
      <td>296.443</td>
      <td>307.837</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>78.26</td>
      <td>75.528</td>
      <td>54.630</td>
      <td>75.789</td>
      <td>77.578</td>
      <td>73.977</td>
      <td>75.227</td>
      <td>76.898</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>272.041</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>80.12</td>
      <td>-</td>
      <td>56.396</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>76.755</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="prompt-tokens-metrics">
<h3>prompt_tokens_metrics<a class="headerlink" href="#prompt-tokens-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infrences_metrics</span> <span class="o">=</span> <span class="n">select_metrics</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">)</span>
<span class="n">summarize_metrics</span><span class="p">(</span><span class="n">infrences_metrics</span><span class="p">,</span> <span class="s2">&quot;Prompt Tokens&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Published Prompt Tokens from ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>119120.8</td>
      <td>119629.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>94200.7</td>
      <td>95208.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3014383.1</td>
      <td>3014232.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>381386.3</td>
      <td>357358.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>104952.5</td>
      <td>104242.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>15211.6</td>
      <td>15285.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16111.6</td>
      <td>16185.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>147774.1</td>
      <td>148947.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>40460.6</td>
      <td>40362.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>119120.8</td>
      <td>119814.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>94464.1</td>
      <td>95298.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2953436.2</td>
      <td>2949457.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>400367.1</td>
      <td>394954.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1101269.0</td>
      <td>111341.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>15211.6</td>
      <td>15285.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16111.6</td>
      <td>16185.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>149949.1</td>
      <td>151249.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>41665.7</td>
      <td>41569.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>119334.7</td>
      <td>119951.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>94537.5</td>
      <td>95482.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2794942.6</td>
      <td>2794928.4</td>
      <td>-</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>394386.0</td>
      <td>387359.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>109402.0</td>
      <td>110211.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>15211.6</td>
      <td>15285.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16111.6</td>
      <td>16185.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>102</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>150764.8</td>
      <td>152709.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>103</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>420786.0</td>
      <td>41633.7</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Measured Prompt Tokens ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>125330.86</td>
      <td>120273.022</td>
      <td>88850.951</td>
      <td>125440.000</td>
      <td>125436.161</td>
      <td>-</td>
      <td>71080.825</td>
      <td>123888.633</td>
      <td>119126.186</td>
      <td>119736.360</td>
      <td>123971.143</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>116404.54</td>
      <td>98952.198</td>
      <td>81353.873</td>
      <td>116899.228</td>
      <td>116724.550</td>
      <td>119572.870</td>
      <td>42006.423</td>
      <td>110055.571</td>
      <td>94188.535</td>
      <td>95621.805</td>
      <td>114044.952</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2247148.047</td>
      <td>2288235.510</td>
      <td>3000465.524</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>555187.88</td>
      <td>364205.490</td>
      <td>352801.403</td>
      <td>515994.175</td>
      <td>334939.871</td>
      <td>-</td>
      <td>148228.227</td>
      <td>503412.000</td>
      <td>381388.930</td>
      <td>360962.720</td>
      <td>406968.667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>152222.36</td>
      <td>105811.515</td>
      <td>103289.110</td>
      <td>135625.053</td>
      <td>115698.779</td>
      <td>136618.607</td>
      <td>44801.278</td>
      <td>133289.878</td>
      <td>105245.767</td>
      <td>104889.900</td>
      <td>130628.476</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>16078.00</td>
      <td>15016.688</td>
      <td>10838.532</td>
      <td>15950.877</td>
      <td>16323.293</td>
      <td>16568.720</td>
      <td>7638.062</td>
      <td>15277.551</td>
      <td>15115.628</td>
      <td>15103.280</td>
      <td>15503.857</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>16978.00</td>
      <td>15914.550</td>
      <td>11482.208</td>
      <td>16850.877</td>
      <td>17223.293</td>
      <td>-</td>
      <td>8538.062</td>
      <td>16177.551</td>
      <td>16015.628</td>
      <td>16003.280</td>
      <td>16394.000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>181088.58</td>
      <td>130475.128</td>
      <td>126393.422</td>
      <td>176778.737</td>
      <td>176276.345</td>
      <td>-</td>
      <td>52242.887</td>
      <td>166298.612</td>
      <td>124257.907</td>
      <td>127629.760</td>
      <td>175563.714</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>45300.34</td>
      <td>32775.622</td>
      <td>31186.987</td>
      <td>44371.526</td>
      <td>43935.610</td>
      <td>40470.357</td>
      <td>13078.577</td>
      <td>42453.837</td>
      <td>31961.023</td>
      <td>32437.435</td>
      <td>41609.190</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>125303.62</td>
      <td>120462.620</td>
      <td>88850.640</td>
      <td>125440.000</td>
      <td>125437.261</td>
      <td>125294.933</td>
      <td>71028.474</td>
      <td>124161.367</td>
      <td>119174.744</td>
      <td>119827.310</td>
      <td>123975.429</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>116129.22</td>
      <td>98807.630</td>
      <td>81325.591</td>
      <td>116901.246</td>
      <td>116719.454</td>
      <td>118105.213</td>
      <td>41820.268</td>
      <td>110577.469</td>
      <td>94450.116</td>
      <td>95767.530</td>
      <td>114063.952</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2247148.047</td>
      <td>2288235.510</td>
      <td>3000465.524</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>574672.44</td>
      <td>389251.905</td>
      <td>308485.656</td>
      <td>465089.193</td>
      <td>489949.462</td>
      <td>421897.413</td>
      <td>171650.495</td>
      <td>533915.224</td>
      <td>400361.581</td>
      <td>400503.220</td>
      <td>339230.190</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>158668.72</td>
      <td>111918.830</td>
      <td>101531.305</td>
      <td>145566.000</td>
      <td>153342.201</td>
      <td>139747.647</td>
      <td>50216.165</td>
      <td>151930.163</td>
      <td>110089.907</td>
      <td>112985.250</td>
      <td>128694.571</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>16078.00</td>
      <td>15016.688</td>
      <td>10838.532</td>
      <td>15950.877</td>
      <td>16323.293</td>
      <td>16568.720</td>
      <td>7638.062</td>
      <td>15277.551</td>
      <td>15115.628</td>
      <td>15103.280</td>
      <td>15503.857</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>16978.00</td>
      <td>15914.550</td>
      <td>11482.208</td>
      <td>16850.877</td>
      <td>17223.293</td>
      <td>17467.700</td>
      <td>8538.062</td>
      <td>16177.551</td>
      <td>16015.628</td>
      <td>16003.280</td>
      <td>16394.000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>182018.86</td>
      <td>131435.090</td>
      <td>125380.542</td>
      <td>178159.158</td>
      <td>178317.285</td>
      <td>184790.463</td>
      <td>52115.629</td>
      <td>171548.776</td>
      <td>129838.000</td>
      <td>131783.395</td>
      <td>178694.524</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>46488.00</td>
      <td>32681.278</td>
      <td>32296.347</td>
      <td>45097.018</td>
      <td>46227.137</td>
      <td>44895.200</td>
      <td>13149.804</td>
      <td>44047.980</td>
      <td>32213.465</td>
      <td>32619.545</td>
      <td>41947.095</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>119319.279</td>
      <td>119884.850</td>
      <td>123975.619</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>94555.651</td>
      <td>95957.880</td>
      <td>114073.381</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2247148.047</td>
      <td>2288235.510</td>
      <td>3000465.524</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>394213.907</td>
      <td>396402.200</td>
      <td>443344.857</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>109407.209</td>
      <td>111530.530</td>
      <td>132073.905</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>7638.062</td>
      <td>-</td>
      <td>15115.628</td>
      <td>15103.280</td>
      <td>15503.857</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8538.062</td>
      <td>-</td>
      <td>16015.628</td>
      <td>16003.280</td>
      <td>16394.000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>175317.018</td>
      <td>-</td>
      <td>181000.067</td>
      <td>-</td>
      <td>-</td>
      <td>129211.977</td>
      <td>131974.760</td>
      <td>173491.143</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>46903.88</td>
      <td>-</td>
      <td>32647.412</td>
      <td>45628.596</td>
      <td>47007.719</td>
      <td>45637.347</td>
      <td>-</td>
      <td>-</td>
      <td>32407.512</td>
      <td>33253.585</td>
      <td>41988.619</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>216197.256</td>
      <td>217826.055</td>
      <td>-</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>99007.791</td>
      <td>100367.080</td>
      <td>-</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>57720.512</td>
      <td>58778.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>68470.465</td>
      <td>69425.790</td>
      <td>-</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20327.744</td>
      <td>22536.880</td>
      <td>-</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20901.535</td>
      <td>21154.840</td>
      <td>-</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>216136.581</td>
      <td>217808.070</td>
      <td>-</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>98322.186</td>
      <td>99847.515</td>
      <td>-</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>57720.512</td>
      <td>58778.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>68470.465</td>
      <td>69425.790</td>
      <td>-</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>17737.953</td>
      <td>18071.830</td>
      <td>-</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20756.093</td>
      <td>21067.970</td>
      <td>-</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>132122.488</td>
      <td>134170.450</td>
      <td>-</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>88458.372</td>
      <td>90534.010</td>
      <td>-</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>43050.140</td>
      <td>44460.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>51068.047</td>
      <td>52229.290</td>
      <td>-</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>14023.023</td>
      <td>14428.955</td>
      <td>-</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16653.256</td>
      <td>17044.150</td>
      <td>-</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>131777.977</td>
      <td>133705.520</td>
      <td>-</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>88197.140</td>
      <td>90100.685</td>
      <td>-</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>369176.326</td>
      <td>384960.440</td>
      <td>-</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>106093.953</td>
      <td>107072.970</td>
      <td>-</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>119696.814</td>
      <td>122636.550</td>
      <td>-</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>30403.581</td>
      <td>30825.460</td>
      <td>-</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>141326.907</td>
      <td>142826.405</td>
      <td>-</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>98631.744</td>
      <td>100257.685</td>
      <td>-</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>463877.581</td>
      <td>469552.710</td>
      <td>-</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>128532.372</td>
      <td>126345.120</td>
      <td>-</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>120741.558</td>
      <td>116272.925</td>
      <td>-</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>34590.279</td>
      <td>34228.975</td>
      <td>-</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>142161.488</td>
      <td>143788.770</td>
      <td>-</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>98890.860</td>
      <td>100339.665</td>
      <td>-</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>56661.721</td>
      <td>56832.090</td>
      <td>-</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>65235.721</td>
      <td>66251.120</td>
      <td>-</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>43418.419</td>
      <td>49116.015</td>
      <td>-</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>23612.023</td>
      <td>23707.890</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Modified Prompt Tokens ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>597723.88</td>
      <td>438269.655</td>
      <td>381584.052</td>
      <td>561857.789</td>
      <td>516948.506</td>
      <td>410520.560</td>
      <td>202152.969</td>
      <td>574112.286</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>160194.40</td>
      <td>121159.240</td>
      <td>111548.708</td>
      <td>151874.561</td>
      <td>151242.892</td>
      <td>136614.007</td>
      <td>56866.701</td>
      <td>155194.041</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>16578.00</td>
      <td>15515.500</td>
      <td>11196.130</td>
      <td>16450.877</td>
      <td>16823.293</td>
      <td>17068.153</td>
      <td>8138.062</td>
      <td>15777.551</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>17478.00</td>
      <td>16413.362</td>
      <td>11839.805</td>
      <td>17350.877</td>
      <td>17723.293</td>
      <td>17967.133</td>
      <td>9038.062</td>
      <td>16677.551</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>175170.74</td>
      <td>110305.435</td>
      <td>-</td>
      <td>168986.088</td>
      <td>170911.281</td>
      <td>185911.813</td>
      <td>52935.670</td>
      <td>156686.245</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>45792.38</td>
      <td>32903.685</td>
      <td>31726.331</td>
      <td>44799.526</td>
      <td>44175.293</td>
      <td>43159.010</td>
      <td>13709.247</td>
      <td>41834.020</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>602697.28</td>
      <td>-</td>
      <td>251567.981</td>
      <td>420351.123</td>
      <td>412474.426</td>
      <td>256335.967</td>
      <td>191927.443</td>
      <td>543254.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>168175.76</td>
      <td>116404.995</td>
      <td>99980.506</td>
      <td>147929.404</td>
      <td>151221.502</td>
      <td>125799.940</td>
      <td>56059.794</td>
      <td>158299.918</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>16578.00</td>
      <td>15515.500</td>
      <td>11196.130</td>
      <td>16450.877</td>
      <td>16823.293</td>
      <td>17068.153</td>
      <td>8138.062</td>
      <td>15777.551</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>17478.00</td>
      <td>16413.362</td>
      <td>11839.805</td>
      <td>17350.877</td>
      <td>17723.293</td>
      <td>17967.133</td>
      <td>9038.062</td>
      <td>16677.551</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>183440.38</td>
      <td>134383.675</td>
      <td>-</td>
      <td>183302.053</td>
      <td>178293.092</td>
      <td>181052.107</td>
      <td>55027.691</td>
      <td>174048.571</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>46813.58</td>
      <td>33673.335</td>
      <td>32334.792</td>
      <td>45715.930</td>
      <td>46687.096</td>
      <td>44966.290</td>
      <td>13984.072</td>
      <td>43950.878</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>153513.102</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>48025.06</td>
      <td>-</td>
      <td>33391.659</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>43845.653</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="generated-tokens-metrics">
<h3>generated_tokens_metrics<a class="headerlink" href="#generated-tokens-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infrences_metrics</span> <span class="o">=</span> <span class="n">select_metrics</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Generated Tokens&#39;</span><span class="p">)</span>
<span class="n">summarize_metrics</span><span class="p">(</span><span class="n">infrences_metrics</span><span class="p">,</span> <span class="s2">&quot;Generated Tokens&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Published Generated Tokens from ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2581.35</td>
      <td>2460.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.00</td>
      <td>49500.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8441.60</td>
      <td>7785.4</td>
      <td>-</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2303.30</td>
      <td>2268.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2302.30</td>
      <td>2287.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>626.90</td>
      <td>621.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2910.00</td>
      <td>2814.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.00</td>
      <td>49500.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8869.10</td>
      <td>8638.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2418.60</td>
      <td>2443.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2334.50</td>
      <td>2317.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>647.40</td>
      <td>638.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2824.00</td>
      <td>2707.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.00</td>
      <td>49500.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8705.30</td>
      <td>8428.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2304.00</td>
      <td>2404.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2341.60</td>
      <td>2339.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>650.50</td>
      <td>640.6</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Measured Generated Tokens ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>1262.36</td>
      <td>2200.980</td>
      <td>858.542</td>
      <td>1222.053</td>
      <td>1223.446</td>
      <td>-</td>
      <td>3062.412</td>
      <td>1448.531</td>
      <td>2584.047</td>
      <td>2479.050</td>
      <td>1230.762</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.000</td>
      <td>49500.000</td>
      <td>48536.190</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>8801.80</td>
      <td>7733.300</td>
      <td>5723.669</td>
      <td>8148.421</td>
      <td>5282.048</td>
      <td>-</td>
      <td>6944.742</td>
      <td>8491.837</td>
      <td>8441.395</td>
      <td>7815.500</td>
      <td>6587.143</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>2414.00</td>
      <td>2246.375</td>
      <td>1675.974</td>
      <td>2141.579</td>
      <td>1822.249</td>
      <td>1993.000</td>
      <td>2093.505</td>
      <td>2233.061</td>
      <td>2309.767</td>
      <td>2267.500</td>
      <td>2115.714</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>1557.30</td>
      <td>1517.788</td>
      <td>1105.877</td>
      <td>1510.965</td>
      <td>1509.337</td>
      <td>-</td>
      <td>1522.835</td>
      <td>1509.592</td>
      <td>1504.419</td>
      <td>1514.325</td>
      <td>1533.571</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>387.50</td>
      <td>379.550</td>
      <td>270.227</td>
      <td>377.193</td>
      <td>373.976</td>
      <td>345.833</td>
      <td>381.443</td>
      <td>381.837</td>
      <td>383.837</td>
      <td>382.850</td>
      <td>361.905</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>1245.48</td>
      <td>2680.315</td>
      <td>897.971</td>
      <td>1203.298</td>
      <td>1208.847</td>
      <td>1200.613</td>
      <td>3390.196</td>
      <td>1786.265</td>
      <td>2911.349</td>
      <td>2829.295</td>
      <td>1227.762</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.000</td>
      <td>49500.000</td>
      <td>48536.190</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>9144.00</td>
      <td>8329.200</td>
      <td>5013.344</td>
      <td>7344.737</td>
      <td>7716.225</td>
      <td>6557.100</td>
      <td>8031.753</td>
      <td>9046.735</td>
      <td>8869.070</td>
      <td>8697.350</td>
      <td>5493.810</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>2522.40</td>
      <td>2393.750</td>
      <td>1648.506</td>
      <td>2298.947</td>
      <td>2413.173</td>
      <td>2169.600</td>
      <td>2337.938</td>
      <td>2549.592</td>
      <td>2417.674</td>
      <td>2455.200</td>
      <td>2086.667</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>0.00</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>1567.20</td>
      <td>1532.088</td>
      <td>1097.185</td>
      <td>1522.719</td>
      <td>1526.526</td>
      <td>1564.950</td>
      <td>1528.093</td>
      <td>1554.184</td>
      <td>1572.326</td>
      <td>1560.975</td>
      <td>1558.810</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>398.10</td>
      <td>379.225</td>
      <td>279.886</td>
      <td>383.158</td>
      <td>393.293</td>
      <td>378.133</td>
      <td>384.330</td>
      <td>395.306</td>
      <td>386.279</td>
      <td>384.200</td>
      <td>364.524</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2818.814</td>
      <td>2706.530</td>
      <td>1228.190</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>49500.000</td>
      <td>49500.000</td>
      <td>48536.190</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8700.000</td>
      <td>8553.950</td>
      <td>7181.429</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2393.488</td>
      <td>2413.500</td>
      <td>2139.048</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1498.596</td>
      <td>-</td>
      <td>1533.150</td>
      <td>-</td>
      <td>-</td>
      <td>1562.442</td>
      <td>1559.000</td>
      <td>1513.810</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>401.10</td>
      <td>-</td>
      <td>282.792</td>
      <td>387.807</td>
      <td>399.900</td>
      <td>384.233</td>
      <td>-</td>
      <td>-</td>
      <td>388.721</td>
      <td>391.175</td>
      <td>364.286</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>228437.372</td>
      <td>230066.935</td>
      <td>-</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>57918.512</td>
      <td>58976.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>68704.465</td>
      <td>69659.790</td>
      <td>-</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20374.884</td>
      <td>22587.395</td>
      <td>-</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20943.814</td>
      <td>21197.010</td>
      <td>-</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>228338.581</td>
      <td>230002.675</td>
      <td>-</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>57918.512</td>
      <td>58976.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>68704.465</td>
      <td>69659.790</td>
      <td>-</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>17779.953</td>
      <td>18113.830</td>
      <td>-</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20798.093</td>
      <td>21109.970</td>
      <td>-</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>140124.000</td>
      <td>142349.930</td>
      <td>-</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>43248.140</td>
      <td>44659.460</td>
      <td>-</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>51302.140</td>
      <td>52463.310</td>
      <td>-</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>14065.023</td>
      <td>14471.025</td>
      <td>-</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16695.256</td>
      <td>17086.150</td>
      <td>-</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>135705.930</td>
      <td>137634.705</td>
      <td>-</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>370881.349</td>
      <td>386694.010</td>
      <td>-</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>106583.442</td>
      <td>107554.050</td>
      <td>-</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>120000.651</td>
      <td>122939.835</td>
      <td>-</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>30480.140</td>
      <td>30901.285</td>
      <td>-</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>145246.907</td>
      <td>146746.405</td>
      <td>-</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>465546.977</td>
      <td>471208.190</td>
      <td>-</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>128993.767</td>
      <td>126791.250</td>
      <td>-</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>120997.116</td>
      <td>116514.605</td>
      <td>-</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>34662.605</td>
      <td>34299.300</td>
      <td>-</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>146081.488</td>
      <td>147708.770</td>
      <td>-</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>56866.047</td>
      <td>57033.060</td>
      <td>-</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>65469.907</td>
      <td>66485.480</td>
      <td>-</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>43514.465</td>
      <td>49224.050</td>
      <td>-</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>23661.326</td>
      <td>23756.795</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Modified Generated Tokens ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>8911.0</td>
      <td>8597.600</td>
      <td>5800.455</td>
      <td>8321.754</td>
      <td>7652.289</td>
      <td>5987.267</td>
      <td>7920.619</td>
      <td>9141.633</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>2389.0</td>
      <td>2373.125</td>
      <td>1695.812</td>
      <td>2250.000</td>
      <td>2238.394</td>
      <td>1992.933</td>
      <td>2225.567</td>
      <td>2452.449</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>1472.0</td>
      <td>1243.225</td>
      <td>-</td>
      <td>1409.737</td>
      <td>1430.301</td>
      <td>1537.317</td>
      <td>1421.804</td>
      <td>1395.408</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>382.5</td>
      <td>368.538</td>
      <td>268.101</td>
      <td>371.316</td>
      <td>367.149</td>
      <td>355.017</td>
      <td>370.515</td>
      <td>367.347</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>9009.0</td>
      <td>-</td>
      <td>3830.584</td>
      <td>6227.368</td>
      <td>6114.378</td>
      <td>3756.200</td>
      <td>7437.010</td>
      <td>8613.878</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>2514.2</td>
      <td>2294.700</td>
      <td>1520.747</td>
      <td>2191.754</td>
      <td>2239.036</td>
      <td>1838.833</td>
      <td>2179.691</td>
      <td>2492.041</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>1542.1</td>
      <td>1515.838</td>
      <td>-</td>
      <td>1527.807</td>
      <td>1490.743</td>
      <td>1497.567</td>
      <td>1482.216</td>
      <td>1539.184</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>391.3</td>
      <td>377.638</td>
      <td>273.149</td>
      <td>378.947</td>
      <td>387.892</td>
      <td>369.883</td>
      <td>376.134</td>
      <td>384.490</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1360.041</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>400.6</td>
      <td>-</td>
      <td>281.981</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>383.776</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="latency-metrics">
<h3>latency_metrics<a class="headerlink" href="#latency-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infrences_metrics</span> <span class="o">=</span> <span class="n">select_metrics</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Latency (s)&#39;</span><span class="p">)</span>
<span class="n">summarize_metrics</span><span class="p">(</span><span class="n">infrences_metrics</span><span class="p">,</span> <span class="s2">&quot;Latency (s)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Published Latency (s) from ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>77</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>54.2</td>
      <td>52.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>109.6</td>
      <td>108.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>58.3</td>
      <td>54.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>16.1</td>
      <td>16.1</td>
      <td>-</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.6</td>
      <td>0.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0.6</td>
      <td>0.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>29.1</td>
      <td>28.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>85</th>
      <td>Published</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>71.4</td>
      <td>69.0</td>
      <td>-</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>12.5</td>
      <td>12.6</td>
      <td>-</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>254.9</td>
      <td>254.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>75.1</td>
      <td>74.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20.5</td>
      <td>20.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1.4</td>
      <td>1.4</td>
      <td>-</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1.5</td>
      <td>1.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>93</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>35.2</td>
      <td>35.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Published</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>9.6</td>
      <td>9.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>100.1</td>
      <td>97.3</td>
      <td>-</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>36.6</td>
      <td>36.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>730.2</td>
      <td>730.5</td>
      <td>-</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>162.5</td>
      <td>158.8</td>
      <td>-</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>45.2</td>
      <td>45.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3.7</td>
      <td>3.7</td>
      <td>-</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3.9</td>
      <td>3.9</td>
      <td>-</td>
    </tr>
    <tr>
      <th>102</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>72.6</td>
      <td>73.2</td>
      <td>-</td>
    </tr>
    <tr>
      <th>103</th>
      <td>Published</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>20.2</td>
      <td>20.0</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Measured Latency (s) ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.generation</td>
      <td>62.053</td>
      <td>47.970</td>
      <td>42.056</td>
      <td>30.414</td>
      <td>30.360</td>
      <td>-</td>
      <td>73.025</td>
      <td>74.662</td>
      <td>71.409</td>
      <td>69.529</td>
      <td>32.621</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>listwise.likelihood</td>
      <td>23.692</td>
      <td>12.438</td>
      <td>18.024</td>
      <td>12.814</td>
      <td>13.933</td>
      <td>16.832</td>
      <td>11.747</td>
      <td>23.650</td>
      <td>12.644</td>
      <td>12.054</td>
      <td>12.825</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>434.994</td>
      <td>439.184</td>
      <td>426.645</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>144.553</td>
      <td>57.976</td>
      <td>91.869</td>
      <td>70.689</td>
      <td>47.576</td>
      <td>-</td>
      <td>52.662</td>
      <td>144.675</td>
      <td>72.091</td>
      <td>65.930</td>
      <td>56.485</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>42.335</td>
      <td>18.311</td>
      <td>26.988</td>
      <td>19.120</td>
      <td>16.986</td>
      <td>23.137</td>
      <td>15.931</td>
      <td>35.805</td>
      <td>22.608</td>
      <td>19.643</td>
      <td>17.767</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>0.862</td>
      <td>0.898</td>
      <td>0.824</td>
      <td>1.001</td>
      <td>1.022</td>
      <td>1.018</td>
      <td>0.599</td>
      <td>0.861</td>
      <td>0.667</td>
      <td>0.612</td>
      <td>0.632</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>0.914</td>
      <td>0.934</td>
      <td>0.844</td>
      <td>1.060</td>
      <td>1.081</td>
      <td>-</td>
      <td>0.617</td>
      <td>0.897</td>
      <td>0.669</td>
      <td>0.614</td>
      <td>0.655</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>46.970</td>
      <td>24.127</td>
      <td>34.852</td>
      <td>26.694</td>
      <td>27.234</td>
      <td>-</td>
      <td>21.986</td>
      <td>47.619</td>
      <td>25.145</td>
      <td>24.448</td>
      <td>30.009</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Measured</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>12.292</td>
      <td>5.675</td>
      <td>8.772</td>
      <td>6.656</td>
      <td>6.854</td>
      <td>7.343</td>
      <td>5.540</td>
      <td>12.436</td>
      <td>6.197</td>
      <td>6.291</td>
      <td>5.769</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.generation</td>
      <td>63.175</td>
      <td>66.964</td>
      <td>43.632</td>
      <td>51.401</td>
      <td>52.044</td>
      <td>59.821</td>
      <td>80.806</td>
      <td>95.582</td>
      <td>81.161</td>
      <td>82.001</td>
      <td>36.658</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>listwise.likelihood</td>
      <td>23.272</td>
      <td>12.937</td>
      <td>16.678</td>
      <td>21.536</td>
      <td>20.741</td>
      <td>22.209</td>
      <td>10.963</td>
      <td>23.743</td>
      <td>12.384</td>
      <td>12.259</td>
      <td>12.516</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>499.156</td>
      <td>501.004</td>
      <td>521.665</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>75.556</td>
      <td>75.550</td>
      <td>79.220</td>
      <td>103.886</td>
      <td>110.347</td>
      <td>103.395</td>
      <td>61.432</td>
      <td>144.621</td>
      <td>85.882</td>
      <td>84.606</td>
      <td>79.168</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>106.666</td>
      <td>21.202</td>
      <td>27.374</td>
      <td>32.807</td>
      <td>34.930</td>
      <td>35.192</td>
      <td>18.142</td>
      <td>43.425</td>
      <td>23.748</td>
      <td>24.074</td>
      <td>22.429</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>1.253</td>
      <td>1.569</td>
      <td>1.022</td>
      <td>1.553</td>
      <td>1.558</td>
      <td>1.258</td>
      <td>1.005</td>
      <td>1.220</td>
      <td>1.177</td>
      <td>1.156</td>
      <td>1.240</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>1.289</td>
      <td>1.639</td>
      <td>1.044</td>
      <td>1.608</td>
      <td>1.792</td>
      <td>1.325</td>
      <td>1.070</td>
      <td>1.248</td>
      <td>1.230</td>
      <td>1.233</td>
      <td>1.319</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>25.731</td>
      <td>26.287</td>
      <td>33.363</td>
      <td>41.369</td>
      <td>42.672</td>
      <td>48.315</td>
      <td>21.775</td>
      <td>48.463</td>
      <td>28.514</td>
      <td>28.792</td>
      <td>31.575</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Measured</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>6.280</td>
      <td>6.456</td>
      <td>8.810</td>
      <td>10.710</td>
      <td>10.739</td>
      <td>11.824</td>
      <td>5.344</td>
      <td>12.866</td>
      <td>7.119</td>
      <td>7.119</td>
      <td>7.516</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>102.765</td>
      <td>97.985</td>
      <td>59.995</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>26.537</td>
      <td>27.060</td>
      <td>32.505</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.allpair</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>809.632</td>
      <td>829.687</td>
      <td>944.147</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>140.494</td>
      <td>140.108</td>
      <td>138.405</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>39.106</td>
      <td>39.658</td>
      <td>42.441</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.qlm</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8.389</td>
      <td>-</td>
      <td>3.108</td>
      <td>3.098</td>
      <td>3.196</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>pointwise.yes_no</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8.548</td>
      <td>-</td>
      <td>3.250</td>
      <td>3.254</td>
      <td>3.377</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1267.979</td>
      <td>-</td>
      <td>204.953</td>
      <td>-</td>
      <td>-</td>
      <td>48.804</td>
      <td>49.503</td>
      <td>59.554</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Measured</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>255.770</td>
      <td>-</td>
      <td>38.139</td>
      <td>250.440</td>
      <td>122.206</td>
      <td>51.911</td>
      <td>-</td>
      <td>-</td>
      <td>12.296</td>
      <td>12.444</td>
      <td>14.328</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>389.564</td>
      <td>403.451</td>
      <td>-</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>18.892</td>
      <td>19.095</td>
      <td>-</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>10.204</td>
      <td>10.344</td>
      <td>-</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>12.084</td>
      <td>12.190</td>
      <td>-</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3.763</td>
      <td>4.151</td>
      <td>-</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Measured</td>
      <td>llama-2-13b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3.713</td>
      <td>3.783</td>
      <td>-</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>301.842</td>
      <td>297.087</td>
      <td>-</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>11.011</td>
      <td>11.124</td>
      <td>-</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>5.682</td>
      <td>5.726</td>
      <td>-</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>6.689</td>
      <td>6.749</td>
      <td>-</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1.948</td>
      <td>1.957</td>
      <td>-</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Measured</td>
      <td>llama-2-7b-hf</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2.127</td>
      <td>2.166</td>
      <td>-</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>216.815</td>
      <td>221.581</td>
      <td>-</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>11.040</td>
      <td>11.279</td>
      <td>-</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>5.092</td>
      <td>5.220</td>
      <td>-</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>5.979</td>
      <td>6.119</td>
      <td>-</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1.841</td>
      <td>1.872</td>
      <td>-</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Measured</td>
      <td>llama-3.1-8B</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1.986</td>
      <td>2.034</td>
      <td>-</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>109.825</td>
      <td>109.955</td>
      <td>-</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>10.976</td>
      <td>11.209</td>
      <td>-</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>42.791</td>
      <td>44.217</td>
      <td>-</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>12.274</td>
      <td>12.282</td>
      <td>-</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>14.291</td>
      <td>14.482</td>
      <td>-</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Measured</td>
      <td>llama-3.1-8B-Instruct</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>3.588</td>
      <td>3.645</td>
      <td>-</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>403.466</td>
      <td>399.242</td>
      <td>-</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>18.942</td>
      <td>65.286</td>
      <td>-</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>84.909</td>
      <td>85.598</td>
      <td>-</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>75.663</td>
      <td>59.528</td>
      <td>-</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>74.478</td>
      <td>74.368</td>
      <td>-</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Measured</td>
      <td>vicuna-13b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>21.575</td>
      <td>20.967</td>
      <td>-</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.generation</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>94.625</td>
      <td>96.715</td>
      <td>-</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>listwise.likelihood</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>11.361</td>
      <td>11.470</td>
      <td>-</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>5.827</td>
      <td>5.796</td>
      <td>-</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>pairwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>6.668</td>
      <td>6.751</td>
      <td>-</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>4.760</td>
      <td>5.397</td>
      <td>-</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Measured</td>
      <td>vicuna-7b-v1.5</td>
      <td>setwise.heapsort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>2.529</td>
      <td>2.544</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Modified Latency (s) ===
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe" id="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Dataset</th>
      <th>Source</th>
      <th>LLM</th>
      <th>Method</th>
      <th>Covid</th>
      <th>DBPedia</th>
      <th>NFCorpus</th>
      <th>News</th>
      <th>Robust04</th>
      <th>SciFact</th>
      <th>Signal</th>
      <th>Touche</th>
      <th>TrecDL19</th>
      <th>TrecDL20</th>
      <th>noveleval</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.bubblesort</td>
      <td>92.400</td>
      <td>78.871</td>
      <td>47.526</td>
      <td>64.668</td>
      <td>66.486</td>
      <td>56.253</td>
      <td>57.292</td>
      <td>93.026</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pairwise.heapsort</td>
      <td>24.854</td>
      <td>22.380</td>
      <td>12.559</td>
      <td>17.165</td>
      <td>17.351</td>
      <td>18.665</td>
      <td>16.400</td>
      <td>25.571</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.qlm</td>
      <td>1.311</td>
      <td>0.913</td>
      <td>0.726</td>
      <td>0.875</td>
      <td>0.788</td>
      <td>0.940</td>
      <td>0.635</td>
      <td>1.279</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>pointwise.yes_no</td>
      <td>1.340</td>
      <td>0.951</td>
      <td>0.759</td>
      <td>0.770</td>
      <td>0.854</td>
      <td>0.956</td>
      <td>0.657</td>
      <td>1.329</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.bubblesort</td>
      <td>23.308</td>
      <td>14.155</td>
      <td>-</td>
      <td>16.626</td>
      <td>18.448</td>
      <td>20.159</td>
      <td>20.071</td>
      <td>21.634</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Modified</td>
      <td>flan-t5-large</td>
      <td>setwise.heapsort</td>
      <td>5.514</td>
      <td>5.259</td>
      <td>3.719</td>
      <td>5.895</td>
      <td>5.099</td>
      <td>4.885</td>
      <td>4.383</td>
      <td>5.977</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.bubblesort</td>
      <td>109.500</td>
      <td>-</td>
      <td>43.512</td>
      <td>67.155</td>
      <td>69.033</td>
      <td>28.904</td>
      <td>57.940</td>
      <td>99.562</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pairwise.heapsort</td>
      <td>30.651</td>
      <td>16.073</td>
      <td>19.805</td>
      <td>29.138</td>
      <td>29.824</td>
      <td>16.564</td>
      <td>17.597</td>
      <td>30.203</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.qlm</td>
      <td>2.044</td>
      <td>1.548</td>
      <td>1.421</td>
      <td>1.831</td>
      <td>1.876</td>
      <td>1.657</td>
      <td>1.048</td>
      <td>2.005</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>pointwise.yes_no</td>
      <td>2.135</td>
      <td>1.650</td>
      <td>1.497</td>
      <td>1.949</td>
      <td>1.993</td>
      <td>1.757</td>
      <td>1.117</td>
      <td>2.081</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.bubblesort</td>
      <td>35.718</td>
      <td>27.686</td>
      <td>-</td>
      <td>30.745</td>
      <td>27.210</td>
      <td>34.583</td>
      <td>19.974</td>
      <td>32.505</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Modified</td>
      <td>flan-t5-xl</td>
      <td>setwise.heapsort</td>
      <td>9.076</td>
      <td>7.851</td>
      <td>5.316</td>
      <td>7.644</td>
      <td>7.836</td>
      <td>8.360</td>
      <td>5.271</td>
      <td>8.848</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.bubblesort</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>323.614</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Modified</td>
      <td>flan-t5-xxl</td>
      <td>setwise.heapsort</td>
      <td>96.485</td>
      <td>-</td>
      <td>68.116</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>91.931</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">def</span> <span class="nf">analyze_trec_metric</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes BEIR NDCG@10 scores, comparing published vs measured values across LLMs, methods, and datasets.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe with columns Source, LLM, Dataset, Method, Metric_Name, Metric_Value</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[pd.DataFrame, List[plt.Figure]]: Tables and figures for the analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="c1"># Filter for relevant data</span>
    <span class="n">relevant_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TrecDL19&#39;</span><span class="p">,</span> <span class="s1">&#39;TrecDL20&#39;</span><span class="p">]</span>
    <span class="n">relevant_llms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">]</span>
    
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">relevant_datasets</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">relevant_llms</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Published&#39;</span><span class="p">,</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]))</span>
    <span class="p">]</span>
    
    <span class="c1"># Create comparison table</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Calculate differences</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Measured&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Published&#39;</span><span class="p">]</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Relative_Difference_%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Published&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Factor_Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Measured&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Published&#39;</span><span class="p">]</span>
    
    <span class="c1"># Sort by absolute difference</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Generate figures</span>
    <span class="n">figures</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># 1. Heatmap of absolute differences by Dataset and Method for each LLM</span>
    <span class="c1"># for llm in relevant_llms:</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(scale*15, scale*8))</span>
    <span class="c1">#     heatmap_data = pivot_table[pivot_table[&#39;LLM&#39;] == llm].pivot(</span>
    <span class="c1">#         index=&#39;Dataset&#39;,</span>
    <span class="c1">#         columns=&#39;Method&#39;,</span>
    <span class="c1">#         values=&#39;Difference&#39;</span>
    <span class="c1">#     )</span>
        
    <span class="c1">#     sns.heatmap(heatmap_data, </span>
    <span class="c1">#                cmap=&#39;RdYlBu&#39;,</span>
    <span class="c1">#                center=0,</span>
    <span class="c1">#                annot=True,</span>
    <span class="c1">#                fmt=&#39;.3f&#39;,</span>
    <span class="c1">#                ax=ax)</span>
        
    <span class="c1">#     plt.tick_params(axis=&#39;x&#39;, labelsize=9)</span>
    <span class="c1">#     plt.xticks(rotation=30)</span>
    <span class="c1">#     plt.xlabel(&#39;&#39;)  # Remove x-label</span>
    <span class="c1">#     plt.ylabel(&#39;&#39;)  # Remove y-label</span>

    <span class="c1">#     plt.title(f&#39;Published vs Measured Difference {metric_name} for {llm}&#39;)</span>
    <span class="c1">#     plt.tight_layout()</span>
    <span class="c1">#     figures.append(fig)</span>

    <span class="c1"># 2. Heatmap of relative differences (%) by Dataset and Method for each LLM</span>
    <span class="k">for</span> <span class="n">llm</span> <span class="ow">in</span> <span class="n">relevant_llms</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height2</span><span class="p">))</span>
        <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Relative_Difference_%&#39;</span>
        <span class="p">)</span>
        
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">,</span> 
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
                   <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Remove colorbar</span>
                   <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span>
                   <span class="n">vmin</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span>
                   <span class="n">vmax</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove x-label</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove y-label</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1"> % Discrepancy (Measured vs Published) for </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># plt.tight_layout()</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/measured_published_trecdl_heatmap_pdiff_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">llm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

        <span class="n">figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;Latency (s)&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">llm</span> <span class="ow">in</span> <span class="n">relevant_llms</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height2</span><span class="p">))</span>
            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Factor_Difference&#39;</span>
            <span class="p">)</span>
            
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">,</span> 
                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
                    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Remove colorbar</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove x-label</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove y-label</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1"> Discrepancy Factor (Measured/Published) for </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># plt.tight_layout()</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/measured_published_trecdl_heatmap_fdiff_</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">llm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

            <span class="n">figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    
    <span class="c1"># # 3. Box plot of differences by Dataset</span>
    <span class="c1"># if metric_name == &#39;NDCG@10&#39;:</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(hmap_width, hmap_height))</span>
    <span class="c1">#     sns.boxplot(data=pivot_table, x=&#39;Method&#39;, y=&#39;Relative_Difference_%&#39;, hue=&#39;LLM&#39;, ax=ax)</span>
    <span class="c1">#     plt.xticks(rotation=30)</span>
    <span class="c1">#     plt.yticks(rotation=30)</span>
    <span class="c1">#     plt.tick_params(axis=&#39;x&#39;, labelsize=9)</span>

    <span class="c1">#     plt.ylim(-10, 10)  # Set y-axis limits</span>
    <span class="c1">#     # if metric_name == &#39;NDCG@10&#39;:</span>
    <span class="c1">#     #     plt.ylim(-0.10, 0.10)  # Set y-axis limits</span>
        
    <span class="c1">#     # if metric_name == &#39;Inferences&#39;:</span>
    <span class="c1">#     #     plt.ylim(-3000, 3000)</span>

        
    <span class="c1">#     plt.xlabel(&#39;&#39;)  # Remove x-label</span>
    <span class="c1">#     plt.ylabel(f&#39;% Difference ({metric_name})&#39;)  </span>
    <span class="c1">#     plt.title(&#39;Measured vs Published Difference&#39;)</span>
    <span class="c1">#     plt.tight_layout()</span>

    <span class="c1">#     filename = f&#39;doc/_generated/measured_published_trecdl_pdiff_method_boxplot{metric_name.replace(&quot; &quot;, &quot;&quot;)}.png&#39;</span>
    <span class="c1">#     plt.savefig(filename, bbox_inches=&#39;tight&#39;, dpi=150)</span>

    <span class="c1">#     figures.append(fig)</span>
    
    <span class="k">return</span> <span class="n">pivot_table</span><span class="p">,</span> <span class="n">figures</span>


<span class="k">def</span> <span class="nf">format_results_metric</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats the analysis results into a markdown string suitable for a research paper.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        table (pd.DataFrame): The comparison table generated by analyze_beir_ndcg</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Formatted markdown string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">markdown</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# TREC 19/20 </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: Measured vs Published Results</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Overall statistics</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;## Summary Statistics</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Mean absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Median absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Maximum absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Results by LLM</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Results by LLM</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">llm_stats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;LLM&#39;</span><span class="p">)[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="n">llm_stats</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span>
    
    <span class="c1"># Most significant differences</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">## Most Significant Differences</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">significant_diffs</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Already sorted by absolute difference</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="n">significant_diffs</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">markdown</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="results-measured-vs-published">
<h1>Results: Measured vs Published<a class="headerlink" href="#results-measured-vs-published" title="Link to this heading">#</a></h1>
<section id="measured-vs-published-trecdl-ndcg-10">
<h2>Measured vs Published: TrecDL NDCG&#64;10<a class="headerlink" href="#measured-vs-published-trecdl-ndcg-10" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO drop rows where adjusted_df has Method = &#39;bm25&#39;</span>
<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df</span><span class="p">[</span><span class="n">adjusted_df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bm25&#39;</span><span class="p">]</span>

<span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_trec_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_results_metric</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># TREC 19/20 NDCG@10: Measured vs Published Results

## Summary Statistics

* Mean absolute difference: 0.003
* Median absolute difference: 0.001
* Maximum absolute difference: 0.025

## Results by LLM

| LLM           |   mean |   std |   count |
|:--------------|-------:|------:|--------:|
| flan-t5-large | -0.002 | 0.006 |      18 |
| flan-t5-xl    |  0     | 0.006 |      18 |
| flan-t5-xxl   | -0.003 | 0.008 |      18 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Measured |   Published |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|------------:|-------------:|------------------------:|--------------------:|
| 26 | TrecDL19  | flan-t5-xxl   | setwise.heapsort    |      0.681 |       0.706 |       -0.025 |                   -3.54 |            0.964589 |
| 47 | TrecDL20  | flan-t5-xxl   | pairwise.allpair    |      0.689 |       0.709 |       -0.02  |                   -2.82 |            0.971791 |
|  8 | TrecDL19  | flan-t5-large | setwise.heapsort    |      0.652 |       0.67  |       -0.018 |                   -2.69 |            0.973134 |
| 41 | TrecDL20  | flan-t5-xl    | pointwise.qlm       |      0.542 |       0.524 |        0.018 |                    3.44 |            1.03435  |
| 35 | TrecDL20  | flan-t5-large | setwise.heapsort    |      0.603 |       0.618 |       -0.015 |                   -2.43 |            0.975728 |
| 44 | TrecDL20  | flan-t5-xl    | setwise.heapsort    |      0.666 |       0.678 |       -0.012 |                   -1.77 |            0.982301 |
| 20 | TrecDL19  | flan-t5-xxl   | pairwise.allpair    |      0.699 |       0.709 |       -0.01  |                   -1.41 |            0.985896 |
|  7 | TrecDL19  | flan-t5-large | setwise.bubblesort  |      0.687 |       0.678 |        0.009 |                    1.33 |            1.01327  |
| 43 | TrecDL20  | flan-t5-xl    | setwise.bubblesort  |      0.684 |       0.676 |        0.008 |                    1.18 |            1.01183  |
| 16 | TrecDL19  | flan-t5-xl    | setwise.bubblesort  |      0.699 |       0.705 |       -0.006 |                   -0.85 |            0.991489 |
| 52 | TrecDL20  | flan-t5-xxl   | setwise.bubblesort  |      0.692 |       0.686 |        0.006 |                    0.87 |            1.00875  |
|  1 | TrecDL19  | flan-t5-large | listwise.likelihood |      0.664 |       0.669 |       -0.005 |                   -0.75 |            0.992526 |
| 17 | TrecDL19  | flan-t5-xl    | setwise.heapsort    |      0.688 |       0.693 |       -0.005 |                   -0.72 |            0.992785 |
| 22 | TrecDL19  | flan-t5-xxl   | pairwise.heapsort   |      0.704 |       0.708 |       -0.004 |                   -0.56 |            0.99435  |
| 34 | TrecDL20  | flan-t5-large | setwise.bubblesort  |      0.627 |       0.624 |        0.003 |                    0.48 |            1.00481  |
|  5 | TrecDL19  | flan-t5-large | pointwise.qlm       |      0.555 |       0.557 |       -0.002 |                   -0.36 |            0.996409 |
| 10 | TrecDL19  | flan-t5-xl    | listwise.likelihood |      0.691 |       0.689 |        0.002 |                    0.29 |            1.0029   |
| 18 | TrecDL19  | flan-t5-xxl   | listwise.generation |      0.66  |       0.662 |       -0.002 |                   -0.3  |            0.996979 |
| 30 | TrecDL20  | flan-t5-large | pairwise.bubblesort |      0.587 |       0.589 |       -0.002 |                   -0.34 |            0.996604 |
| 50 | TrecDL20  | flan-t5-xxl   | pointwise.qlm       |      0.49  |       0.492 |       -0.002 |                   -0.41 |            0.995935 |
| 32 | TrecDL20  | flan-t5-large | pointwise.qlm       |      0.565 |       0.567 |       -0.002 |                   -0.35 |            0.996473 |
| 25 | TrecDL19  | flan-t5-xxl   | setwise.bubblesort  |      0.709 |       0.711 |       -0.002 |                   -0.28 |            0.997187 |
| 53 | TrecDL20  | flan-t5-xxl   | setwise.heapsort    |      0.686 |       0.688 |       -0.002 |                   -0.29 |            0.997093 |
| 24 | TrecDL19  | flan-t5-xxl   | pointwise.yes_no    |      0.643 |       0.644 |       -0.001 |                   -0.16 |            0.998447 |
| 14 | TrecDL19  | flan-t5-xl    | pointwise.qlm       |      0.541 |       0.542 |       -0.001 |                   -0.18 |            0.998155 |
| 19 | TrecDL19  | flan-t5-xxl   | listwise.likelihood |      0.702 |       0.701 |        0.001 |                    0.14 |            1.00143  |
|  4 | TrecDL19  | flan-t5-large | pairwise.heapsort   |      0.656 |       0.657 |       -0.001 |                   -0.15 |            0.998478 |
| 49 | TrecDL20  | flan-t5-xxl   | pairwise.heapsort   |      0.698 |       0.699 |       -0.001 |                   -0.14 |            0.998569 |
| 36 | TrecDL20  | flan-t5-xl    | listwise.generation |      0.546 |       0.547 |       -0.001 |                   -0.18 |            0.998172 |
| 23 | TrecDL19  | flan-t5-xxl   | pointwise.qlm       |      0.507 |       0.506 |        0.001 |                    0.2  |            1.00198  |
</pre></div>
</div>
<img alt="_images/a5ad87b18c1ac49c2354e8d834b4d56aa17afaa884d6e6c597c9786e3dfa51d3.png" src="_images/a5ad87b18c1ac49c2354e8d834b4d56aa17afaa884d6e6c597c9786e3dfa51d3.png" />
<img alt="_images/6f4e95f3881d14eb1b229b5c7233e4524304adee11b6218289f51c5a831db19f.png" src="_images/6f4e95f3881d14eb1b229b5c7233e4524304adee11b6218289f51c5a831db19f.png" />
<img alt="_images/0968ff006ed165b2ae4ef6bffcc5071d3c7725fb26f3f3514a4b6ec49eed8af8.png" src="_images/0968ff006ed165b2ae4ef6bffcc5071d3c7725fb26f3f3514a4b6ec49eed8af8.png" />
</div>
</div>
</section>
<section id="measured-vs-published-trecdl-query-latency">
<h2>Measured vs Published: TrecDL Query Latency<a class="headerlink" href="#measured-vs-published-trecdl-query-latency" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_trec_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Latency (s)&#39;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_results_metric</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Latency (s)&#39;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># TREC 19/20 Latency (s): Measured vs Published Results

## Summary Statistics

* Mean absolute difference: 30.059
* Median absolute difference: 4.997
* Maximum absolute difference: 330.284

## Results by LLM

| LLM           |   mean |     std |   count |
|:--------------|-------:|--------:|--------:|
| flan-t5-large | 39.952 | 104.959 |      18 |
| flan-t5-xl    | 28.951 |  78.889 |      18 |
| flan-t5-xxl   |  2.46  |  32.894 |      18 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Measured |   Published |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|------------:|-------------:|------------------------:|--------------------:|
| 29 | TrecDL20  | flan-t5-large | pairwise.allpair    |    439.184 |       108.9 |      330.284 |                  303.29 |            4.03291  |
|  2 | TrecDL19  | flan-t5-large | pairwise.allpair    |    434.994 |       109.6 |      325.394 |                  296.89 |            3.96892  |
| 38 | TrecDL20  | flan-t5-xl    | pairwise.allpair    |    501.004 |       254.8 |      246.204 |                   96.63 |            1.96626  |
| 11 | TrecDL19  | flan-t5-xl    | pairwise.allpair    |    499.156 |       254.9 |      244.256 |                   95.82 |            1.95824  |
| 47 | TrecDL20  | flan-t5-xxl   | pairwise.allpair    |    829.687 |       730.5 |       99.187 |                   13.58 |            1.13578  |
| 20 | TrecDL19  | flan-t5-xxl   | pairwise.allpair    |    809.632 |       730.2 |       79.432 |                   10.88 |            1.10878  |
| 25 | TrecDL19  | flan-t5-xxl   | setwise.bubblesort  |     48.804 |        72.6 |      -23.796 |                  -32.78 |            0.672231 |
| 52 | TrecDL20  | flan-t5-xxl   | setwise.bubblesort  |     49.503 |        73.2 |      -23.697 |                  -32.37 |            0.67627  |
| 21 | TrecDL19  | flan-t5-xxl   | pairwise.bubblesort |    140.494 |       162.5 |      -22.006 |                  -13.54 |            0.864578 |
| 48 | TrecDL20  | flan-t5-xxl   | pairwise.bubblesort |    140.108 |       158.8 |      -18.692 |                  -11.77 |            0.882292 |
| 27 | TrecDL20  | flan-t5-large | listwise.generation |     69.529 |        52   |       17.529 |                   33.71 |            1.3371   |
|  0 | TrecDL19  | flan-t5-large | listwise.generation |     71.409 |        54.2 |       17.209 |                   31.75 |            1.31751  |
|  3 | TrecDL19  | flan-t5-large | pairwise.bubblesort |     72.091 |        58.3 |       13.791 |                   23.66 |            1.23655  |
| 36 | TrecDL20  | flan-t5-xl    | listwise.generation |     82.001 |        69   |       13.001 |                   18.84 |            1.18842  |
| 30 | TrecDL20  | flan-t5-large | pairwise.bubblesort |     65.93  |        54.1 |       11.83  |                   21.87 |            1.21867  |
| 12 | TrecDL19  | flan-t5-xl    | pairwise.bubblesort |     85.882 |        75.1 |       10.782 |                   14.36 |            1.14357  |
| 39 | TrecDL20  | flan-t5-xl    | pairwise.bubblesort |     84.606 |        74.3 |       10.306 |                   13.87 |            1.13871  |
| 19 | TrecDL19  | flan-t5-xxl   | listwise.likelihood |     26.537 |        36.6 |      -10.063 |                  -27.49 |            0.725055 |
| 46 | TrecDL20  | flan-t5-xxl   | listwise.likelihood |     27.06  |        36.9 |       -9.84  |                  -26.67 |            0.733333 |
|  9 | TrecDL19  | flan-t5-xl    | listwise.generation |     81.161 |        71.4 |        9.761 |                   13.67 |            1.13671  |
| 26 | TrecDL19  | flan-t5-xxl   | setwise.heapsort    |     12.296 |        20.2 |       -7.904 |                  -39.13 |            0.608713 |
| 53 | TrecDL20  | flan-t5-xxl   | setwise.heapsort    |     12.444 |        20   |       -7.556 |                  -37.78 |            0.6222   |
| 16 | TrecDL19  | flan-t5-xl    | setwise.bubblesort  |     28.514 |        35.2 |       -6.686 |                  -18.99 |            0.810057 |
|  4 | TrecDL19  | flan-t5-large | pairwise.heapsort   |     22.608 |        16.1 |        6.508 |                   40.42 |            1.40422  |
| 43 | TrecDL20  | flan-t5-xl    | setwise.bubblesort  |     28.792 |        35.3 |       -6.508 |                  -18.44 |            0.815637 |
| 22 | TrecDL19  | flan-t5-xxl   | pairwise.heapsort   |     39.106 |        45.2 |       -6.094 |                  -13.48 |            0.865177 |
| 49 | TrecDL20  | flan-t5-xxl   | pairwise.heapsort   |     39.658 |        45.2 |       -5.542 |                  -12.26 |            0.877389 |
| 34 | TrecDL20  | flan-t5-large | setwise.bubblesort  |     24.448 |        28.9 |       -4.452 |                  -15.4  |            0.845952 |
|  7 | TrecDL19  | flan-t5-large | setwise.bubblesort  |     25.145 |        29.1 |       -3.955 |                  -13.59 |            0.864089 |
| 31 | TrecDL20  | flan-t5-large | pairwise.heapsort   |     19.643 |        16.1 |        3.543 |                   22.01 |            1.22006  |
</pre></div>
</div>
<img alt="_images/789ef4e5af78c8c23bfc13c2f002a9e85dfbe9250062d7e68b9525c0a7ed4bde.png" src="_images/789ef4e5af78c8c23bfc13c2f002a9e85dfbe9250062d7e68b9525c0a7ed4bde.png" />
<img alt="_images/cd60f3a4f69069fe2ea9e77a4dae353077d1c79b048c267899612044eb2791fa.png" src="_images/cd60f3a4f69069fe2ea9e77a4dae353077d1c79b048c267899612044eb2791fa.png" />
<img alt="_images/1cb7d93063d27d09540922bc5648a3c963719c9d8dcba8bc891c85c9cbe5ae1d.png" src="_images/1cb7d93063d27d09540922bc5648a3c963719c9d8dcba8bc891c85c9cbe5ae1d.png" />
<img alt="_images/c4ef66c70d20bd9ac9855c8f925cd2db97e98ca1b50190a65311d2d019948891.png" src="_images/c4ef66c70d20bd9ac9855c8f925cd2db97e98ca1b50190a65311d2d019948891.png" />
<img alt="_images/bebbeadf3de7d84bc4957902ff4eca70a37986334a12eb66f74dc2d5753f67a0.png" src="_images/bebbeadf3de7d84bc4957902ff4eca70a37986334a12eb66f74dc2d5753f67a0.png" />
<img alt="_images/7922ebd4df5da14c0b415dd70219ba3e61b643a00d0e85fecde2df1fa52e7e18.png" src="_images/7922ebd4df5da14c0b415dd70219ba3e61b643a00d0e85fecde2df1fa52e7e18.png" />
</div>
</div>
</section>
<section id="measured-vs-published-trecdl-inferences">
<h2>Measured vs Published: TrecDL #Inferences<a class="headerlink" href="#measured-vs-published-trecdl-inferences" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_trec_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Inferences&#39;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_results_metric</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Inferences&#39;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># TREC 19/20 Inferences: Measured vs Published Results

## Summary Statistics

* Mean absolute difference: 594.600
* Median absolute difference: 50.412
* Maximum absolute difference: 4950.000

## Results by LLM

| LLM           |     mean |     std |   count |
|:--------------|---------:|--------:|--------:|
| flan-t5-large | -593.933 | 1585.71 |      18 |
| flan-t5-xl    | -593.556 | 1585.82 |      18 |
| flan-t5-xxl   | -593.63  | 1585.83 |      18 |

## Most Significant Differences

|    | Dataset   | LLM           | Method             |   Measured |   Published |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:-------------------|-----------:|------------:|-------------:|------------------------:|--------------------:|
|  2 | TrecDL19  | flan-t5-large | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
| 11 | TrecDL19  | flan-t5-xl    | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
| 20 | TrecDL19  | flan-t5-xxl   | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
| 47 | TrecDL20  | flan-t5-xxl   | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
| 38 | TrecDL20  | flan-t5-xl    | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
| 29 | TrecDL20  | flan-t5-large | pairwise.allpair   |   4950     |      9900   |    -4950     |                  -50    |            0.5      |
|  7 | TrecDL19  | flan-t5-large | setwise.bubblesort |    300.884 |       460.5 |     -159.616 |                  -34.66 |            0.653385 |
| 52 | TrecDL20  | flan-t5-xxl   | setwise.bubblesort |    311.8   |       467.9 |     -156.1   |                  -33.36 |            0.666382 |
| 25 | TrecDL19  | flan-t5-xxl   | setwise.bubblesort |    312.488 |       468.3 |     -155.812 |                  -33.27 |            0.667282 |
| 34 | TrecDL20  | flan-t5-large | setwise.bubblesort |    302.865 |       457.4 |     -154.535 |                  -33.79 |            0.662145 |
| 16 | TrecDL19  | flan-t5-xl    | setwise.bubblesort |    314.465 |       466.9 |     -152.435 |                  -32.65 |            0.673517 |
| 43 | TrecDL20  | flan-t5-xl    | setwise.bubblesort |    312.195 |       463.5 |     -151.305 |                  -32.64 |            0.67356  |
| 14 | TrecDL19  | flan-t5-xl    | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 41 | TrecDL20  | flan-t5-xl    | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 24 | TrecDL19  | flan-t5-xxl   | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
| 15 | TrecDL19  | flan-t5-xl    | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
|  6 | TrecDL19  | flan-t5-large | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
| 33 | TrecDL20  | flan-t5-large | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
| 51 | TrecDL20  | flan-t5-xxl   | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
| 50 | TrecDL20  | flan-t5-xxl   | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 42 | TrecDL20  | flan-t5-xl    | pointwise.yes_no   |      4     |       100   |      -96     |                  -96    |            0.04     |
|  5 | TrecDL19  | flan-t5-large | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 23 | TrecDL19  | flan-t5-xxl   | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 32 | TrecDL20  | flan-t5-large | pointwise.qlm      |      4     |       100   |      -96     |                  -96    |            0.04     |
| 26 | TrecDL19  | flan-t5-xxl   | setwise.heapsort   |     77.744 |       130.1 |      -52.356 |                  -40.24 |            0.597571 |
| 17 | TrecDL19  | flan-t5-xl    | setwise.heapsort   |     77.256 |       129.5 |      -52.244 |                  -40.34 |            0.596571 |
| 44 | TrecDL20  | flan-t5-xl    | setwise.heapsort   |     76.84  |       127.8 |      -50.96  |                  -39.87 |            0.601252 |
| 53 | TrecDL20  | flan-t5-xxl   | setwise.heapsort   |     78.235 |       128.1 |      -49.865 |                  -38.93 |            0.610734 |
|  8 | TrecDL19  | flan-t5-large | setwise.heapsort   |     76.767 |       125.4 |      -48.633 |                  -38.78 |            0.612177 |
| 35 | TrecDL20  | flan-t5-large | setwise.heapsort   |     76.57  |       124.2 |      -47.63  |                  -38.35 |            0.616506 |
</pre></div>
</div>
<img alt="_images/8e55e52147fd719a6aeac389eb3441d36bfc08c25b54cf497c151572e7edca99.png" src="_images/8e55e52147fd719a6aeac389eb3441d36bfc08c25b54cf497c151572e7edca99.png" />
<img alt="_images/b9cbd6e70d389649e829c5a837f7b42ad3d4a6495fd520ace592dd1f92269a82.png" src="_images/b9cbd6e70d389649e829c5a837f7b42ad3d4a6495fd520ace592dd1f92269a82.png" />
<img alt="_images/8265e86e8868526da183f8bee0e6089584575832e51520ee792128a5a9d47e6f.png" src="_images/8265e86e8868526da183f8bee0e6089584575832e51520ee792128a5a9d47e6f.png" />
</div>
</div>
<p>Pointwise (yes_no and qlm) report that they only do an average of 4 inferences per query, when it should be 100. The reason to this is unknown</p>
</section>
<section id="measured-vs-published-trecdl-prompt-tokens">
<h2>Measured vs Published: TrecDL Prompt Tokens<a class="headerlink" href="#measured-vs-published-trecdl-prompt-tokens" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_trec_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_results_metric</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># TREC 19/20 Prompt Tokens: Measured vs Published Results

## Summary Statistics

* Mean absolute difference: 101672.380
* Median absolute difference: 441.167
* Maximum absolute difference: 991179.093

## Results by LLM

| LLM           |      mean |    std |   count |
|:--------------|----------:|-------:|--------:|
| flan-t5-large |  -86110.2 | 240515 |      18 |
| flan-t5-xl    | -133862   | 306492 |      18 |
| flan-t5-xxl   |  -82415.7 | 185732 |      18 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |         Measured |        Published |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------------:|-----------------:|-------------:|------------------------:|--------------------:|
| 13 | TrecDL19  | flan-t5-xl    | pairwise.heapsort   | 110090           |      1.10127e+06 |  -991179     |                  -90    |           0.0999664 |
|  2 | TrecDL19  | flan-t5-large | pairwise.allpair    |      2.24715e+06 |      3.01438e+06 |  -767235     |                  -25.45 |           0.745475  |
| 29 | TrecDL20  | flan-t5-large | pairwise.allpair    |      2.28824e+06 |      3.01423e+06 |  -725997     |                  -24.09 |           0.759144  |
| 11 | TrecDL19  | flan-t5-xl    | pairwise.allpair    |      2.24715e+06 |      2.95344e+06 |  -706288     |                  -23.91 |           0.760859  |
| 38 | TrecDL20  | flan-t5-xl    | pairwise.allpair    |      2.28824e+06 |      2.94946e+06 |  -661222     |                  -22.42 |           0.775816  |
| 20 | TrecDL19  | flan-t5-xxl   | pairwise.allpair    |      2.24715e+06 |      2.79494e+06 |  -547795     |                  -19.6  |           0.804005  |
| 47 | TrecDL20  | flan-t5-xxl   | pairwise.allpair    |      2.28824e+06 |      2.79493e+06 |  -506693     |                  -18.13 |           0.81871   |
| 26 | TrecDL19  | flan-t5-xxl   | setwise.heapsort    |  32407.5         | 420786           |  -388378     |                  -92.3  |           0.0770166 |
|  7 | TrecDL19  | flan-t5-large | setwise.bubblesort  | 124258           | 147774           |   -23516.2   |                  -15.91 |           0.840864  |
| 25 | TrecDL19  | flan-t5-xxl   | setwise.bubblesort  | 129212           | 150765           |   -21552.8   |                  -14.3  |           0.857043  |
| 34 | TrecDL20  | flan-t5-large | setwise.bubblesort  | 127630           | 148947           |   -21317.5   |                  -14.31 |           0.856879  |
| 52 | TrecDL20  | flan-t5-xxl   | setwise.bubblesort  | 131975           | 152710           |   -20734.7   |                  -13.58 |           0.864221  |
| 16 | TrecDL19  | flan-t5-xl    | setwise.bubblesort  | 129838           | 149949           |   -20111.1   |                  -13.41 |           0.86588   |
| 43 | TrecDL20  | flan-t5-xl    | setwise.bubblesort  | 131783           | 151250           |   -19466.4   |                  -12.87 |           0.871296  |
| 17 | TrecDL19  | flan-t5-xl    | setwise.heapsort    |  32213.5         |  41665.7         |    -9452.23  |                  -22.69 |           0.773141  |
| 48 | TrecDL20  | flan-t5-xxl   | pairwise.bubblesort | 396402           | 387359           |     9043     |                    2.33 |           1.02335   |
| 44 | TrecDL20  | flan-t5-xl    | setwise.heapsort    |  32619.5         |  41569.1         |    -8949.56  |                  -21.53 |           0.784707  |
|  8 | TrecDL19  | flan-t5-large | setwise.heapsort    |  31961           |  40460.6         |    -8499.58  |                  -21.01 |           0.78993   |
| 53 | TrecDL20  | flan-t5-xxl   | setwise.heapsort    |  33253.6         |  41633.7         |    -8380.11  |                  -20.13 |           0.798718  |
| 35 | TrecDL20  | flan-t5-large | setwise.heapsort    |  32437.4         |  40362           |    -7924.56  |                  -19.63 |           0.803663  |
| 39 | TrecDL20  | flan-t5-xl    | pairwise.bubblesort | 400503           | 394954           |     5549.02  |                    1.4  |           1.01405   |
| 30 | TrecDL20  | flan-t5-large | pairwise.bubblesort | 360963           | 357358           |     3604.22  |                    1.01 |           1.01009   |
| 40 | TrecDL20  | flan-t5-xl    | pairwise.heapsort   | 112985           | 111341           |     1644.25  |                    1.48 |           1.01477   |
| 49 | TrecDL20  | flan-t5-xxl   | pairwise.heapsort   | 111531           | 110212           |     1318.73  |                    1.2  |           1.01197   |
| 31 | TrecDL20  | flan-t5-large | pairwise.heapsort   | 104890           | 104242           |      647.8   |                    0.62 |           1.00621   |
| 46 | TrecDL20  | flan-t5-xxl   | listwise.likelihood |  95957.9         |  95482.7         |      475.18  |                    0.5  |           1.00498   |
| 37 | TrecDL20  | flan-t5-xl    | listwise.likelihood |  95767.5         |  95298.7         |      468.83  |                    0.49 |           1.00492   |
| 28 | TrecDL20  | flan-t5-large | listwise.likelihood |  95621.8         |  95208.3         |      413.505 |                    0.43 |           1.00434   |
|  4 | TrecDL19  | flan-t5-large | pairwise.heapsort   | 105246           | 104952           |      293.267 |                    0.28 |           1.00279   |
| 51 | TrecDL20  | flan-t5-xxl   | pointwise.yes_no    |  16003.3         |  16185.2         |     -181.92  |                   -1.12 |           0.98876   |
</pre></div>
</div>
<img alt="_images/b85031ec40cf0facda0219315502a8fc765612d864e2490336143f5d3d1752f4.png" src="_images/b85031ec40cf0facda0219315502a8fc765612d864e2490336143f5d3d1752f4.png" />
<img alt="_images/a8212baefefc9d433b2dcb66fd40942c5a1beaee5dd95cac59e4382f8cac1a69.png" src="_images/a8212baefefc9d433b2dcb66fd40942c5a1beaee5dd95cac59e4382f8cac1a69.png" />
<img alt="_images/58197afcefbca9067a513af2608f5d2241d864d1644e7ee3dd1b21fedd84b58c.png" src="_images/58197afcefbca9067a513af2608f5d2241d864d1644e7ee3dd1b21fedd84b58c.png" />
</div>
</div>
</section>
<section id="measured-vs-published-trecdl-generated-tokens">
<h2>Measured vs Published: TrecDL Generated Tokens<a class="headerlink" href="#measured-vs-published-trecdl-generated-tokens" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_trec_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Generated Tokens&#39;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_results_metric</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s1">&#39;Generated Tokens&#39;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># TREC 19/20 Generated Tokens: Measured vs Published Results

## Summary Statistics

* Mean absolute difference: 181.664
* Median absolute difference: 13.247
* Maximum absolute difference: 797.881

## Results by LLM

| LLM           |     mean |     std |   count |
|:--------------|---------:|--------:|--------:|
| flan-t5-large | -166.23  | 304.417 |      12 |
| flan-t5-xl    | -162.407 | 297.529 |      12 |
| flan-t5-xxl   | -154.932 | 313.774 |      12 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Measured |   Published |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|------------:|-------------:|------------------------:|--------------------:|
|  7 | TrecDL19  | flan-t5-large | setwise.bubblesort  |   1504.42  |     2302.3  |     -797.881 |                  -34.66 |            0.653442 |
| 52 | TrecDL20  | flan-t5-xxl   | setwise.bubblesort  |   1559     |     2339.6  |     -780.6   |                  -33.36 |            0.666353 |
| 25 | TrecDL19  | flan-t5-xxl   | setwise.bubblesort  |   1562.44  |     2341.6  |     -779.158 |                  -33.27 |            0.667254 |
| 34 | TrecDL20  | flan-t5-large | setwise.bubblesort  |   1514.33  |     2287.1  |     -772.775 |                  -33.79 |            0.662116 |
| 16 | TrecDL19  | flan-t5-xl    | setwise.bubblesort  |   1572.33  |     2334.5  |     -762.174 |                  -32.65 |            0.673517 |
| 43 | TrecDL20  | flan-t5-xl    | setwise.bubblesort  |   1560.97  |     2317.6  |     -756.625 |                  -32.65 |            0.673531 |
| 26 | TrecDL19  | flan-t5-xxl   | setwise.heapsort    |    388.721 |      650.5  |     -261.779 |                  -40.24 |            0.597573 |
| 17 | TrecDL19  | flan-t5-xl    | setwise.heapsort    |    386.279 |      647.4  |     -261.121 |                  -40.33 |            0.596662 |
| 44 | TrecDL20  | flan-t5-xl    | setwise.heapsort    |    384.2   |      638.9  |     -254.7   |                  -39.87 |            0.601346 |
| 53 | TrecDL20  | flan-t5-xxl   | setwise.heapsort    |    391.175 |      640.6  |     -249.425 |                  -38.94 |            0.610638 |
|  8 | TrecDL19  | flan-t5-large | setwise.heapsort    |    383.837 |      626.9  |     -243.063 |                  -38.77 |            0.612278 |
| 35 | TrecDL20  | flan-t5-large | setwise.heapsort    |    382.85  |      621.1  |     -238.25  |                  -38.36 |            0.616406 |
| 48 | TrecDL20  | flan-t5-xxl   | pairwise.bubblesort |   8553.95  |     8428.5  |      125.45  |                    1.49 |            1.01488  |
| 22 | TrecDL19  | flan-t5-xxl   | pairwise.heapsort   |   2393.49  |     2304    |       89.488 |                    3.88 |            1.03884  |
| 39 | TrecDL20  | flan-t5-xl    | pairwise.bubblesort |   8697.35  |     8638.5  |       58.85  |                    0.68 |            1.00681  |
| 30 | TrecDL20  | flan-t5-large | pairwise.bubblesort |   7815.5   |     7785.4  |       30.1   |                    0.39 |            1.00387  |
| 27 | TrecDL20  | flan-t5-large | listwise.generation |   2479.05  |     2460.1  |       18.95  |                    0.77 |            1.0077   |
| 36 | TrecDL20  | flan-t5-xl    | listwise.generation |   2829.3   |     2814.7  |       14.595 |                    0.52 |            1.00519  |
| 40 | TrecDL20  | flan-t5-xl    | pairwise.heapsort   |   2455.2   |     2443.3  |       11.9   |                    0.49 |            1.00487  |
| 49 | TrecDL20  | flan-t5-xxl   | pairwise.heapsort   |   2413.5   |     2404.8  |        8.7   |                    0.36 |            1.00362  |
|  4 | TrecDL19  | flan-t5-large | pairwise.heapsort   |   2309.77  |     2303.3  |        6.467 |                    0.28 |            1.00281  |
| 21 | TrecDL19  | flan-t5-xxl   | pairwise.bubblesort |   8700     |     8705.3  |       -5.3   |                   -0.06 |            0.999391 |
| 18 | TrecDL19  | flan-t5-xxl   | listwise.generation |   2818.81  |     2824    |       -5.186 |                   -0.18 |            0.998164 |
|  0 | TrecDL19  | flan-t5-large | listwise.generation |   2584.05  |     2581.35 |        2.697 |                    0.1  |            1.00104  |
| 45 | TrecDL20  | flan-t5-xxl   | listwise.generation |   2706.53  |     2707.9  |       -1.37  |                   -0.05 |            0.999494 |
|  9 | TrecDL19  | flan-t5-xl    | listwise.generation |   2911.35  |     2910    |        1.349 |                    0.05 |            1.00046  |
| 13 | TrecDL19  | flan-t5-xl    | pairwise.heapsort   |   2417.67  |     2418.6  |       -0.926 |                   -0.04 |            0.999617 |
| 31 | TrecDL20  | flan-t5-large | pairwise.heapsort   |   2267.5   |     2268.3  |       -0.8   |                   -0.04 |            0.999647 |
|  3 | TrecDL19  | flan-t5-large | pairwise.bubblesort |   8441.4   |     8441.6  |       -0.205 |                   -0    |            0.999976 |
| 12 | TrecDL19  | flan-t5-xl    | pairwise.bubblesort |   8869.07  |     8869.1  |       -0.03  |                   -0    |            0.999997 |
</pre></div>
</div>
<img alt="_images/4569086e4c29e6320ba618756b6a89e3aff5580c0a4c53ad109e250fc0a8535d.png" src="_images/4569086e4c29e6320ba618756b6a89e3aff5580c0a4c53ad109e250fc0a8535d.png" />
<img alt="_images/154e9c9ee108883303faab6cf4a5932792c27f6d8db703b2412b6ac3db572b67.png" src="_images/154e9c9ee108883303faab6cf4a5932792c27f6d8db703b2412b6ac3db572b67.png" />
<img alt="_images/57f9d72b2ae81458caab6c87fbf674bb56935dcd63dff375784781817bcbfd82.png" src="_images/57f9d72b2ae81458caab6c87fbf674bb56935dcd63dff375784781817bcbfd82.png" />
</div>
</div>
</section>
<section id="measured-vs-published-trecdl-metric-discrepancy">
<h2>Measured vs Published: TrecDL Metric Discrepancy %<a class="headerlink" href="#measured-vs-published-trecdl-metric-discrepancy" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">create_discrepancy_heatmap</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
    <span class="n">llm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">dataset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a heatmap showing the percentage discrepancy between measured and published metrics</span>
<span class="sd">    for different methods and metrics.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe containing the metrics data</span>
<span class="sd">        llm (str): LLM model name to filter data</span>
<span class="sd">        dataset (str): Dataset name to filter data</span>
<span class="sd">        ax (plt.Axes): Matplotlib axes object to plot on</span>
<span class="sd">        metrics (List[str]): List of metrics to display in specified order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">method_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;pointwise.qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise.yes_no&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.generation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.likelihood&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.allpair&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.bubblesort&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Filter data for specified LLM and dataset</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dataset</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Create pivot tables for measured and published values</span>
    <span class="n">measured_pivot</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
    <span class="p">)</span>
    
    <span class="n">published_pivot</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Published&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
    <span class="p">)</span>
    
    <span class="c1"># Calculate discrepancy percentage</span>
    <span class="n">discrepancy</span> <span class="o">=</span> <span class="p">(</span><span class="n">measured_pivot</span> <span class="o">-</span> <span class="n">published_pivot</span><span class="p">)</span> <span class="o">/</span> <span class="n">published_pivot</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Validate and reorder columns based on provided metrics</span>
    <span class="n">available_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">discrepancy</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
        <span class="n">missing_metrics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available_metrics</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Some metrics not found in data: </span><span class="si">{</span><span class="n">missing_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">discrepancy</span> <span class="o">=</span> <span class="n">discrepancy</span><span class="p">[</span><span class="n">available_metrics</span><span class="p">]</span>

    <span class="c1"># Reorder rows according to method_order</span>
    <span class="n">available_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_order</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">discrepancy</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">discrepancy</span> <span class="o">=</span> <span class="n">discrepancy</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">available_methods</span><span class="p">)</span>
    
    <span class="c1"># Create heatmap on the provided axes</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">discrepancy</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
    <span class="p">)</span>
    
    <span class="c1"># Customize the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
    <span class="c1"># Rotate labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">discrepancy</span>

<span class="k">def</span> <span class="nf">create_heatmap_matrix</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">hmap_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">hmap_height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a matrix of heatmaps for different LLM and dataset combinations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe containing the metrics data</span>
<span class="sd">        metrics (List[str]): List of metrics to display in specified order</span>
<span class="sd">        hmap_width (float): Width of the heatmap figure</span>
<span class="sd">        hmap_height (float): Height of the heatmap figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a figure with 3x2 subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># LLM models and datasets</span>
    <span class="n">llms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flan-t5-large&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xl&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xxl&quot;</span><span class="p">]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TrecDL19&quot;</span><span class="p">,</span> <span class="s2">&quot;TrecDL20&quot;</span><span class="p">]</span>
    
    <span class="c1"># Create heatmaps for each combination</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llms</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
            <span class="n">create_discrepancy_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">metrics</span><span class="p">)</span>
    
    <span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Measured vs Published TrecDL Metric Discrepancy&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span>  <span class="c1"># Automatically adjust boundaries</span>
        <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.5</span>  <span class="c1"># Add padding around the entire figure</span>
    <span class="p">)</span>

    <span class="c1"># Adjust layout to prevent overlapping</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># Example usage:</span>
<span class="c1"># metrics_order = [&#39;NDCG@10&#39;, &#39;Inferences&#39;, &#39;Prompt Tokens&#39;, &#39;Generated Tokens&#39;, &#39;Latency (s)&#39;]</span>
<span class="n">metrics_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">,</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">,</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">create_heatmap_matrix</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics_order</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/622ce005abb2ab6bdae5a12077803247eacedfb7fd2526035aadd487c0b2b406.png" src="_images/622ce005abb2ab6bdae5a12077803247eacedfb7fd2526035aadd487c0b2b406.png" />
</div>
</div>
</section>
<section id="measured-vs-published-beir-ndcg-10-discrepancy">
<h2>Measured vs Published: BEIR NDCG&#64;10 Discrepancy %<a class="headerlink" href="#measured-vs-published-beir-ndcg-10-discrepancy" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom formatter to display &#39;-&#39; for missing values&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;-&#39;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="k">def</span> <span class="nf">plot_ndcg_discrepancy_stacked</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">llm_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates three vertically stacked heatmaps showing the percentage discrepancy </span>
<span class="sd">    between measured and published NDCG@10 values for different methods and datasets</span>
<span class="sd">    for multiple LLMs. Empty cells are filled with &#39;-&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Input dataframe containing the metrics data</span>
<span class="sd">    llm_list : list</span>
<span class="sd">        List of LLM names to create heatmaps for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define the order of methods and datasets</span>
    <span class="n">method_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;pointwise.qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise.yes_no&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.generation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.likelihood&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.bubblesort&#39;</span>
    <span class="p">]</span>
    
    <span class="n">dataset_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Covid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Touche&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DBPedia&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Signal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;News&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Robust04&#39;</span>
    <span class="p">]</span>
    
    <span class="c1"># Create figure with subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    
    <span class="c1"># Create heatmap for each LLM</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llm_list</span><span class="p">):</span>
        <span class="c1"># Filter data for the specified LLM and NDCG@10 metric</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="c1"># Create pivot tables for measured and published values</span>
        <span class="n">measured_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span>
        
        <span class="n">published_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Published&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span>
        
        <span class="c1"># Calculate discrepancy percentage</span>
        <span class="n">discrepancy_df</span> <span class="o">=</span> <span class="p">((</span><span class="n">measured_df</span> <span class="o">-</span> <span class="n">published_df</span><span class="p">)</span> <span class="o">/</span> <span class="n">published_df</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="c1"># Reorder rows and columns</span>
        <span class="n">discrepancy_df</span> <span class="o">=</span> <span class="n">discrepancy_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">method_order</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dataset_order</span><span class="p">)</span>
        
        <span class="c1"># Format annotation values</span>
        <span class="n">annot_values</span> <span class="o">=</span> <span class="p">[[</span><span class="n">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">discrepancy_df</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        
        <span class="c1"># Create heatmap</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
            <span class="n">discrepancy_df</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="n">annot_values</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Empty format string since we&#39;re using custom annotations</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Customize each subplot</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NDCG@10 Discrepancy % (Measured vs Published) for </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Rotate labels</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    
    <span class="c1"># Adjust layout to prevent label cutoff</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Measured vs Published BEIR NDCG@10 Discrepancy&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    
    <span class="c1"># return fig</span>

<span class="c1"># Call the function with the list of LLMs</span>
<span class="n">llms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flan-t5-large&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xl&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xxl&quot;</span><span class="p">]</span>
<span class="n">plot_ndcg_discrepancy_stacked</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">llms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/96f6bb60606e12d0f04c531d69225bdeb56c8d33e2503726d102afba42413cd1.png" src="_images/96f6bb60606e12d0f04c531d69225bdeb56c8d33e2503726d102afba42413cd1.png" />
</div>
</div>
</section>
<section id="measured-vs-published-beir-gpu-minutes">
<h2>Measured vs Published: BEIR GPU Minutes<a class="headerlink" href="#measured-vs-published-beir-gpu-minutes" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">plot_gpu_minutes_stacked</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">llm_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates three vertically stacked heatmaps showing the GPU minutes</span>
<span class="sd">    for different methods and datasets across multiple LLMs.</span>
<span class="sd">    Uses consistent color scaling across all subplots.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">method_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;pointwise.qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise.yes_no&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.generation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;listwise.likelihood&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.bubblesort&#39;</span>
    <span class="p">]</span>
    
    <span class="n">dataset_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Covid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Touche&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;DBPedia&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Signal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;News&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Robust04&#39;</span>
    <span class="p">]</span>
    
    <span class="c1"># Create figure with subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    
    <span class="c1"># First pass to find global min/max for consistent color scaling</span>
    <span class="n">global_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="n">global_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">llm</span> <span class="ow">in</span> <span class="n">llm_list</span><span class="p">:</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPU Minutes &#39;</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">])[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            
        <span class="n">gpu_minutes_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> 
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">method_order</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dataset_order</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">nonzero_vals</span> <span class="o">=</span> <span class="n">gpu_minutes_df</span><span class="p">[</span><span class="n">gpu_minutes_df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nonzero_vals</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">global_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">global_min</span><span class="p">,</span> <span class="n">nonzero_vals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">global_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">global_max</span><span class="p">,</span> <span class="n">nonzero_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    
    <span class="c1"># Use 1/10 of global_min for zero values</span>
    <span class="n">zero_replacement</span> <span class="o">=</span> <span class="n">global_min</span> <span class="o">/</span> <span class="mi">10</span>
    
    <span class="c1"># Custom formatter to display &#39;-&#39; for zeros</span>
    <span class="k">def</span> <span class="nf">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;-&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span>
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llm_list</span><span class="p">):</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPU Minutes &#39;</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">])[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        
        <span class="n">gpu_minutes_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> 
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">method_order</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dataset_order</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Prepare data for plotting</span>
        <span class="n">data_for_plot</span> <span class="o">=</span> <span class="n">gpu_minutes_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_for_plot</span> <span class="o">=</span> <span class="n">data_for_plot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zero_replacement</span><span class="p">)</span>
        
        <span class="c1"># Format annotation values</span>
        <span class="n">annot_values</span> <span class="o">=</span> <span class="p">[[</span><span class="n">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gpu_minutes_df</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        
        <span class="c1"># data_for_plot.clip(lower=1e-10)</span>
        <span class="c1"># axes[idx].set_yscale(&#39;log&#39;)</span>

        <span class="n">log_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">data_for_plot</span><span class="p">)</span>  <span class="c1"># log1p adds 1 before taking log to handle zeros</span>

        <span class="c1"># sns.heatmap(log_data, </span>
        <span class="c1">#             cmap=&#39;YlOrRd&#39;, </span>
        <span class="c1">#             # annot=True, </span>
        <span class="c1">#             annot=pivot_for_heatmap, </span>



        <span class="c1"># Create heatmap with consistent log-scaled colors</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
            <span class="n">log_data</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="n">annot_values</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Use empty string since we&#39;re providing formatted annotations</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span>
            <span class="c1"># norm=LogNorm(vmin=global_min/10, vmax=global_max),</span>
            <span class="c1"># norm=LogNorm(vmin=1, vmax=240),</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Remove colorbar</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># plt.yscale(&#39;log&#39;)</span>
        
        <span class="c1"># Customize each subplot</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GPU Minutes for </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Rotate labels</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    
    <span class="c1"># Adjust layout to prevent label cutoff</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Measured vs Published BEIR GPU Minutes&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    <span class="c1"># return fig</span>

<span class="c1"># Example usage</span>
<span class="n">llms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flan-t5-large&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xl&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xxl&quot;</span><span class="p">]</span>
<span class="n">plot_gpu_minutes_stacked</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">llms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e8fd8c53a8bca79a79be3c8335f274cf28b97212db983e198aae7f6e54409c7c.png" src="_images/e8fd8c53a8bca79a79be3c8335f274cf28b97212db983e198aae7f6e54409c7c.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="results-modified-vs-original">
<h1>Results: Modified vs Original<a class="headerlink" href="#results-modified-vs-original" title="Link to this heading">#</a></h1>
<section id="modified-vs-original-beir-metric-increase">
<h2>Modified vs Original: BEIR Metric Increase %<a class="headerlink" href="#modified-vs-original-beir-metric-increase" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_increase_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">llm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a heatmap showing the percentage increase from original to modified </span>
<span class="sd">    for different methods and metrics.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe containing the metrics data</span>
<span class="sd">        llm (str): LLM model name to filter data</span>
<span class="sd">        dataset (str): Dataset name to filter data</span>
<span class="sd">        ax (plt.Axes): Matplotlib axes object to plot on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NDCG@10&#39;</span><span class="p">,</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">,</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">]</span>

    <span class="n">method_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;pointwise.qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise.yes_no&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;listwise.generation&#39;,</span>
        <span class="c1"># &#39;listwise.likelihood&#39;,</span>
        <span class="c1"># &#39;pairwise.allpair&#39;,</span>
        <span class="s1">&#39;pairwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.bubblesort&#39;</span>
    <span class="p">]</span>

    <span class="c1"># Filter data for specified LLM and dataset</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dataset</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Create pivot tables for measured and published values</span>
    <span class="n">modified_pivot</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Modified&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
    <span class="p">)</span>
    
    <span class="n">original_pivot</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
    <span class="p">)</span>
    
    <span class="c1"># Calculate increase percentage</span>
    <span class="n">increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">modified_pivot</span> <span class="o">-</span> <span class="n">original_pivot</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_pivot</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Reorder columns</span>
    <span class="n">increase</span> <span class="o">=</span> <span class="n">increase</span><span class="p">[</span><span class="n">column_order</span><span class="p">]</span>

    <span class="c1"># Reorder rows according to method_order</span>
    <span class="n">available_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_order</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">increase</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">increase</span> <span class="o">=</span> <span class="n">increase</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">available_methods</span><span class="p">)</span>
    
    <span class="c1"># Create heatmap on the provided axes</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">increase</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># cbar_kws={&#39;label&#39;: &#39;Discrepancy %&#39;},</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
    <span class="p">)</span>
    
    <span class="c1"># Customize the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
    <span class="c1"># Rotate labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">increase</span>

<span class="k">def</span> <span class="nf">create_increase_heatmap_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">llms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a matrix of heatmaps for different LLM and dataset combinations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe containing the metrics data</span>
<span class="sd">        llms (list): List of LLM models to include</span>
<span class="sd">        datasets (list): List of datasets to include</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a figure with subplots based on number of datasets and LLMs</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">llms</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)))</span>
    
    <span class="c1"># Create heatmaps for each combination</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llms</span><span class="p">):</span>
            <span class="n">create_increase_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># Adjust layout to prevent overlapping</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">fig</span>

<span class="n">datasets1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Covid&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;Touche&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;News&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;Signal&quot;</span>
    <span class="c1"># , &quot;Robust04&quot;</span>
    <span class="c1"># , &quot;NFCorpus&quot;</span>
    <span class="c1"># , &quot;DBPedia&quot;</span>
    <span class="c1"># , &quot;SciFact&quot;</span>
<span class="p">]</span>
<span class="n">datasets2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># &quot;Covid&quot;</span>
    <span class="c1"># , &quot;Touche&quot;</span>
    <span class="c1"># , &quot;News&quot;</span>
    <span class="c1"># , &quot;Signal&quot;</span>
     <span class="s2">&quot;Robust04&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;NFCorpus&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;DBPedia&quot;</span>
    <span class="p">,</span> <span class="s2">&quot;SciFact&quot;</span>
<span class="p">]</span>

<span class="n">llms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flan-t5-large&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xl&quot;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">create_increase_heatmap_matrix</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">llms</span><span class="p">,</span> <span class="n">datasets1</span><span class="p">)</span>

<span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Modified vs Original BEIR Metric Increase 1&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">create_increase_heatmap_matrix</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">llms</span><span class="p">,</span> <span class="n">datasets2</span><span class="p">)</span>

<span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Modified vs Original BEIR Metric Increase 2&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/878bf6b42b610d931c8e22f620db3c0a48f6b98c0754c1a8a3561268aa4339f6.png" src="_images/878bf6b42b610d931c8e22f620db3c0a48f6b98c0754c1a8a3561268aa4339f6.png" />
<img alt="_images/ab4f5c96b54495b3ef05ee77c88120b07d3d73e862d9a049f760b3f36db6225f.png" src="_images/ab4f5c96b54495b3ef05ee77c88120b07d3d73e862d9a049f760b3f36db6225f.png" />
</div>
</div>
</section>
<section id="modified-vs-original-beir-ndcg-10-increase">
<h2>Modified vs Original: BEIR NDCG&#64;10 Increase %<a class="headerlink" href="#modified-vs-original-beir-ndcg-10-increase" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom formatter to display &#39;-&#39; for missing values&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;-&#39;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="k">def</span> <span class="nf">plot_ndcg_discrepancy_stacked</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">llm_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates three vertically stacked heatmaps showing the percentage discrepancy </span>
<span class="sd">    between measured and published NDCG@10 values for different methods and datasets</span>
<span class="sd">    for multiple LLMs. Empty cells are filled with &#39;-&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        Input dataframe containing the metrics data</span>
<span class="sd">    llm_list : list</span>
<span class="sd">        List of LLM names to create heatmaps for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define the order of methods and datasets</span>
    <span class="n">method_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;pointwise.qlm&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pointwise.yes_no&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;listwise.generation&#39;,</span>
        <span class="c1"># &#39;listwise.likelihood&#39;,</span>
        <span class="s1">&#39;pairwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pairwise.bubblesort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.heapsort&#39;</span><span class="p">,</span>
        <span class="s1">&#39;setwise.bubblesort&#39;</span>
    <span class="p">]</span>
    
    <span class="n">dataset_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Covid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Touche&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DBPedia&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Signal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;News&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Robust04&#39;</span>
    <span class="p">]</span>
    
    <span class="c1"># Create figure with subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
                                                
    <span class="c1"># Create heatmap for each LLM</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">llm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llm_list</span><span class="p">):</span>
        <span class="c1"># Filter data for the specified LLM and NDCG@10 metric</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">llm</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="c1"># Create pivot tables for measured and published values</span>
        <span class="n">original_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Measured&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span>
        
        <span class="n">modified_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Modified&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span>
        <span class="p">)</span>
        
        <span class="c1"># Calculate discrepancy percentage</span>
        <span class="n">increase_df</span> <span class="o">=</span> <span class="p">((</span><span class="n">modified_df</span> <span class="o">-</span> <span class="n">original_df</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_df</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="c1"># Reorder rows and columns</span>
        <span class="n">increase_df</span> <span class="o">=</span> <span class="n">increase_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">method_order</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">dataset_order</span><span class="p">)</span>
        
        <span class="c1"># Format annotation values</span>
        <span class="n">annot_values</span> <span class="o">=</span> <span class="p">[[</span><span class="n">value_formatter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">increase_df</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        
        <span class="c1"># Create heatmap</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
            <span class="n">increase_df</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="n">annot_values</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Empty format string since we&#39;re using custom annotations</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="c1"># Customize each subplot</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NDCG@10 Increase % (Modified vs Original) for </span><span class="si">{</span><span class="n">llm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Rotate labels</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    
    <span class="c1"># Adjust layout to prevent label cutoff</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="n">bname</span> <span class="o">=</span> <span class="s2">&quot;Modified vs Original BEIR NDCG@10 Increase&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/</span><span class="si">{</span><span class="n">bname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    <span class="c1"># return fig</span>

<span class="c1"># Call the function with the list of LLMs</span>
<span class="c1"># llms = [&quot;flan-t5-large&quot;, &quot;flan-t5-xl&quot;, &quot;flan-t5-xxl&quot;]</span>
<span class="n">llms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flan-t5-large&quot;</span><span class="p">,</span> <span class="s2">&quot;flan-t5-xl&quot;</span><span class="p">]</span>
<span class="n">plot_ndcg_discrepancy_stacked</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">,</span> <span class="n">llms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/159a6cc3f2195a11d07ed6b0152a700364fb9451f5da9e692b096ad2d9fdf1da.png" src="_images/159a6cc3f2195a11d07ed6b0152a700364fb9451f5da9e692b096ad2d9fdf1da.png" />
</div>
</div>
</section>
<section id="analyze-beir-modified-metric">
<h2>analyze_beir_modified_metric()<a class="headerlink" href="#analyze-beir-modified-metric" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>


<span class="k">def</span> <span class="nf">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes BEIR NDCG@10 scores, comparing original (measured) vs modified values across LLMs, methods, and datasets.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe with columns Source, LLM, Dataset, Method, Metric_Name, Metric_Value</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[pd.DataFrame, List[plt.Figure]]: Tables and figures for the analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scale</span><span class="o">=</span><span class="mf">0.6</span>
    <span class="c1"># Filter for relevant data</span>
    <span class="n">relevant_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Covid&#39;</span><span class="p">,</span> <span class="s1">&#39;Signal&#39;</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Robust04&#39;</span><span class="p">,</span> <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span> <span class="s1">&#39;Touche&#39;</span><span class="p">,</span> <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span> <span class="s1">&#39;DBPedia&#39;</span><span class="p">]</span>
    <span class="n">relevant_llms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">]</span>
    
    <span class="c1"># Filter out listwise methods</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">relevant_datasets</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">relevant_llms</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;listwise&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Measured&#39;</span><span class="p">,</span> <span class="s1">&#39;Modified&#39;</span><span class="p">]))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Rename Sources for clarity</span>
    <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
        <span class="s1">&#39;Measured&#39;</span><span class="p">:</span> <span class="s1">&#39;Original&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Modified&#39;</span><span class="p">:</span> <span class="s1">&#39;Modified&#39;</span>
    <span class="p">})</span>
    
    <span class="c1"># Create comparison table</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Calculate differences</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Modified&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Original&#39;</span><span class="p">]</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Relative_Difference_%&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Original&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Factor_Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Modified&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Original&#39;</span><span class="p">]</span>
    
    <span class="c1"># Sort by absolute difference</span>
    <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Abs_Difference&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Generate figures</span>
    <span class="n">figures</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># # 1. Heatmap of absolute differences by Dataset and Method for each LLM</span>
    <span class="c1"># for llm in relevant_llms:</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(hmap_width, hmap_height))</span>
    <span class="c1">#     heatmap_data = pivot_table[pivot_table[&#39;LLM&#39;] == llm].pivot(</span>
    <span class="c1">#         index=&#39;Dataset&#39;,</span>
    <span class="c1">#         columns=&#39;Method&#39;,</span>
    <span class="c1">#         values=&#39;Difference&#39;</span>
    <span class="c1">#     )</span>
        
    <span class="c1">#     sns.heatmap(heatmap_data, </span>
    <span class="c1">#                cmap=&#39;RdYlBu&#39;,</span>
    <span class="c1">#                center=0,</span>
    <span class="c1">#                annot=True,</span>
    <span class="c1">#                fmt=&#39;.3f&#39;,</span>
    <span class="c1">#                ax=ax)</span>
        
    <span class="c1">#     # Rotate x-axis labels 45 degrees</span>
    <span class="c1">#     plt.xticks(rotation=45, ha=&#39;right&#39;)</span>
    <span class="c1">#     plt.xlabel(&#39;&#39;)  # Remove x-label</span>
    <span class="c1">#     plt.ylabel(&#39;&#39;)  # Remove y-label</span>
        
    <span class="c1">#     plt.title(f&#39;Absolute Difference (Modified - Original) {metric_name} for {llm}&#39;)</span>
    <span class="c1">#     plt.tight_layout()</span>
    <span class="c1">#     figures.append(fig)</span>

    <span class="c1"># 2. Heatmap of relative differences by Dataset and Method for each LLM</span>
    <span class="c1"># for llm in relevant_llms:</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(hmap_width, hmap_height))</span>
    <span class="c1">#     heatmap_data = pivot_table[pivot_table[&#39;LLM&#39;] == llm].pivot(</span>
    <span class="c1">#         index=&#39;Dataset&#39;,</span>
    <span class="c1">#         columns=&#39;Method&#39;,</span>
    <span class="c1">#         values=&#39;Relative_Difference_%&#39;</span>
    <span class="c1">#     )</span>
        
    <span class="c1">#     sns.heatmap(heatmap_data, </span>
    <span class="c1">#                cmap=&#39;RdYlBu&#39;,</span>
    <span class="c1">#                center=0,</span>
    <span class="c1">#                annot=True,</span>
    <span class="c1">#                fmt=&#39;.1f&#39;,</span>
    <span class="c1">#                vmin=-50,</span>
    <span class="c1">#                vmax=50,</span>
    <span class="c1">#                ax=ax)</span>
        
    <span class="c1">#     # Rotate x-axis labels 45 degrees</span>
    <span class="c1">#     plt.xticks(rotation=45, ha=&#39;right&#39;)</span>
    <span class="c1">#     plt.xlabel(&#39;&#39;)  # Remove x-label</span>
    <span class="c1">#     plt.ylabel(&#39;&#39;)  # Remove y-label</span>
        
    <span class="c1">#     # plt.title(f&#39;Relative Difference (% {metric_name} Change) for {llm}&#39;)</span>
    <span class="c1">#     plt.title(f&#39;{metric_name} % Increase (Modified vs Original) for {llm}&#39;)</span>
    <span class="c1">#     plt.tight_layout()</span>

    <span class="c1">#     filename = f&#39;doc/_generated/modified_original_beir_heatmap_pdiff_{metric_name.replace(&quot; &quot;, &quot;&quot;)}_{llm.lower().replace(&quot;-&quot;, &quot;&quot;)}.png&#39;</span>
    <span class="c1">#     plt.savefig(filename, bbox_inches=&#39;tight&#39;, dpi=150)</span>

    <span class="c1">#     figures.append(fig)</span>
    

    <span class="c1"># if metric_name == &#39;Latency (s)&#39;:</span>
    <span class="c1">#     for llm in relevant_llms:</span>
    <span class="c1">#         fig, ax = plt.subplots(figsize=(hmap_width, hmap_height))</span>
    <span class="c1">#         heatmap_data = pivot_table[pivot_table[&#39;LLM&#39;] == llm].pivot(</span>
    <span class="c1">#             index=&#39;Dataset&#39;,</span>
    <span class="c1">#             columns=&#39;Method&#39;,</span>
    <span class="c1">#             values=&#39;Factor_Difference&#39;</span>
    <span class="c1">#         )</span>
            
    <span class="c1">#         sns.heatmap(heatmap_data, </span>
    <span class="c1">#                 cmap=&#39;RdYlBu&#39;,</span>
    <span class="c1">#                 center=0,</span>
    <span class="c1">#                 annot=True,</span>
    <span class="c1">#                 fmt=&#39;.1f&#39;,</span>
    <span class="c1">#                 vmin=0,</span>
    <span class="c1">#                 vmax=2,</span>
    <span class="c1">#                 ax=ax)</span>
            
    <span class="c1">#         plt.tick_params(axis=&#39;x&#39;, labelsize=9)</span>
    <span class="c1">#         plt.xticks(rotation=30)</span>
    <span class="c1">#         plt.xlabel(&#39;&#39;)  # Remove x-label</span>
    <span class="c1">#         plt.ylabel(&#39;&#39;)  # Remove y-label</span>

    <span class="c1">#         plt.title(f&#39;{metric_name} Factor (Modified/Original) for {llm}&#39;)</span>
    <span class="c1">#         # plt.tight_layout()</span>

    <span class="c1">#         filename = f&#39;doc/_generated/modified_original_beir_heatmap_fdiff_{metric_name.replace(&quot; &quot;, &quot;&quot;)}_{llm.lower().replace(&quot;-&quot;, &quot;&quot;)}.png&#39;</span>
    <span class="c1">#         plt.savefig(filename, bbox_inches=&#39;tight&#39;, dpi=150)</span>

    <span class="c1">#         figures.append(fig)</span>


    <span class="c1"># 3. Box plot of differences by Dataset</span>
    <span class="k">if</span> <span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="n">hmap_height</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pivot_table</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Difference&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove x-label</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;NDCG@10&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">)</span>  <span class="c1"># Set y-axis limits</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;Inferences&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;Prompt Tokens&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;Generated Tokens&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">metric_name</span> <span class="o">==</span> <span class="s1">&#39;Latency (s)&#39;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>


        <span class="c1"># Add horizontal line at y=0</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

        <span class="c1"># plt.title(&#39;Modification Tends to Improve NDCG@10&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Modification Lifts </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/modified_original_beir_pdiff_method_boxplot</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

        <span class="n">figures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pivot_table</span><span class="p">,</span> <span class="n">figures</span>

<span class="k">def</span> <span class="nf">format_modified_results</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats the analysis results into a markdown string suitable for a research paper.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        table (pd.DataFrame): The comparison table generated by analyze_beir_ndcg_modified</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Formatted markdown string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">markdown</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# BEIR </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: Original vs Modified Results</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Overall statistics</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;## Summary Statistics</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Mean absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Median absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* Maximum absolute difference: </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    
    <span class="c1"># Results by LLM</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Results by LLM</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">llm_stats</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;LLM&#39;</span><span class="p">)[</span><span class="s1">&#39;Difference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="n">llm_stats</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span>
    
    <span class="c1"># Most significant differences</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">## Most Significant Differences</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="n">significant_diffs</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># Already sorted by absolute difference</span>
    <span class="n">markdown</span> <span class="o">+=</span> <span class="n">significant_diffs</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">markdown</span>


<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df</span><span class="p">[</span><span class="n">adjusted_df</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;bm25&#39;</span><span class="p">]</span>
<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df2</span><span class="p">[</span><span class="n">adjusted_df2</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;listwise.generation&#39;</span><span class="p">]</span>
<span class="n">adjusted_df2</span> <span class="o">=</span> <span class="n">adjusted_df2</span><span class="p">[</span><span class="n">adjusted_df2</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;listwise.likelihood&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modified-vs-original-beir-ndcg-10">
<h2>Modified vs Original: BEIR NDCG&#64;10<a class="headerlink" href="#modified-vs-original-beir-ndcg-10" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_modified_results</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span><span class="s2">&quot;NDCG@10&quot;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># BEIR NDCG@10: Original vs Modified Results

## Summary Statistics

* Mean absolute difference: 0.015
* Median absolute difference: 0.009
* Maximum absolute difference: 0.188

## Results by LLM

| LLM           |   mean |   std |   count |
|:--------------|-------:|------:|--------:|
| flan-t5-large |  0.009 | 0.035 |      47 |
| flan-t5-xl    |  0.002 | 0.013 |      46 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Modified |   Original |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|-----------:|-------------:|------------------------:|--------------------:|
| 65 | SciFact   | flan-t5-large | setwise.heapsort    |      0.65  |      0.462 |        0.188 |                   40.69 |            1.40693  |
| 64 | SciFact   | flan-t5-large | setwise.bubblesort  |      0.68  |      0.609 |        0.071 |                   11.66 |            1.11658  |
| 88 | Touche    | flan-t5-large | setwise.bubblesort  |      0.423 |      0.355 |        0.068 |                   19.15 |            1.19155  |
|  4 | Covid     | flan-t5-large | setwise.bubblesort  |      0.722 |      0.777 |       -0.055 |                   -7.08 |            0.929215 |
| 49 | Robust04  | flan-t5-large | pairwise.heapsort   |      0.446 |      0.402 |        0.044 |                   10.95 |            1.10945  |
| 54 | Robust04  | flan-t5-xl    | pairwise.bubblesort |      0.521 |      0.554 |       -0.033 |                   -5.96 |            0.940433 |
| 89 | Touche    | flan-t5-large | setwise.heapsort    |      0.314 |      0.282 |        0.032 |                   11.35 |            1.11348  |
| 77 | Signal    | flan-t5-large | setwise.heapsort    |      0.338 |      0.307 |        0.031 |                   10.1  |            1.10098  |
| 94 | Touche    | flan-t5-xl    | setwise.bubblesort  |      0.352 |      0.321 |        0.031 |                    9.66 |            1.09657  |
| 41 | News      | flan-t5-large | setwise.heapsort    |      0.458 |      0.431 |        0.027 |                    6.26 |            1.06265  |
| 68 | SciFact   | flan-t5-xl    | pointwise.qlm       |      0.72  |      0.694 |        0.026 |                    3.75 |            1.03746  |
| 95 | Touche    | flan-t5-xl    | setwise.heapsort    |      0.304 |      0.28  |        0.024 |                    8.57 |            1.08571  |
| 48 | Robust04  | flan-t5-large | pairwise.bubblesort |      0.462 |      0.439 |        0.023 |                    5.24 |            1.05239  |
| 74 | Signal    | flan-t5-large | pointwise.qlm       |      0.294 |      0.316 |       -0.022 |                   -6.96 |            0.93038  |
| 83 | Signal    | flan-t5-xl    | setwise.heapsort    |      0.322 |      0.3   |        0.022 |                    7.33 |            1.07333  |
</pre></div>
</div>
<img alt="_images/86a435e846f90515c24324ce168cc6165670b11462433c6067d1704c02802d8b.png" src="_images/86a435e846f90515c24324ce168cc6165670b11462433c6067d1704c02802d8b.png" />
</div>
</div>
</section>
<section id="modified-vs-original-beir-query-latency">
<h2>Modified vs Original: BEIR Query Latency<a class="headerlink" href="#modified-vs-original-beir-query-latency" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span><span class="s2">&quot;Latency (s)&quot;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_modified_results</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span><span class="s2">&quot;Latency (s)&quot;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># BEIR Latency (s): Original vs Modified Results

## Summary Statistics

* Mean absolute difference: 9.525
* Median absolute difference: 2.627
* Maximum absolute difference: 76.015

## Results by LLM

| LLM           |   mean |    std |   count |
|:--------------|-------:|-------:|--------:|
| flan-t5-large | -5.862 | 14.463 |      44 |
| flan-t5-xl    | -8.383 | 19.572 |      46 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Modified |   Original |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|-----------:|-------------:|------------------------:|--------------------:|
|  7 | Covid     | flan-t5-xl    | pairwise.heapsort   |     30.651 |    106.666 |      -76.015 |                  -71.26 |            0.287355 |
| 66 | SciFact   | flan-t5-xl    | pairwise.bubblesort |     28.904 |    103.395 |      -74.491 |                  -72.05 |            0.279549 |
|  0 | Covid     | flan-t5-large | pairwise.bubblesort |     92.4   |    144.553 |      -52.153 |                  -36.08 |            0.639212 |
| 84 | Touche    | flan-t5-large | pairwise.bubblesort |     93.026 |    144.675 |      -51.649 |                  -35.7  |            0.643    |
| 90 | Touche    | flan-t5-xl    | pairwise.bubblesort |     99.562 |    144.621 |      -45.059 |                  -31.16 |            0.688434 |
| 24 | NFCorpus  | flan-t5-large | pairwise.bubblesort |     47.526 |     91.869 |      -44.343 |                  -48.27 |            0.517324 |
| 54 | Robust04  | flan-t5-xl    | pairwise.bubblesort |     69.033 |    110.347 |      -41.314 |                  -37.44 |            0.625599 |
| 42 | News      | flan-t5-xl    | pairwise.bubblesort |     67.155 |    103.886 |      -36.731 |                  -35.36 |            0.64643  |
| 30 | NFCorpus  | flan-t5-xl    | pairwise.bubblesort |     43.512 |     79.22  |      -35.708 |                  -45.07 |            0.549255 |
|  6 | Covid     | flan-t5-xl    | pairwise.bubblesort |    109.5   |     75.556 |       33.944 |                   44.93 |            1.44926  |
| 88 | Touche    | flan-t5-large | setwise.bubblesort  |     21.634 |     47.619 |      -25.985 |                  -54.57 |            0.454314 |
|  4 | Covid     | flan-t5-large | setwise.bubblesort  |     23.308 |     46.97  |      -23.662 |                  -50.38 |            0.496232 |
| 12 | DBPedia   | flan-t5-large | pairwise.bubblesort |     78.871 |     57.976 |       20.895 |                   36.04 |            1.36041  |
| 48 | Robust04  | flan-t5-large | pairwise.bubblesort |     66.486 |     47.576 |       18.91  |                   39.75 |            1.39747  |
| 67 | SciFact   | flan-t5-xl    | pairwise.heapsort   |     16.564 |     35.192 |      -18.628 |                  -52.93 |            0.470675 |
</pre></div>
</div>
</div>
</div>
</section>
<section id="modified-vs-original-beir-inferences">
<h2>Modified vs Original: BEIR #Inferences<a class="headerlink" href="#modified-vs-original-beir-inferences" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span><span class="s2">&quot;Inferences&quot;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_modified_results</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span><span class="s2">&quot;Inferences&quot;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># BEIR Inferences: Original vs Modified Results

## Summary Statistics

* Mean absolute difference: 19.291
* Median absolute difference: 1.743
* Maximum absolute difference: 280.090

## Results by LLM

| LLM           |    mean |    std |   count |
|:--------------|--------:|-------:|--------:|
| flan-t5-large |  10.482 | 43.305 |      44 |
| flan-t5-xl    | -20.507 | 51.482 |      46 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Modified |   Original |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|-----------:|-------------:|------------------------:|--------------------:|
| 66 | SciFact   | flan-t5-xl    | pairwise.bubblesort |    375.62  |    655.71  |     -280.09  |                  -42.72 |            0.572845 |
| 48 | Robust04  | flan-t5-large | pairwise.bubblesort |    765.229 |    528.205 |      237.024 |                   44.87 |            1.44873  |
| 54 | Robust04  | flan-t5-xl    | pairwise.bubblesort |    611.438 |    771.622 |     -160.184 |                  -20.76 |            0.792406 |
| 30 | NFCorpus  | flan-t5-xl    | pairwise.bubblesort |    383.058 |    501.334 |     -118.276 |                  -23.59 |            0.764077 |
| 42 | News      | flan-t5-xl    | pairwise.bubblesort |    622.737 |    734.474 |     -111.737 |                  -15.21 |            0.847868 |
| 72 | Signal    | flan-t5-large | pairwise.bubblesort |    792.062 |    694.474 |       97.588 |                   14.05 |            1.14052  |
| 12 | DBPedia   | flan-t5-large | pairwise.bubblesort |    859.76  |    773.33  |       86.43  |                   11.18 |            1.11176  |
| 84 | Touche    | flan-t5-large | pairwise.bubblesort |    914.163 |    849.184 |       64.979 |                    7.65 |            1.07652  |
| 78 | Signal    | flan-t5-xl    | pairwise.bubblesort |    743.701 |    803.175 |      -59.474 |                   -7.4  |            0.925951 |
| 16 | DBPedia   | flan-t5-large | setwise.bubblesort  |    248.645 |    303.558 |      -54.913 |                  -18.09 |            0.819102 |
| 90 | Touche    | flan-t5-xl    | pairwise.bubblesort |    861.388 |    904.673 |      -43.285 |                   -4.78 |            0.952154 |
| 49 | Robust04  | flan-t5-large | pairwise.heapsort   |    223.839 |    182.225 |       41.614 |                   22.84 |            1.22837  |
| 67 | SciFact   | flan-t5-xl    | pairwise.heapsort   |    183.883 |    216.96  |      -33.077 |                  -15.25 |            0.847543 |
| 88 | Touche    | flan-t5-large | setwise.bubblesort  |    279.082 |    301.918 |      -22.836 |                   -7.56 |            0.924364 |
| 85 | Touche    | flan-t5-large | pairwise.heapsort   |    245.245 |    223.306 |       21.939 |                    9.82 |            1.09825  |
</pre></div>
</div>
</div>
</div>
</section>
<section id="modified-vs-original-beir-prompt-tokens">
<h2>Modified vs Original: BEIR Prompt Tokens<a class="headerlink" href="#modified-vs-original-beir-prompt-tokens" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span><span class="s2">&quot;Prompt Tokens&quot;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_modified_results</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span><span class="s2">&quot;Prompt Tokens&quot;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># BEIR Prompt Tokens: Original vs Modified Results

## Summary Statistics

* Mean absolute difference: 12845.719
* Median absolute difference: 625.244
* Maximum absolute difference: 182008.635

## Results by LLM

| LLM           |     mean |     std |   count |
|:--------------|---------:|--------:|--------:|
| flan-t5-large | 13154.4  | 32991.6 |      44 |
| flan-t5-xl    | -5521.38 | 29439.1 |      46 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Modified |   Original |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|-----------:|-------------:|------------------------:|--------------------:|
| 48 | Robust04  | flan-t5-large | pairwise.bubblesort |     516949 |     334940 |     182009   |                   54.34 |            1.54341  |
| 66 | SciFact   | flan-t5-xl    | pairwise.bubblesort |     256336 |     421897 |    -165561   |                  -39.24 |            0.607579 |
| 54 | Robust04  | flan-t5-xl    | pairwise.bubblesort |     412474 |     489949 |     -77475   |                  -15.81 |            0.841871 |
| 12 | DBPedia   | flan-t5-large | pairwise.bubblesort |     438270 |     364205 |      74064.2 |                   20.34 |            1.20336  |
| 84 | Touche    | flan-t5-large | pairwise.bubblesort |     574112 |     503412 |      70700.3 |                   14.04 |            1.14044  |
| 30 | NFCorpus  | flan-t5-xl    | pairwise.bubblesort |     251568 |     308486 |     -56917.7 |                  -18.45 |            0.815493 |
| 72 | Signal    | flan-t5-large | pairwise.bubblesort |     202153 |     148228 |      53924.7 |                   36.38 |            1.3638   |
| 36 | News      | flan-t5-large | pairwise.bubblesort |     561858 |     515994 |      45863.6 |                    8.89 |            1.08888  |
| 42 | News      | flan-t5-xl    | pairwise.bubblesort |     420351 |     465089 |     -44738.1 |                   -9.62 |            0.903808 |
|  0 | Covid     | flan-t5-large | pairwise.bubblesort |     597724 |     555188 |      42536   |                    7.66 |            1.07662  |
| 49 | Robust04  | flan-t5-large | pairwise.heapsort   |     151243 |     115699 |      35544.1 |                   30.72 |            1.30721  |
| 24 | NFCorpus  | flan-t5-large | pairwise.bubblesort |     381584 |     352801 |      28782.6 |                    8.16 |            1.08158  |
|  6 | Covid     | flan-t5-xl    | pairwise.bubblesort |     602697 |     574672 |      28024.8 |                    4.88 |            1.04877  |
| 85 | Touche    | flan-t5-large | pairwise.heapsort   |     155194 |     133290 |      21904.2 |                   16.43 |            1.16433  |
| 78 | Signal    | flan-t5-xl    | pairwise.bubblesort |     191927 |     171650 |      20276.9 |                   11.81 |            1.11813  |
</pre></div>
</div>
</div>
</div>
</section>
<section id="modified-vs-original-beir-generated-tokens">
<h2>Modified vs Original: BEIR Generated Tokens<a class="headerlink" href="#modified-vs-original-beir-generated-tokens" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_table</span><span class="p">,</span> <span class="n">figures</span> <span class="o">=</span> <span class="n">analyze_beir_modified_metric</span><span class="p">(</span><span class="n">adjusted_df2</span><span class="p">,</span><span class="s2">&quot;Generated Tokens&quot;</span><span class="p">)</span>
<span class="n">report_text</span> <span class="o">=</span> <span class="n">format_modified_results</span><span class="p">(</span><span class="n">comparison_table</span><span class="p">,</span><span class="s2">&quot;Generated Tokens&quot;</span><span class="p">)</span>

<span class="c1"># Print the formatted report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>

<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># BEIR Generated Tokens: Original vs Modified Results

## Summary Statistics

* Mean absolute difference: 180.876
* Median absolute difference: 8.717
* Maximum absolute difference: 2800.900

## Results by LLM

| LLM           |    mean |     std |   count |
|:--------------|--------:|--------:|--------:|
| flan-t5-large |  123.06 | 417.963 |      44 |
| flan-t5-xl    | -199.58 | 516.412 |      46 |

## Most Significant Differences

|    | Dataset   | LLM           | Method              |   Modified |   Original |   Difference |   Relative_Difference_% |   Factor_Difference |
|---:|:----------|:--------------|:--------------------|-----------:|-----------:|-------------:|------------------------:|--------------------:|
| 66 | SciFact   | flan-t5-xl    | pairwise.bubblesort |    3756.2  |    6557.1  |    -2800.9   |                  -42.72 |            0.572845 |
| 48 | Robust04  | flan-t5-large | pairwise.bubblesort |    7652.29 |    5282.05 |     2370.24  |                   44.87 |            1.44874  |
| 54 | Robust04  | flan-t5-xl    | pairwise.bubblesort |    6114.38 |    7716.23 |    -1601.85  |                  -20.76 |            0.792405 |
| 30 | NFCorpus  | flan-t5-xl    | pairwise.bubblesort |    3830.58 |    5013.34 |    -1182.76  |                  -23.59 |            0.764078 |
| 42 | News      | flan-t5-xl    | pairwise.bubblesort |    6227.37 |    7344.74 |    -1117.37  |                  -15.21 |            0.847868 |
| 72 | Signal    | flan-t5-large | pairwise.bubblesort |    7920.62 |    6944.74 |      975.877 |                   14.05 |            1.14052  |
| 12 | DBPedia   | flan-t5-large | pairwise.bubblesort |    8597.6  |    7733.3  |      864.3   |                   11.18 |            1.11176  |
| 84 | Touche    | flan-t5-large | pairwise.bubblesort |    9141.63 |    8491.84 |      649.796 |                    7.65 |            1.07652  |
| 78 | Signal    | flan-t5-xl    | pairwise.bubblesort |    7437.01 |    8031.75 |     -594.743 |                   -7.4  |            0.925951 |
| 90 | Touche    | flan-t5-xl    | pairwise.bubblesort |    8613.88 |    9046.74 |     -432.857 |                   -4.78 |            0.952153 |
| 49 | Robust04  | flan-t5-large | pairwise.heapsort   |    2238.39 |    1822.25 |      416.145 |                   22.84 |            1.22837  |
| 67 | SciFact   | flan-t5-xl    | pairwise.heapsort   |    1838.83 |    2169.6  |     -330.767 |                  -15.25 |            0.847545 |
| 16 | DBPedia   | flan-t5-large | setwise.bubblesort  |    1243.22 |    1517.79 |     -274.563 |                  -18.09 |            0.819103 |
| 85 | Touche    | flan-t5-large | pairwise.heapsort   |    2452.45 |    2233.06 |      219.388 |                    9.82 |            1.09825  |
| 55 | Robust04  | flan-t5-xl    | pairwise.heapsort   |    2239.04 |    2413.17 |     -174.137 |                   -7.22 |            0.927839 |
</pre></div>
</div>
</div>
</div>
</section>
<section id="gpu-minutes-per-experiment">
<h2>GPU Minutes Per Experiment<a class="headerlink" href="#gpu-minutes-per-experiment" title="Link to this heading">#</a></h2>
<p>NVIDIA RTX 4090 GPUS!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span>

<span class="k">def</span> <span class="nf">analyze_gpu_minutes</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes GPU time across LLMs, methods, and datasets.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe with columns Source, LLM, Dataset, Method, </span>
<span class="sd">                          Metric_Name, and Metric_Value</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing:</span>
<span class="sd">        - DataFrame with detailed statistics</span>
<span class="sd">        - Dictionary of matplotlib figures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Filter for relevant data</span>
    <span class="n">target_llms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">]</span>
    <span class="n">target_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Covid&#39;</span><span class="p">,</span> <span class="s1">&#39;Signal&#39;</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Robust04&#39;</span><span class="p">,</span> <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;Touche&#39;</span><span class="p">,</span> <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span> <span class="s1">&#39;DBPedia&#39;</span><span class="p">]</span>
    
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPU Minutes &#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">target_llms</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">target_datasets</span><span class="p">))</span>
    <span class="p">)</span>
    
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Create pivot table for analysis</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">filtered_df</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">],</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Reset index for better display</span>
    <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Create visualizations</span>
    <span class="c1"># plt.style.use(&#39;seaborn&#39;)</span>
    <span class="n">figures</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># 1. Heatmap</span>
    <span class="n">fig_heatmap</span><span class="p">,</span> <span class="n">ax_heatmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">hmap_width</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">pivot_for_heatmap</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">],</span>
        <span class="c1"># aggfunc=&#39;median&#39;</span>
        <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">)</span>
    
    <span class="n">log_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">pivot_for_heatmap</span><span class="p">)</span>  <span class="c1"># log1p adds 1 before taking log to handle zeros</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">log_data</span><span class="p">,</span> 
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> 
                <span class="c1"># annot=True, </span>
                <span class="n">annot</span><span class="o">=</span><span class="n">pivot_for_heatmap</span><span class="p">,</span> 
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">,</span>
                <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="c1"># cbar_kws={&#39;label&#39;: &#39;GPU Minutes (minutes)&#39;},</span>
                <span class="c1"># cbar_kws={&#39;label&#39;: &#39;GPU Minutes (log scale)&#39;},</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax_heatmap</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove y-label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GPU Minutes per Experiment (by Dataset, LLM, and Method)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">figures</span><span class="p">[</span><span class="s1">&#39;heatmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_heatmap</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/gpu_mins_heatmap.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    
    <span class="c1"># 2. Box plot</span>
    <span class="n">fig_box</span><span class="p">,</span> <span class="n">ax_box</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">,</span> 
                <span class="n">x</span><span class="o">=</span><span class="s1">&#39;LLM&#39;</span><span class="p">,</span> 
                <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GPU Minutes per Experiment (by LLM and Dataset)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;GPU Minutes&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">figures</span><span class="p">[</span><span class="s1">&#39;boxplot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_box</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/gpu_mins_boxplot.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    
    <span class="c1"># 3. Bar plot</span>
    <span class="n">fig_bar</span><span class="p">,</span> <span class="n">ax_bar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filtered_df</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;LLM&#39;</span><span class="p">,</span>
                <span class="c1"># ci=None,</span>
                <span class="n">errorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax_bar</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average GPU Minutes per Experiment (by Method and LLM)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;GPU Minutes&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Remove x-label</span>
    <span class="c1"># plt.ylabel(&#39;&#39;)  # Remove y-label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="c1"># plt.yticks(rotation=45, ha=&#39;right&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">figures</span><span class="p">[</span><span class="s1">&#39;barplot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig_bar</span>
    
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;doc/_generated/gpu_mins_barplot.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pivot_table</span><span class="p">,</span> <span class="n">figures</span>

<span class="k">def</span> <span class="nf">print_summary_stats</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints summary statistics for the filtered data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Metric_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GPU Minutes &#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LLM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;flan-t5-large&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xl&#39;</span><span class="p">,</span> <span class="s1">&#39;flan-t5-xxl&#39;</span><span class="p">]))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Covid&#39;</span><span class="p">,</span> <span class="s1">&#39;Signal&#39;</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Robust04&#39;</span><span class="p">,</span> <span class="s1">&#39;NFCorpus&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;Touche&#39;</span><span class="p">,</span> <span class="s1">&#39;SciFact&#39;</span><span class="p">,</span> <span class="s1">&#39;DBPedia&#39;</span><span class="p">]))</span>
    <span class="p">)</span>
    
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Summary Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of measurements: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean GPU time by LLM:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;LLM&#39;</span><span class="p">)[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean GPU time by Dataset:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Dataset&#39;</span><span class="p">)[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean GPU time by Method:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)[</span><span class="s1">&#39;Metric_Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>


<span class="c1"># print_summary_stats(adjusted_df)</span>


<span class="c1"># Display the figures</span>
<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">analyze_gpu_minutes</span><span class="p">(</span><span class="n">adjusted_df</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8871382be773e6b64cea148cd83474ff03dc465d4617e38dbee618fb58978bfd.png" src="_images/8871382be773e6b64cea148cd83474ff03dc465d4617e38dbee618fb58978bfd.png" />
<img alt="_images/9be11b121b01ff3441419c0e8e0bfc9e102c3aa38d67bb0e4283957d702f0db0.png" src="_images/9be11b121b01ff3441419c0e8e0bfc9e102c3aa38d67bb0e4283957d702f0db0.png" />
<img alt="_images/acddb63b0d8bb888d148d123248a8676074468b6dc4ddea4b8307a474d22a090.png" src="_images/acddb63b0d8bb888d148d123248a8676074468b6dc4ddea4b8307a474d22a090.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">COMMON SETUP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-merge-list">DataFrame Merge List</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-display-function">DataFrame Display Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-cache-management">DataFrame Cache Management</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-analysis-utilities">DataFrame Analysis Utilities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-statistics-parser">Time Statistics Parser</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#figure-generation-utilities">Figure Generation Utilities</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-experiments">RUN EXPERIMENTS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-experiments">BEIR EXPERIMENTS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-published-metrics">LOAD PUBLISHED METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zhuang-table2-ocr-0011">Zhuang_table2_ocr_0011()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zhuang-table3-ocr-0011">Zhuang_table3_ocr_0011()</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-measured-metrics">LOAD MEASURED METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eval-measurements">eval_measurements()</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v3">v3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v2">v2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#v1">v1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-lesner">bm25_metrics_measured_by_lesner()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-lesner2">bm25_metrics_measured_by_lesner2()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-metrics-measured-by-lesner">beir_metrics_measured_by_lesner()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beir-metrics-measured-by-lesner2">beir_metrics_measured_by_lesner2()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bm25-metrics-measured-by-dhaliwal">bm25_metrics_measured_by_dhaliwal()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#all-metrics-measured-by-dhaliwal">all_metrics_measured_by_dhaliwal()</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#consolidate-metrics">CONSOLIDATE METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-merging">DataFrame Merging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-inspection">Data Inspection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#label-standardization">Label Standardization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-adjustment-pipeline">Data Adjustment Pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distinct-elements">Distinct Elements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicate-detection">Duplicate Detection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-metrics">ANALYZE METRICS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-statistics">Data Statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-selection-and-summary-functions">Metric Selection and Summary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specific-metric-analysis-sections">Specific Metric Analysis Sections</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ndcg-metrics">ndcg_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrences-metrics">infrences_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prompt-tokens-metrics">prompt_tokens_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generated-tokens-metrics">generated_tokens_metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#latency-metrics">latency_metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results-measured-vs-published">Results: Measured vs Published</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-ndcg-10">Measured vs Published: TrecDL NDCG@10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-query-latency">Measured vs Published: TrecDL Query Latency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-inferences">Measured vs Published: TrecDL #Inferences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-prompt-tokens">Measured vs Published: TrecDL Prompt Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-generated-tokens">Measured vs Published: TrecDL Generated Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-trecdl-metric-discrepancy">Measured vs Published: TrecDL Metric Discrepancy %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-beir-ndcg-10-discrepancy">Measured vs Published: BEIR NDCG@10 Discrepancy %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measured-vs-published-beir-gpu-minutes">Measured vs Published: BEIR GPU Minutes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results-modified-vs-original">Results: Modified vs Original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-metric-increase">Modified vs Original: BEIR Metric Increase %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-ndcg-10-increase">Modified vs Original: BEIR NDCG@10 Increase %</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-beir-modified-metric">analyze_beir_modified_metric()</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-ndcg-10">Modified vs Original: BEIR NDCG@10</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-query-latency">Modified vs Original: BEIR Query Latency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-inferences">Modified vs Original: BEIR #Inferences</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-prompt-tokens">Modified vs Original: BEIR Prompt Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-vs-original-beir-generated-tokens">Modified vs Original: BEIR Generated Tokens</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gpu-minutes-per-experiment">GPU Minutes Per Experiment</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By jlesner@ucsb.edu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>